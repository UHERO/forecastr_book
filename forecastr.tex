% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrreport}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\makeatletter
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}{
    \@ifstar
      \xxxParagraphStar
      \xxxParagraphNoStar
  }
  \newcommand{\xxxParagraphStar}[1]{\oldparagraph*{#1}\mbox{}}
  \newcommand{\xxxParagraphNoStar}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}{
    \@ifstar
      \xxxSubParagraphStar
      \xxxSubParagraphNoStar
  }
  \newcommand{\xxxSubParagraphStar}[1]{\oldsubparagraph*{#1}\mbox{}}
  \newcommand{\xxxSubParagraphNoStar}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
\makeatother

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\KOMAoption{captions}{tableheading}
\makeatletter
\@ifpackageloaded{bookmark}{}{\usepackage{bookmark}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother

\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={User guide to UHERO's forecast processes},
  pdfauthor={Peter Fuleky},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}


\title{User guide to UHERO's forecast processes}
\author{Peter Fuleky}
\date{2025-01-03}

\begin{document}
\maketitle

\renewcommand*\contentsname{Table of contents}
{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}

\bookmarksetup{startatroot}

\chapter{About}\label{about}

This document describes some useful practices for using R for applied
research, especially in the time series and forecasting domain. It also
serves as a guide for contributors to the \texttt{forecastr} R project.
The focus of the project is forecasting using multi-equation behavioral
models. The project encompasses data preparation, model selection (work
in progress), external forecast generation, local forecast generation
(planned), simulations (planned), and forecast distribution to a more
granular scale.

\section{Contents}\label{contents}

Chapters~\ref{sec-projects} - \ref{sec-renv} discuss the general setup
of a collaborative project environment under version control.
Chapter~\ref{sec-setup} deals with the setup file that configures the
most general aspects of the \texttt{forecastr} project.
Chapter~\ref{sec-utils} describes useful functions for time series
manipulation and forecasting. Chapter~\ref{sec-bestpract} gives examples
of best practices for time series manipulation.
Chapter~\ref{sec-modselect} describes a forecasting workflow from model
selection to simulation.

\bookmarksetup{startatroot}

\chapter{Projects}\label{sec-projects}

Projects are useful for organizing work, especially when working on
multiple pieces of research simultaneously. They help to keep the
workspace clean and avoid conflicts between tasks. Projects also make it
easier to share work with others. A
\href{https://support.posit.co/hc/en-us/articles/200526207-Using-RStudio-Projects}{project}
consists of the files associated with a given project (input data, R
scripts, analytical results, and figures) kept together in a folder.

\section{Project setup and
conventions}\label{project-setup-and-conventions}

Create a new project locally in RStudio under the File menu or using
\texttt{usethis::create\_project("proj\_dir")}. The \emph{.Rproj} file
contains the project settings. Open the project by double clicking this
file in Finder. The minimum structure of a project includes an \emph{R}
folder for scripts, a \emph{data} folder for data, and an \emph{output}
folder for reports and plots. If present, the \emph{data/raw} folder
contains data external to the project and the \emph{data/processed}
folder contains intermediate processed data. Although local projects are
sometimes useful to explore an idea, whenever you consider version
tracking or collaboration, the project should be initiated from GitHub
(see Chapter~\ref{sec-git} for details).

Use the \href{https://rstudio.github.io/renv/articles/renv.html}{renv}
package to store information about the packages used in the project. The
renv package facilitates sharing a project and maintaining the same
behavior on different machines. It creates a local package directory for
the project. This means that it keeps track of all the packages and
package versions that are used in the project, and collaborators can
restore the exact same package environment and reproduce the results
(see Chapter~\ref{sec-renv} for details).

Use the \href{https://here.r-lib.org}{here} package to create paths
relative to the project root. For example,
\texttt{here::here("data",\ "raw/file.csv")} returns the path to the
file \emph{file.csv} in the \emph{data/raw} folder. Load libraries and
put hard coded lines at the top of the script. Use the
\href{https://conflicted.r-lib.org}{conflicted} package to detect
conflicts across packages and assign preferences. For example,
\texttt{conflict\_prefer("filter",\ "dplyr")} assigns preference to the
\texttt{filter} function in the dplyr package over the \texttt{filter}
function in the stats package. Don't save the workspace on exit (Tools
\textgreater{} Global Options \textgreater{} General \textgreater{} Save
workspace to .RData on exit \textgreater{} Never or
\texttt{usethis::use\_blank\_slate()}).

Start each pipe with a comment, and if necessary add comments to each
line. Enable
\href{https://docs.posit.co/ide/user/ide/guide/tools/copilot.html}{Github
Copilot} for RStudio; it is free for higher education users. Github
Copilot will suggest code based on comments, which you can accept with
the tab key. Use sectioning comments (\# comments followed by at least
four dashes ----) to separate different parts of the script (they show
up in the outline section of the editor pane). Use the addin provided by
\href{https://styler.r-lib.org}{styler} package to format the code.
Follow the \texttt{tidyverse} ``dialect'' and
\href{https://style.tidyverse.org}{syntax}.

Use R scripts for coding; don't put the analysis into chunks in markdown
documents. Only render important results in code chunks of quarto
(\emph{qmd}) or Rmarkdown (\emph{Rmd}) documents. Within a \emph{qmd} or
\emph{Rmd} document
\href{https://bookdown.org/yihui/rmarkdown-cookbook/source-script.html}{source
the R script} containing the analysis. Alternatively, save the entire
workspace or individual objects from the R script, and then load these
in the appropriate code chunks of the markdown document. Make sure the
code chunks are looking for
\href{https://bookdown.org/yihui/rmarkdown-cookbook/working-directory.html}{objects
in the correct working directory}.

Store secrets, passwords, and keys with the
\href{https://keyring.r-lib.org/index.html}{keyring} package. For
example, set the UDAMAN token with
\texttt{keyring::key\_set\_with\_value(service\ =\ "udaman\_token",\ password\ =\ "-ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890=")}
and retrieve it with \texttt{keyring::key\_get("udaman\_token")}. To
avoid disclosing your secrets, do not store/assign the retrieved
credentials to a variable. If security is not a concern, environment
variables, such as API keys, can also be stored in a project specific
\emph{.Renviron} file; it must end with \texttt{\textbackslash{}n}. In
addition to \emph{.Renviron}, the \emph{.Rprofile} file is also executed
each time R starts up. The latter typically contains a script with
options and startup tasks. Both files are located in the project root
folder.

\section{Additional resources}\label{additional-resources}

Overview of R setup:\\
\url{https://rstats.wtf}

Best practices:\\
\url{https://kdestasio.github.io/post/r_best_practices/}

Considerations for structuring projects:\\
\url{https://www.r-bloggers.com/2018/08/structuring-r-projects/}

Set up your work in projects:\\
\url{https://r4ds.hadley.nz/workflow-scripts\#projects}

Efficient data management in R:\\
\url{https://www.r-bloggers.com/2020/02/efficient-data-management-in-r/}

Efficient R programming:\\
\url{https://csgillespie.github.io/efficientR/}

Data science workflow:\\
\url{http://dcl-workflow.stanford.edu}

\bookmarksetup{startatroot}

\chapter{Version control}\label{sec-git}

Version control tracks changes in files over time, allows you to revert
files back to a previous state and compare changes over time. It is
essential for the collaborative development of a project, but is also
useful for individual projects. Git is a popular version control system
and GitHub is a web-based platform that hosts Git repositories and
provides tools for collaboration.

\section{Version control terms in
Git(Hub)}\label{version-control-terms-in-github}

\begin{itemize}
\item
  \textbf{.gitignore}: A file that specifies which files and directories
  should be excluded from version control.
\item
  \textbf{Branch}: A separate line of development or parallel version of
  the repository. Branches are used to develop features or fix bugs
  without affecting the main branch.
\item
  \textbf{Clone}: A copy of a repository on your local machine. Cloning
  a repository allows you to work on the project locally.
\item
  \textbf{Commit}: A snapshot of the project at a specific point in
  time. Commits are used to save changes to the repository.
\item
  \textbf{Conflict}: When two branches have made changes to the same
  line in a file, a conflict occurs. Conflicts need to be resolved
  before the changes can be merged.
\item
  \textbf{Fork}: A copy of a repository on GitHub. This copy is
  independent of the original and you can make changes to it without
  affecting the original project.
\item
  \textbf{HEAD}: A reference to the most recent commit in the
  repository, tip of the branch that is currently checked out.
\item
  \textbf{Main or Master}: The default branch in a Git repository.
\item
  \textbf{Merge}: Combining changes from one branch into another branch.
\item
  \textbf{Origin}: The default name of primary version of the repository
  on GitHub.
\item
  \textbf{Pull}: Getting changes from GitHub to your local repository.
\item
  \textbf{Pull request}: A request to merge proposed changes from one
  branch into another branch. Pull requests are used to review and
  discuss changes before merging them into the main branch.
\item
  \textbf{Push}: Sending changes from your local repository to GitHub.
\item
  \textbf{Remote}: A remote repository on GitHub that you can pull from
  and push to.
\item
  \textbf{Repository}: A folder that contains all the files and history
  of a project. There can be a local repository (on your computer) and a
  remote repository (hosted on GitHub).
\item
  \textbf{Stage}: Staging allows you to select which changes should be
  included in the next commit.
\item
  \textbf{Upstream}: The original repository that you forked from on
  GitHub.
\end{itemize}

\section{Version control setup}\label{version-control-setup}

RStudio has built in support for Git-based version control for a
project. Check if Git is
\href{https://happygitwithr.com/install-git}{installed} by running
\texttt{git\ -\/-version} in the terminal. Git is included in Xcode
command line tools, which can be installed by running
\texttt{xcode-select\ -\/-install} in the terminal. Provide your GitHub
\href{https://happygitwithr.com/hello-git}{user name and email} to Git
via
\texttt{usethis::use\_git\_config(user.name\ =\ "Jane\ Doe",\ user.email\ =\ "jane@example.org")}.
Next, \href{https://happygitwithr.com/https-pat\#tldr}{generate and
store} a personal access token for GitHub via
\texttt{usethis::create\_github\_token()} and
\texttt{gitcreds::gitcreds\_set()}, respectively. Finally, make sure
version control is enabled in RStudio (RStudio \textgreater{} Global
Options \textgreater{} Git/SVN \textgreater{} Enable version control
interface for RStudio projects \textgreater{} check box or
\texttt{usethis::use\_blank\_slate()}). This concludes the setup for Git
and GitHub, making it possible to establish a connection between RStudio
and GitHub.

Always \href{https://happygitwithr.com/new-github-first}{start setting
up} version control on GitHub. Even if you
\href{https://happygitwithr.com/existing-github-first}{already have a
project} on your computer, begin by setting up a repository on GitHub.
This can be done by clicking on the ``+'' in the top right corner of the
\href{https://github.com}{GitHub website} and selecting ``New
repository''. Give the repository a name and description, make it public
or private, add a readme file, and choose the R template for .gitignore.
After creating the repository, copy the URL and open RStudio. The next
paragraph describes a robust local setup method with the
\texttt{usethis} package, but there is also a menu based option: create
a new project from version control by selecting File \textgreater{} New
Project \textgreater{} Version Control \textgreater{} Git and pasting
the URL in the ``Repository URL'' field. Use the repository name as the
project directory name. Choose a folder on your computer where the
project will be stored locally and click ``Create''. This will clone the
repository to your computer and create a new RStudio project. The
project is now connected to the repository on GitHub.

The local setup described above can be automated with
\texttt{usethis::create\_from\_github("repo\_url",\ "proj\_dir")}. If
you have permission to push to the remote GitHub repository because you
are an owner or collaborator on the project, then
\texttt{create\_from\_github} will
\href{https://happygitwithr.com/existing-github-first\#git-clone-usethis-rstudio}{clone
it}. If you do not have parmission to push to the repository,
\texttt{create\_from\_github} will
\href{https://happygitwithr.com/fork-and-clone\#fork-and-clone-create-from-github}{fork
and clone it}. In either case, do not work in the main branch. Instead,
create a ``dev'' branch in RStudio and work in that branch: in the Git
pane, click on the ``New Branch'', enter ``dev'' as the branch name,
keep the remote origin, and chek the sync with remote box. This will
create a new branch and switch to it.

While in the dev branch, make changes to scripts or other files and save
them. When you are ready to commit the changes, stage the files in the
Git pane (``Command a'' selects all files), click ``Commit'' at the top
of the Git pane. In the pop-up window, the ``Diff'' button allows you to
browse the changes made to the files in the repository, while the
``History'' button shows the commit history of the repository. These can
be analyzed more conveniently on GitHub as described below in
Section~\ref{sec-browse-commits}. Enter a commit message in the text
box, and click the ``Commit'' button. Then push the changes to the
remote repository. Go to the GitHub page of the dev branch and create a
pull request to merge the dev branch into the main branch of the remote
repository. After the pull request is merged, delete the dev branch on
GitHub. Delete the local dev branch by executing
\texttt{git\ branch\ -d\ dev} in the terminal. Finally, switch back to
the main branch in RStudio and pull the changes from the remote
repository.

\section{Time travel on GitHub}\label{sec-browse-commits}

From your repo's landing page, access commit history by clicking on
``123 Commits'' under the green Code button. Once you're viewing the
history, notice three ways to access more info for each commit:

\begin{itemize}
\item
  The clipboard icon copies the SHA of the commit. This can be handy if
  you need to refer to this commit elsewhere, e.g.~in an issue thread or
  a commit message or in a Git command you're forming for local
  execution.
\item
  Click on the abbreviated SHA itself in order to the view the diff
  associated with the commit.
\item
  Click on the double angle brackets \textless\textgreater{} to browse
  the state of the entire repo at that point in history.
\end{itemize}

Back out of any drilled down view by clicking on YOU/REPO to return to
your repo's landing page. This brings you back to the present state and
top-level of your repo.

Once you've identified a relevant commit, diff, or file state, you can
copy the current URL from your browser and use it to enhance online
discussion elsewhere, i.e.~to bring other people to this exact view of
the repo. The hyperlink-iness of repos hosted on GitHub can make online
discussion of a project much more precise and efficient.

What if you're interested in how a specific file came to be the way it
is? First navigate to the file in the repo, then notice ``Blame'' on the
left and ``History'' in the upper right.

\begin{itemize}
\item
  The ``blame'' view of a file reveals who last touched each line of the
  file, how long ago, and the associated commit message. Click on the
  commit message to visit that commit. Or click the ``stacked
  rectangles'' icon to move further back in time, but staying in blame
  view. This is handy when doing forensics on a specific and small set
  of lines.
\item
  The ``history'' view for a file is very much like the overall commit
  history described above, except it only includes commits that affect
  the file of interest. This can be handy when your inquiry is rather
  diffuse and you're trying to digest the general story arc for a file.
\end{itemize}

When viewing a file on GitHub, you can click on a line number to
highlight it. Use ``click \ldots{} shift-click'' to select a range of
lines. Notice your browser's URL shows something of this form:
https://github.com/OWNER/REPO/blob/SHA/path/to/file.R\#L27-L31 If the
URL does not contain the SHA, type ``y'' to toggle into that form. These
file- and SHA-specific URLs are a great way to point people at
particular lines of code in online conversations. It's best practice to
use the uglier links that contain the SHA, as they will stand the test
of time.

Search is always available in the upper-righthand corner of GitHub. Once
you enter some text in the search box, a dropdown provides the choice to
search in the current repo (the default) or all of GitHub. GitHub
searches the contents of files (described as ``Code''), commit messages,
and issues. Take advantage of the search hits across these different
domains. Again, this is a powerful way to zoom in on specific lines of
code, revisit an interesting time in project history, or re-discover a
conversation thread.

\section{Version control workflow}\label{version-control-workflow}

After the initial setup, the workflow should always follow the following
sequence:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  in the local/main branch, click on the ``Pull'' button in the Git pane
  to pull changes from the main branch of the remote repository, which
  is

  \begin{itemize}
  \tightlist
  \item
    upstream if the repository was forked,
  \item
    origin if the repository was cloned,
  \end{itemize}

  in the case of forked repo, after pulling from upstream, push to
  origin,
\item
  create a new dev branch and switch to it,
\item
  make changes in the dev branch,
\item
  commit changes in the dev branch,
\item
  push changes to the dev branch of the remote origin repository,
\item
  create a pull request on GitHub to merge the origin dev branch a) into
  upstream main if the repository was forked, b) into origin main if the
  repository was cloned,
\item
  merge the pull request (or wait for it to be merged by the owner),
\item
  after merging, delete the dev branch on the remote and locally,
\item
  repeat step 1. (and then repeat it again before you resume your work
  on the project).
\end{enumerate}

This workflow is recommended to avoid conflicts with other
collaborators.

\section{Dealing with conflicts}\label{dealing-with-conflicts}

If a push is rejected, pull the changes from the remote repository. If
there are conflicts, resolve them by editing the files and committing
the changes. Every merge conflict inserts three delimiters:

\texttt{\textless{}\textless{}\textless{}\textless{}\textless{}\textless{}}
feature branch name, the start of the merge conflict\\
\texttt{======} the separator between the content of both branches\\
\texttt{\textgreater{}\textgreater{}\textgreater{}\textgreater{}\textgreater{}\textgreater{}}
base branch name, the end of the merge conflict\\

Fix the merge conflict by directly editing the script at the indicated
locations. Often you can fix it by simply deleting the content of one of
the branches within the conflict. Potentially you need to keep a mix of
both. Don't forget to also delete the three delimiters when you're
ready.

\section{Additional resources}\label{additional-resources-1}

Visual Git guide:\\
\url{https://inbo.github.io/git-course/index.html}

Exhaustive discussion of Git for R users:\\
\url{https://happygitwithr.com}

A research workflow based on Github:\\
\url{https://www.carlboettiger.info/2012/05/06/research-workflow.html}

For more advanced tasks, use GitHub Desktop:\\
\url{https://desktop.github.com}

\bookmarksetup{startatroot}

\chapter{Package management}\label{sec-renv}

The \href{https://rstudio.github.io/renv/articles/renv.html}{renv
package} helps create \textbf{r}eproducible \textbf{env}ironments for
your R projects. Use renv to make R projects more isolated, portable and
reproducible.

\begin{itemize}
\item
  \textbf{Isolated}: Installing a new or updated package for one project
  won't break other projects, and vice versa. That's because renv gives
  each project its own private library.
\item
  \textbf{Portable}: Easily transport projects from one computer to
  another, even across different platforms. renv makes it easy to
  install the packages the project depends on.
\item
  \textbf{Reproducible}: renv records the exact package versions the
  project depends on, and ensures those exact versions get installed by
  others who work on the project.
\end{itemize}

\section{Getting started}\label{getting-started}

To convert a project to use renv, call \texttt{renv::init()}. This adds
three new files and directories to the project:

\begin{itemize}
\item
  The project library, \emph{renv/library}, is a library that contains
  all packages currently used by the project\footnote{If you'd like to
    skip dependency discovery, you can call
    \texttt{renv::init(bare\ =\ TRUE)} to initialize a project with an
    empty project library.}. This is the key magic that makes renv work:
  instead of having one library containing the packages used in every
  project, renv gives you a separate library for each project. This
  provides the benefits of isolation: different projects can use
  different versions of packages, and installing, updating, or removing
  packages in one project doesn't affect any other project.
\item
  The lockfile, \emph{renv.lock}, records enough metadata about every
  package that it can be re-installed on a new machine.
\item
  renv uses \emph{.Rprofile} to configure the R session to use the
  project library. This ensures that once renv is turned on for a
  project, it stays on, until it is deliberately turned off.
\end{itemize}

The next important pair of tools is \texttt{renv::snapshot()} and
\texttt{renv::restore()}. \texttt{snapshot()} updates the lockfile with
metadata about the currently-used packages in the project library.
Sharing the lockfile allows other people or other computers to reproduce
the current project environment by running \texttt{restore()}, which
uses the metadata from the lockfile to install exactly the same version
of every package. This pair of functions provides the benefits of
reproducibility and portability: you are now tracking exactly which
package versions you have installed so you can recreate them on other
machines.

\section{Collaboration}\label{collaboration}

One of the reasons to use renv is to make it easier to share code in
such a way that everyone gets exactly the same package versions. As
above, start by calling \texttt{renv::init()}. You'll then need to
commit \emph{renv.lock}, \emph{.Rprofile}, \emph{renv/settings.json} and
\emph{renv/activate.R} to version control, ensuring that others can
recreate your project environment. If you're using git, this is
particularly simple because renv will create a \emph{.gitignore}, and
you can just commit all suggested files.

Now when one of your collaborators opens this project, renv will
automatically bootstrap itself, downloading and installing the
appropriate version of renv. It will also ask them if they want to
download and install all the packages it needs by running
\texttt{renv::restore()}.

\section{Installing packages}\label{installing-packages}

If you use renv for multiple projects, you'll have multiple libraries,
meaning that you'll often need to install the same package in multiple
places. It would be annoying if you had to download (or worse, compile)
the package repeatedly, so renv uses a package cache. That means you
only ever have to download and install a package once, and for each
subsequent install, renv will just add a link from the project library
to the global cache. You can learn more about the cache in
\texttt{vignette("package-install")}.

After installing the package and checking that the code works, you
should call \texttt{renv::snapshot()} to record the latest package
versions in your lockfile. If you're collaborating with others, you'll
need to commit those changes to git, and let them know that you've
updated the lockfile and they should call \texttt{renv::restore()} when
they're next working on a project.

\section{Updating packages}\label{updating-packages}

Regularly (at least once a year) update the packages in your project to
get the latest versions of all dependencies. Similarly, if you're making
major changes to a project that you haven't worked on for a while, it's
often a good idea to start with an \texttt{renv::update()}\footnote{You
  can also use \texttt{update.packages()}, but \texttt{renv::update()}
  works with the same sources that \texttt{renv::install()} supports.}
before making any changes to the code.

After calling \texttt{renv::update()}, you should run the code in your
project and verify that it still works (or make any changes needed to
get it working). Then call \texttt{renv::snapshot()} to record the new
versions in the lockfile. If you get stuck, and can't get the project to
work with the new versions, you can call \texttt{renv::restore()} to
roll back changes to the project library and revert to the known good
state recorded in your lockfile. If you need to roll back to an even
older version, take a look at \texttt{renv::history()} and
\texttt{renv::revert()}. \texttt{renv::update()} will also update renv
itself, ensuring that you get all the latest features.

\section{Workflow for setting up a project with version control and
renv}\label{workflow-for-setting-up-a-project-with-version-control-and-renv}

The combination of version control and package management can facilitate
reproducibility and collaboration.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Set up a repository on GitHub
\item
  Clone the repo with \texttt{usethis::create\_from\_github()}
\item
  Initialize renv with \texttt{renv::init()}
\item
  Edit a script, install packages, run the script
\item
  Store info about installed packages with \texttt{renv::snapshot()}
\item
  Sync the project state with GitHub by committing and pushing up the
  changes
\item
  Collaborators (fork and) clone the repo, and install the necessary
  packages with \texttt{renv::restore()}
\item
  In subsequent work,

  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \item
    pull the current state of the repo from GitHub,
  \item
    run \texttt{renv::restore()} to install the necessary packages,
  \item
    edit the script, install new packages, run the script,
  \item
    run \texttt{renv::snapshot()},
  \item
    push changes to GitHub and place a pull request if necessary.
  \end{enumerate}
\end{enumerate}

This process ensures that you will always work with the most recent
version of your project.

\section{Additional resources}\label{additional-resources-2}

Overview of \texttt{renv}:\\
\url{https://rstudio.github.io/renv/articles/renv.html}

\bookmarksetup{startatroot}

\chapter{Setup of the forecastr project}\label{sec-setup}

The \texttt{setup.R} file contains general information used throughout
the project. The contents are listed below.

\section{Start with a clean slate}\label{start-with-a-clean-slate}

First remove all objects from global environment:\\
\texttt{rm(list\ =\ ls())}

If only some objects need to be removed, search for them via
wildcards:\\
\texttt{rm(list\ =\ ls(pattern\ =\ glob2rx("*\_\_*")))}

Detach all loaded packages:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{names}\NormalTok{(}\FunctionTok{sessionInfo}\NormalTok{()}\SpecialCharTok{$}\NormalTok{otherPkgs))) \{}
\FunctionTok{invisible}\NormalTok{(}
  \FunctionTok{suppressMessages}\NormalTok{(}
    \FunctionTok{suppressWarnings}\NormalTok{(}
      \FunctionTok{lapply}\NormalTok{(}
        \FunctionTok{paste}\NormalTok{(}\StringTok{"package:"}\NormalTok{, }\FunctionTok{names}\NormalTok{(}\FunctionTok{sessionInfo}\NormalTok{()}\SpecialCharTok{$}\NormalTok{otherPkgs), }\AttributeTok{sep=}\StringTok{""}\NormalTok{), }
\NormalTok{        detach, }
        \AttributeTok{character.only =} \ConstantTok{TRUE}\NormalTok{, }
        \AttributeTok{unload =} \ConstantTok{TRUE}
\NormalTok{        )}
\NormalTok{      )}
\NormalTok{    )}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\section{Packages}\label{packages}

The setup file clarifies its own location relative to the project root
and loads the necessary packages.

Navigate within a project using the \texttt{here()} package. Start by
specifying:\\
\texttt{here::i\_am("R/setup.R")}

Then load necessary packages

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# load necessary packages}
\FunctionTok{library}\NormalTok{(here) }\CommentTok{\# navigation within the project}
\FunctionTok{library}\NormalTok{(conflicted) }\CommentTok{\# detect conflicts across packages}
\FunctionTok{library}\NormalTok{(tidyverse) }\CommentTok{\# a set of frequently used data{-}wrangling tools}
\FunctionTok{library}\NormalTok{(magrittr) }\CommentTok{\# more than just pipes}
\FunctionTok{library}\NormalTok{(lubridate) }\CommentTok{\# dealing with dates}
\FunctionTok{library}\NormalTok{(tsbox) }\CommentTok{\# dealing with time series}
\FunctionTok{library}\NormalTok{(}\StringTok{"pins"}\NormalTok{)}
\CommentTok{\# library(bimets)}
\CommentTok{\# install.packages("devtools")}
\CommentTok{\# devtools::install\_github("UHERO/fcutils")}
\CommentTok{\# renv::purge("fcutils")}
\FunctionTok{library}\NormalTok{(}\StringTok{"fcutils"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Detect conflicts across packages and assign preferences

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{conflicted}\SpecialCharTok{::}\FunctionTok{conflict\_scout}\NormalTok{()}
\NormalTok{conflicted}\SpecialCharTok{::}\FunctionTok{conflict\_prefer}\NormalTok{(}\StringTok{"filter"}\NormalTok{, }\StringTok{"dplyr"}\NormalTok{) }\CommentTok{\# dplyr v stats}
\NormalTok{conflicted}\SpecialCharTok{::}\FunctionTok{conflict\_prefer}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"dplyr"}\NormalTok{) }\CommentTok{\# dplyr v xts}
\NormalTok{conflicted}\SpecialCharTok{::}\FunctionTok{conflict\_prefer}\NormalTok{(}\StringTok{"lag"}\NormalTok{, }\StringTok{"dplyr"}\NormalTok{) }\CommentTok{\# dplyr v stats}
\NormalTok{conflicted}\SpecialCharTok{::}\FunctionTok{conflict\_prefer}\NormalTok{(}\StringTok{"last"}\NormalTok{, }\StringTok{"dplyr"}\NormalTok{) }\CommentTok{\# dplyr v xts}
\NormalTok{conflicted}\SpecialCharTok{::}\FunctionTok{conflict\_prefer}\NormalTok{(}\StringTok{"extract"}\NormalTok{, }\StringTok{"magrittr"}\NormalTok{) }\CommentTok{\# magrittr vs tidyr}
\NormalTok{conflicted}\SpecialCharTok{::}\FunctionTok{conflict\_prefer}\NormalTok{(}\StringTok{"set\_names"}\NormalTok{, }\StringTok{"magrittr"}\NormalTok{) }\CommentTok{\# magrittr vs purrr}
\end{Highlighting}
\end{Shaded}

Verify top level project directory \texttt{here::here()}.\\

\section{Package descriptions}\label{package-descriptions}

Only load essential packages with many useful functions (don't load a
whole package to access a single function). Refer to individual
functions in packages that are not loaded by
\texttt{namespace::function()}.\\

\begin{itemize}
\tightlist
\item
  Core \href{https://www.tidyverse.org}{tidyverse} packages.\\
\item
  Non-core tidyverse packages (need to be loaded separately):\\

  \begin{itemize}
  \tightlist
  \item
    \href{https://magrittr.tidyverse.org}{magrittr}\\
  \item
    \href{https://lubridate.tidyverse.org}{lubridate}
  \end{itemize}
\item
  Time series tools in \href{https://www.tsbox.help}{tsbox} (learn them
  and use them, very useful). All start with \texttt{ts\_}.\\
\item
  Load the \href{https://github.com/UHERO/fcutils}{fcutils package} for
  utility functions.\\
\item
  Forecasting with multi-equation behavioral models: only the
  \href{https://cran.r-project.org/web/packages/bimets/index.html}{load
  bimets} pakage if actually doing forecasts, no need for data
  manipulation.\\
\item
  bimets depends on the \href{http://joshuaulrich.github.io/xts/}{xts
  package} (if not loaded, can access necessary functions via
  \texttt{xts::function()}). Prefer using tsbox and tidyverse functions
  whenever possible, but understand the components and behavior of xts
  objects.\\
\end{itemize}

\bookmarksetup{startatroot}

\chapter{Utility functions}\label{sec-utils}

This section describes utility functions that facilitate common
operations on time series data. These functions perform frequency
conversion, growth rate conversion, time series arithmetic and
combination, plot generation, etc.

The R ecosystem knows a vast number of time series classes: ts, xts,
zoo, tsibble, tibbletime, tis, or timeSeries. The plethora of standards
causes confusion. As different packages rely on different classes, it is
hard to use them in the same analysis. The
\href{https://docs.ropensci.org/tsbox/}{tsbox package} provides a set of
tools that make it easy to switch between these classes. It also allows
the user to treat time series as plain data frames, facilitating the use
with tools that assume rectangular data. In each section below functions
from the tsbox package are listed first followed by functions from the
\href{https://github.com/UHERO/fcutils}{fcutils package}. The
\href{https://github.com/uhero/uherotheme}{uherotheme package} contains
functions to apply the UHERO style guide to plots made with
\href{https://ggplot2.tidyverse.org/}{ggplot}. These functions are
listed under Section~\ref{sec-plots}.

\section{Input-output and data generation}\label{sec-io}

\subsection{fcutils::get\_series()}\label{fcutilsget_series}

\subsubsection{Description}\label{description}

Download a set of series from udaman using series names

\subsubsection{Usage}\label{usage}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{get\_series}\NormalTok{(}
\NormalTok{  ser\_id\_vec,}
  \AttributeTok{format =} \StringTok{"wide"}\NormalTok{,}
\NormalTok{  expand,}
  \AttributeTok{raw =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{rename =} \StringTok{"compact"}\NormalTok{,}
  \AttributeTok{freq =} \ConstantTok{NULL}\NormalTok{,}
  \AttributeTok{descr =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{public =} \ConstantTok{FALSE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{ser\_id\_vec} & vector of series names (character) \\
\texttt{format} & "wide" (default) or "long" or "xts" \\
\texttt{expand} & DEPRECATED, USE raw INSTEAD "true" (default) or "raw"
("true" downloads formatted data, "raw" downloads raw units) \\
\texttt{raw} & TRUE (default) or FALSE (TRUE downloads raw data, FALSE
downloads scaled and rounded data) \\
\texttt{rename} & "compact" (default), "full", "no". "compact": @
replaced by \_ and no frequency; "full": @ replaced by \emph{AT} and .
by \_; "no": no renaming, keep UDAMAN names \\
\texttt{freq} & if frequency is missing from series names (or want to
modify freq in existing names) specify frequency (character),
e.g.~"M". \\
\texttt{descr} & if TRUE add to the udaman series name the series
description in parentheses (default: FALSE) \\
\texttt{public} & if TRUE use the public API interface - does not
require VPN (default: FALSE) \\
\end{longtable}

\subsubsection{Details}\label{details}

This function requires permission to access UDAMAN. Store the udaman
token in the .Renviron file using the following format: udaman\_token =
"-ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890=" Or using
fcutils::set\_udaman\_token("-ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890=") Or
store the udaman token among your credentials (e.g.~keychain) using
keyring: keyring::key\_set\_with\_value(service = "udaman\_token",
password = "-ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890=")

\subsubsection{Value}\label{value}

time and data for all series combined in an object specified by the
format option

\subsubsection{Examples}\label{examples}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{get\_series}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"VISNS@HI.M"}\NormalTok{, }\StringTok{"VAPNS@HI.M"}\NormalTok{), }\AttributeTok{raw =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{get\_series}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"VEXP\_RB@HI.M"}\NormalTok{))}
\FunctionTok{get\_series}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"VISNS@HI.M"}\NormalTok{, }\StringTok{"VAPNS@HI.M"}\NormalTok{), }\AttributeTok{public =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{get\_series}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"VISNS@HI.M"}\NormalTok{, }\StringTok{"VISUSNS@HI.M"}\NormalTok{), }\AttributeTok{freq =} \StringTok{"Q"}\NormalTok{)}
\FunctionTok{get\_series}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"VISNS@HI.M"}\NormalTok{, }\StringTok{"VAPNS@HI.M"}\NormalTok{), }\AttributeTok{format =} \StringTok{"xts"}\NormalTok{)}
\FunctionTok{get\_series}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"VISNS@HI.M"}\NormalTok{), }\AttributeTok{format =} \StringTok{"xts"}\NormalTok{)}
\FunctionTok{get\_series}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"VISNS@HI.M"}\NormalTok{), }\AttributeTok{format =} \StringTok{"xts"}\NormalTok{, }\AttributeTok{descr =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{get\_series}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"E\_NF\_HI"}\NormalTok{, }\StringTok{"ECT\_HI"}\NormalTok{, }\StringTok{"E\_TU\_HAW"}\NormalTok{), }\AttributeTok{freq =} \StringTok{"M"}\NormalTok{)}
\FunctionTok{get\_series}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"E\_NF\_\_HI\_M"}\NormalTok{, }\StringTok{"ECT\_\_HI\_M"}\NormalTok{, }\StringTok{"VAP\_\_HI\_W"}\NormalTok{))}
\FunctionTok{get\_series}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"E\_NF\_AT\_HI\_M"}\NormalTok{, }\StringTok{"ECT\_AT\_HI\_M"}\NormalTok{, }\StringTok{"VAP\_AT\_HI\_W"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::get\_series\_exp()}\label{fcutilsget_series_exp}

\subsubsection{Description}\label{description-1}

Download series listed in an export table from udaman

\subsubsection{Usage}\label{usage-1}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{get\_series\_exp}\NormalTok{(}
\NormalTok{  exp\_id,}
  \AttributeTok{format =} \StringTok{"wide"}\NormalTok{,}
\NormalTok{  expand,}
  \AttributeTok{raw =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{rename =} \StringTok{"compact"}\NormalTok{,}
  \AttributeTok{descr =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{public =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{save\_loc =} \ConstantTok{NULL}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-1}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{exp\_id} & export id (character or numeric) \\
\texttt{format} & "wide" (default) or "long" or "xts" \\
\texttt{expand} & DEPRECATED, USE raw INSTEAD "true" or "raw" ("true"
downloads formatted data, "raw" downloads raw units) \\
\texttt{raw} & TRUE (default) or FALSE (TRUE downloads raw data, FALSE
downloads scaled and rounded data) \\
\texttt{rename} & "compact" (default), "full", "no". "compact": @
replaced by \_ and no frequency; "full": @ replaced by \emph{AT} and .
by \_; "no": no renaming, keep UDAMAN names \\
\texttt{descr} & if TRUE add to the udaman series name the series
description in parentheses (default: FALSE) \\
\texttt{public} & if TRUE use the public API interface - does not
require VPN (default: FALSE) \\
\texttt{save\_loc} & file path for saving data incl.~extension ("html"
or "csv") (default NULL) \\
\end{longtable}

\subsubsection{Details}\label{details-1}

This function requires permission to access UDAMAN. Store the udaman
token in the .Renviron file using the following format: udaman\_token =
"-ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890=" Or using
fcutils::set\_udaman\_token("-ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890=") Or
store the udaman token among your credentials (e.g.~keychain) using
keyring: keyring::key\_set\_with\_value(service = "udaman\_token",
password = "-ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890=")

\subsubsection{Value}\label{value-1}

time and data for all series combined in a tibble

\subsubsection{Examples}\label{examples-1}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{get\_series\_exp}\NormalTok{(}\AttributeTok{exp\_id =} \DecValTok{74}\NormalTok{)}
\FunctionTok{get\_series\_exp}\NormalTok{(}\DecValTok{74}\NormalTok{, }\AttributeTok{format =} \StringTok{"xts"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::set\_udaman\_token()}\label{fcutilsset_udaman_token}

\subsubsection{Description}\label{description-2}

Set udaman token for API access

\subsubsection{Usage}\label{usage-2}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set\_udaman\_token}\NormalTok{(key)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-2}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{key} & a string containing 44 characters \\
\end{longtable}

\subsubsection{Details}\label{details-2}

Save the token in .Renviron as udaman\_token = key.

\subsubsection{Value}\label{value-2}

true if setting the token in .Renviron succeeded

\subsubsection{Examples}\label{examples-2}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set\_udaman\_token}\NormalTok{(}\StringTok{"{-}ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890="}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::make\_xts()}\label{fcutilsmake_xts}

\subsubsection{Description}\label{description-3}

Create xts and fill with values

\subsubsection{Usage}\label{usage-3}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{make\_xts}\NormalTok{(}\AttributeTok{start =}\NormalTok{ bnk\_start, }\AttributeTok{end =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{per =} \StringTok{"year"}\NormalTok{, }\AttributeTok{val =} \ConstantTok{NA\_real\_}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-3}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{start} & date of series start (character: "yyyy-mm-dd",
"yyyyqq", "yyyy") \\
\texttt{end} & date of series end (character: "yyyy-mm-dd", "yyyyqq",
"yyyy") \\
\texttt{per} & periodicity of series (character: "year" - default) if
date format of start is quarterly, automatically set to "quarter" \\
\texttt{val} & values to fill in (numeric scalar, vector, or tibble) \\
\end{longtable}

\subsubsection{Details}\label{details-3}

when end is missing, but val is a vector of more than one element, the
end date is automatically determined by the length of the val vector. if
end is missing and val is a scalar, the end date is set to bnk\_end. if
end is missing the remaining arguments have to be named. if val is a
tibble, the end date is automatically determined by the number of rows
in the tibble.

\subsubsection{Value}\label{value-3}

an xts series

\subsubsection{Examples}\label{examples-3}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{make\_xts}\NormalTok{()}
\FunctionTok{make\_xts}\NormalTok{(}\AttributeTok{val =} \DecValTok{0}\NormalTok{, }\AttributeTok{per =} \StringTok{"m"}\NormalTok{)}
\FunctionTok{make\_xts}\NormalTok{(}\AttributeTok{start =} \DecValTok{20100101}\NormalTok{, }\AttributeTok{per =} \StringTok{"quarter"}\NormalTok{, }\AttributeTok{val =} \DecValTok{0}\NormalTok{)}
\FunctionTok{make\_xts}\NormalTok{(}\AttributeTok{start =} \FloatTok{2010.1}\NormalTok{, }\AttributeTok{per =} \StringTok{"q"}\NormalTok{, }\AttributeTok{val =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\FunctionTok{make\_xts}\NormalTok{(}\FloatTok{2010.1}\NormalTok{, }\AttributeTok{val =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{) }\DocumentationTok{\#\# automatically set per = "quarter"}
\FunctionTok{make\_xts}\NormalTok{(}\AttributeTok{start =} \StringTok{"2010{-}01{-}01"}\NormalTok{, }\AttributeTok{per =} \StringTok{"m"}\NormalTok{, }\AttributeTok{val =} \DecValTok{0}\NormalTok{)}
\FunctionTok{make\_xts}\NormalTok{(}\AttributeTok{start =} \DecValTok{201001}\NormalTok{, }\AttributeTok{per =} \StringTok{"q"}\NormalTok{,}
         \AttributeTok{val =}\NormalTok{ tibble}\SpecialCharTok{::}\FunctionTok{tibble}\NormalTok{(}\AttributeTok{E\_NF\_HON =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{), }\AttributeTok{ECT\_HI =} \FunctionTok{c}\NormalTok{(}\DecValTok{11}\SpecialCharTok{:}\DecValTok{20}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::addf()}\label{fcutilsaddf}

\subsubsection{Description}\label{description-4}

Create xts addfactor

\subsubsection{Usage}\label{usage-4}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{addf}\NormalTok{(}
  \AttributeTok{start =}\NormalTok{ bnk\_start,}
  \AttributeTok{end =}\NormalTok{ bnk\_end,}
  \AttributeTok{from =} \DecValTok{0}\NormalTok{,}
  \AttributeTok{to =} \DecValTok{0}\NormalTok{,}
  \AttributeTok{ser\_name =} \StringTok{"value"}\NormalTok{,}
  \AttributeTok{per =} \StringTok{"year"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-4}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{start} & start date of linear interpolation (character:
"yyyy-mm-dd", "yyyyqq", "yyyy") \\
\texttt{end} & end date of linear interpolation (character:
"yyyy-mm-dd", "yyyyqq", "yyyy") \\
\texttt{from} & first value for linear interpolation (numeric) \\
\texttt{to} & last value for linear interpolation (numeric) \\
\texttt{ser\_name} & name of the xts series (string) \\
\texttt{per} & periodicity of series (character: "year" - default) if
date format of start is quarterly, automatically set to "quarter" \\
\end{longtable}

\subsubsection{Details}\label{details-4}

this is a wrapper around make\_xts with some additional functionality.
the start and end dates specify the span of the non-zero add-factor
value. the remaining period between start and end is filled with zeros.

\subsubsection{Value}\label{value-4}

a single xts series spanning bnk\_start-bnk\_end

\subsubsection{Examples}\label{examples-4}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{addf}\NormalTok{()}
\FunctionTok{addf}\NormalTok{(}\DecValTok{201002}\NormalTok{, }\DecValTok{201504}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\FunctionTok{addf}\NormalTok{(}\DecValTok{20100101}\NormalTok{, }\DecValTok{20601201}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\AttributeTok{per =} \StringTok{"month"}\NormalTok{)}
\FunctionTok{addf}\NormalTok{(}\DecValTok{20100101}\NormalTok{, }\AttributeTok{from =} \DecValTok{1}\NormalTok{, }\AttributeTok{to =} \DecValTok{2}\NormalTok{, }\AttributeTok{per =} \StringTok{"quarter"}\NormalTok{)}
\FunctionTok{addf}\NormalTok{(}\FloatTok{2010.2}\NormalTok{, }\FloatTok{2015.4}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\StringTok{"ECT\_HI"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::copy\_tbl()}\label{fcutilscopy_tbl}

\subsubsection{Description}\label{description-5}

Copy a data frame to clipboard (only works on MacOS)

\subsubsection{Usage}\label{usage-5}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{copy\_tbl}\NormalTok{(x, }\AttributeTok{dec =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-5}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & tibble (or data frame) to be copied \\
\texttt{dec} & number of decimals to round numeric columns to (default:
2) \\
\end{longtable}

\subsubsection{Value}\label{value-5}

copy\_tbl() returns the input x invisibly

\subsubsection{Examples}\label{examples-5}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}} \FunctionTok{copy\_tbl}\NormalTok{()}
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}} \FunctionTok{copy\_tbl}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::gen\_table()}\label{fcutilsgen_table}

\subsubsection{Description}\label{description-6}

Generate a table with time series

\subsubsection{Usage}\label{usage-6}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{gen\_table}\NormalTok{(}
\NormalTok{  x,}
  \AttributeTok{tbl\_start =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{10}\NormalTok{)),}
  \AttributeTok{tbl\_end =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{+}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{2}\NormalTok{)),}
  \AttributeTok{percent =} \StringTok{"pc"}\NormalTok{,}
  \AttributeTok{time\_across =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{tbl\_height =} \DecValTok{800}\NormalTok{,}
  \AttributeTok{save\_loc =} \ConstantTok{NULL}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-6}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & a ts-boxable object \\
\texttt{tbl\_start} & start period for table \\
\texttt{tbl\_end} & end period for table \\
\texttt{percent} & what type of percent should be added ("none", "pc"
(default), "pcy", "pca") \\
\texttt{time\_across} & should time be in column headers and variable
names in first column (default TRUE) \\
\texttt{tbl\_height} & the height of the table in px (default 800) \\
\texttt{save\_loc} & file path for saving table incl.~extension ("html"
or "csv") (default NULL) \\
\end{longtable}

\subsubsection{Value}\label{value-6}

table formatted for output

\subsubsection{Examples}\label{examples-6}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_tslist}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{gen\_table}\NormalTok{()}
\FunctionTok{gen\_table}\NormalTok{(quarterly\_data\_example)}
\FunctionTok{gen\_table}\NormalTok{(quarterly\_data\_example, }\AttributeTok{percent =} \StringTok{"none"}\NormalTok{)}
\FunctionTok{gen\_table}\NormalTok{(quarterly\_data\_example, }\AttributeTok{percent =} \StringTok{"pcy"}\NormalTok{, }\AttributeTok{time\_across =} \ConstantTok{FALSE}\NormalTok{)}

\FunctionTok{gen\_table}\NormalTok{(quarterly\_data\_example,}
  \AttributeTok{percent =} \StringTok{"pcy"}\NormalTok{,}
  \AttributeTok{time\_across =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{save\_loc =} \StringTok{"\textasciitilde{}/Downloads/temp.csv"}
\NormalTok{)}
\FunctionTok{gen\_table}\NormalTok{(quarterly\_data\_example,}
  \AttributeTok{percent =} \StringTok{"pcy"}\NormalTok{, }\AttributeTok{time\_across =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{save\_loc =} \StringTok{"\textasciitilde{}/Downloads/temp.html"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::write\_tsd()}\label{fcutilswrite_tsd}

\subsubsection{Description}\label{description-7}

Save a ts-boxable object in tsd format

\subsubsection{Usage}\label{usage-7}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{write\_tsd}\NormalTok{(x, file)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-7}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & a ts-boxable object (only M, Q, A frequency) \\
\texttt{file} & character string denoting the location and name of the
output file \\
\end{longtable}

\subsubsection{Value}\label{value-7}

nothing (silently save the contents of the tsd file to a user defined
location)

\subsubsection{Examples}\label{examples-7}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}} \FunctionTok{write\_tsd}\NormalTok{(}\StringTok{"out.tsd"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\section{Time series info and date manipulation}\label{sec-tsinfo}

\subsection{tsbox::ts\_summary()}\label{tsboxts_summary}

\subsubsection{Description}\label{description-8}

Extract time series properties, such as the number of observations
(\texttt{obs}), the time differences between observations
(\texttt{obs}), the number of observations per year (\texttt{freq}), and
the start time stamp (\texttt{start}) and the end time stamp
(\texttt{end}) of the series.

\subsubsection{Usage}\label{usage-8}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_summary}\NormalTok{(x, }\AttributeTok{spark =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-8}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{spark} & logical should an additional column with a spark-line
added to the data frame (experimental, ASCII only on Windows.) \\
\end{longtable}

\subsubsection{Value}\label{value-8}

\texttt{ts\_summary} returns a \texttt{data.frame}. Individual column
can be accessed through the \texttt{\$} notation (see examples).

\subsubsection{Examples}\label{examples-8}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_summary}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(mdeaths, austres))}
\FunctionTok{ts\_summary}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(mdeaths, austres), }\AttributeTok{spark =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\# Extracting specific properties}
\FunctionTok{ts\_summary}\NormalTok{(AirPassengers)}\SpecialCharTok{$}\NormalTok{start}
\FunctionTok{ts\_summary}\NormalTok{(AirPassengers)}\SpecialCharTok{$}\NormalTok{freq}
\FunctionTok{ts\_summary}\NormalTok{(AirPassengers)}\SpecialCharTok{$}\NormalTok{obs}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_first\_of\_period()}\label{tsboxts_first_of_period}

\subsubsection{Description}\label{description-9}

Replace date or time values by the first of the period. tsbox usually
relies on timestamps being the first value of a period.

\subsubsection{Usage}\label{usage-9}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_first\_of\_period}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-9}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\end{longtable}

\subsubsection{Value}\label{value-9}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{Examples}\label{examples-9}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{ts\_c}\NormalTok{(}
  \AttributeTok{a =} \FunctionTok{ts\_lag}\NormalTok{(}\FunctionTok{ts\_df}\NormalTok{(mdeaths), }\StringTok{"14 days"}\NormalTok{),}
  \AttributeTok{b =} \FunctionTok{ts\_lag}\NormalTok{(}\FunctionTok{ts\_df}\NormalTok{(mdeaths), }\StringTok{"{-}2 days"}\NormalTok{)}
\NormalTok{)}
\FunctionTok{ts\_first\_of\_period}\NormalTok{(x)}
\FunctionTok{ts\_first\_of\_period}\NormalTok{(}\FunctionTok{ts\_lag}\NormalTok{(}\FunctionTok{ts\_df}\NormalTok{(austres), }\StringTok{"14 days"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_regular()}\label{tsboxts_regular}

\subsubsection{Description}\label{description-10}

Enforces regularity in data frame and \texttt{xts} objects, by turning
implicit \texttt{NA}s into explicit \texttt{NA}s. In \texttt{ts}
objects, regularity is automatically enforced.

\subsubsection{Usage}\label{usage-10}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_regular}\NormalTok{(x, }\AttributeTok{fill =} \ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-10}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{fill} & numeric, instead of \texttt{NA}, an alternative value
can be specified. E.g., 0, -99. \\
\end{longtable}

\subsubsection{Value}\label{value-10}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{Examples}\label{examples-10}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x0 }\OtherTok{\textless{}{-}}\NormalTok{ AirPassengers}
\NormalTok{x0[}\FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{15}\NormalTok{)] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{ts\_na\_omit}\NormalTok{(}\FunctionTok{ts\_dts}\NormalTok{(x0))}
\FunctionTok{ts\_regular}\NormalTok{(x)}
\FunctionTok{ts\_regular}\NormalTok{(x, }\AttributeTok{fill =} \DecValTok{0}\NormalTok{)}

\NormalTok{m }\OtherTok{\textless{}{-}}\NormalTok{ mdeaths}
\NormalTok{m[}\FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{69}\NormalTok{)] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{f }\OtherTok{\textless{}{-}}\NormalTok{ fdeaths}
\NormalTok{f[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{15}\NormalTok{)] }\OtherTok{\textless{}{-}} \ConstantTok{NA}

\FunctionTok{ts\_regular}\NormalTok{(}\FunctionTok{ts\_na\_omit}\NormalTok{(}\FunctionTok{ts\_dts}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(f, m))))}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_na\_omit()}\label{tsboxts_na_omit}

\subsubsection{Description}\label{description-11}

Remove NA values in ts-boxable objects, turning explicit into implicit
missing values.

\subsubsection{Usage}\label{usage-11}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_na\_omit}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-11}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\end{longtable}

\subsubsection{Details}\label{details-5}

Note that internal NAs in \texttt{ts} time series will not be removed,
as this conflicts with the regular structure.

\subsubsection{Value}\label{value-11}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{See Also}\label{see-also}

ts\_regular, for the opposite, turning implicit into explicit missing
values.

\subsubsection{Examples}\label{examples-11}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ AirPassengers}
\NormalTok{x[}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{)] }\OtherTok{\textless{}{-}} \ConstantTok{NA}

\DocumentationTok{\#\# A ts object does only know explicit NAs}
\FunctionTok{ts\_na\_omit}\NormalTok{(x)}

\DocumentationTok{\#\# by default, NAs are implicit in data frames}
\FunctionTok{ts\_df}\NormalTok{(x)}

\DocumentationTok{\#\# make NAs explicit}
\FunctionTok{ts\_regular}\NormalTok{(}\FunctionTok{ts\_df}\NormalTok{(x))}

\DocumentationTok{\#\# and implicit again}
\FunctionTok{ts\_na\_omit}\NormalTok{(}\FunctionTok{ts\_regular}\NormalTok{(}\FunctionTok{ts\_df}\NormalTok{(x)))}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_span()}\label{tsboxts_span}

\subsubsection{Description}\label{description-12}

Filter time series for a time span.

\subsubsection{Usage}\label{usage-12}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_span}\NormalTok{(x, }\AttributeTok{start =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{end =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{template =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{extend =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-12}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{start} & start date, character string of length 1, \texttt{Date}
or \texttt{POSIXct} \\
\texttt{end} & end date, character string of length 1, \texttt{Date} or
\texttt{POSIXct}. \\
\texttt{template} & ts-boxable time series, an object of class
\texttt{ts}, \texttt{xts}, \texttt{data.frame}, \texttt{data.table}, or
\texttt{tibble}. If provided, \texttt{from} and \texttt{to} will be
extracted from the object. \\
\texttt{extend} & logical. If true, the start and end values are allowed
to extend the series (by adding \texttt{NA} values). \\
\end{longtable}

\subsubsection{Details}\label{details-6}

All date and times, when entered as character strings, are processed by
\texttt{anytime::anydate()} or \texttt{anytime::anytime()}. Thus a wide
range of inputs are possible. See examples.

\texttt{start} and \texttt{end} can be specified relative to each other,
using one of \texttt{"sec"}, \texttt{"min"}, \texttt{"hour"},
\texttt{"day"}, \texttt{"week"}, \texttt{"month"},
\texttt{⁠"quarter"\ or\ ⁠}"year", or an abbreviation. If the series are of
the same frequency, the shift can be specified in periods. See examples.

\subsubsection{Value}\label{value-12}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{Examples}\label{examples-12}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# use \textquotesingle{}anytime\textquotesingle{} shortcuts}
\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{start =} \StringTok{"1979"}\NormalTok{)       }\DocumentationTok{\#\# shortcut for 1979{-}01{-}01}
\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{start =} \StringTok{"1979{-}4"}\NormalTok{)     }\DocumentationTok{\#\# shortcut for 1979{-}04{-}01}
\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{start =} \StringTok{"197904"}\NormalTok{)     }\DocumentationTok{\#\# shortcut for 1979{-}04{-}01}

\DocumentationTok{\#\# it\textquotesingle{}s fine to use an to date outside of series span}
\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{end =} \StringTok{"2001{-}01{-}01"}\NormalTok{)}

\DocumentationTok{\#\# use strings to set start or end relative to each other}

\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{start =} \StringTok{"{-}7 month"}\NormalTok{)   }\DocumentationTok{\#\# last 7 months}
\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{start =} \SpecialCharTok{{-}}\DecValTok{7}\NormalTok{)           }\DocumentationTok{\#\# last 7 periods}
\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{start =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)           }\DocumentationTok{\#\# last single value}
\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{end =} \StringTok{"1e4 hours"}\NormalTok{)    }\DocumentationTok{\#\# first 10000 hours}


\FunctionTok{ts\_plot}\NormalTok{(}
  \FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{start =} \StringTok{"{-}3 years"}\NormalTok{),}
  \AttributeTok{title =} \StringTok{"Three years ago"}\NormalTok{,}
  \AttributeTok{subtitle =} \StringTok{"The last three years of available data"}
\NormalTok{)}

\FunctionTok{ts\_ggplot}\NormalTok{(}
  \FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{end =} \StringTok{"28 weeks"}\NormalTok{),}
  \AttributeTok{title =} \StringTok{"28 weeks later"}\NormalTok{,}
  \AttributeTok{subtitle =} \StringTok{"The first 28 weeks of available data"}
\NormalTok{) }\SpecialCharTok{+} \FunctionTok{theme\_tsbox}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{scale\_color\_tsbox}\NormalTok{()}


\DocumentationTok{\#\# Limit span of \textquotesingle{}discoveries\textquotesingle{} to the same span as \textquotesingle{}AirPassengers\textquotesingle{}}
\FunctionTok{ts\_span}\NormalTok{(discoveries, }\AttributeTok{template =}\NormalTok{ AirPassengers)}
\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{end =} \StringTok{"19801201"}\NormalTok{, }\AttributeTok{extend =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::span()}\label{fcutilsspan}

\subsubsection{Description}\label{description-13}

Specify span of time series (wrapper around tsbox::ts\_span())

\subsubsection{Usage}\label{usage-13}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{span}\NormalTok{(x, }\AttributeTok{start =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{end =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{template =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{extend =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-13}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object to filter by span \\
\texttt{start} & start date (see examples) \\
\texttt{end} & end date (see examples) \\
\texttt{template} & ts-boxable time series (see tsbox::ts\_span) \\
\texttt{extend} & logical. If true, the start and end values are allowed
to extend the series (by adding NA values). \\
\end{longtable}

\subsubsection{Value}\label{value-13}

filtered object of the same type as the input

\subsubsection{Examples}\label{examples-13}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{span}\NormalTok{(}\FloatTok{2010.1}\NormalTok{)}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{span}\NormalTok{(}\FloatTok{2010.1}\NormalTok{, }\FloatTok{2010.4}\NormalTok{)}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{span}\NormalTok{(}\StringTok{"2010{-}01{-}01"}\NormalTok{, }\StringTok{"2010{-}12{-}31"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::find\_start()}\label{fcutilsfind_start}

\subsubsection{Description}\label{description-14}

Find the date of the first observation (NAs are dropped)

\subsubsection{Usage}\label{usage-14}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{find\_start}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-14}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object \\
\end{longtable}

\subsubsection{Value}\label{value-14}

dates associated with first observation

\subsubsection{Examples}\label{examples-14}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{E\_NF\_HI =}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{if\_else}\NormalTok{(time }\SpecialCharTok{\textless{}} \StringTok{"2000{-}01{-}01"}\NormalTok{, }\ConstantTok{NA\_real\_}\NormalTok{, E\_NF\_HI)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{find\_start}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::find\_end()}\label{fcutilsfind_end}

\subsubsection{Description}\label{description-15}

Find the date of the last observation (NAs are dropped)

\subsubsection{Usage}\label{usage-15}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{find\_end}\NormalTok{(x, }\AttributeTok{last\_day =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-15}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object \\
\texttt{last\_day} & should the last day of period be returned (default:
FALSE) \\
\end{longtable}

\subsubsection{Value}\label{value-15}

date associated with last observation

\subsubsection{Examples}\label{examples-15}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{E\_NF\_HI =}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{if\_else}\NormalTok{(time }\SpecialCharTok{\textgreater{}} \StringTok{"2022{-}01{-}01"}\NormalTok{, }\ConstantTok{NA\_real\_}\NormalTok{, E\_NF\_HI)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{find\_end}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{E\_NF\_HI =}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{if\_else}\NormalTok{(time }\SpecialCharTok{\textgreater{}} \StringTok{"2022{-}01{-}01"}\NormalTok{, }\ConstantTok{NA\_real\_}\NormalTok{, E\_NF\_HI)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{find\_end}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::nmons()}\label{fcutilsnmons}

\subsubsection{Description}\label{description-16}

Calculate number of months between two dates yyyyMm, yyyy.m or
yyyy-mm-dd

\subsubsection{Usage}\label{usage-16}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nmons}\NormalTok{(}\AttributeTok{dat1 =} \StringTok{""}\NormalTok{, }\AttributeTok{dat2 =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-16}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{dat1} & date of period start (string: yyyyMm, yyyy.m, or
yyyy-mm-dd) \\
\texttt{dat2} & date of period end (string: yyyyMm, yyyy.m, or
yyyy-mm-dd) \\
\end{longtable}

\subsubsection{Details}\label{details-7}

The endpoints are included in the result so subtract one for time
difference. Also, the result is rounded down so partial months are not
counted. See examples.

\subsubsection{Value}\label{value-16}

numeric length of date range in months

\subsubsection{Examples}\label{examples-16}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nmons}\NormalTok{(}\StringTok{"2010M1"}\NormalTok{, }\StringTok{"2010M2"}\NormalTok{)}
\FunctionTok{nmons}\NormalTok{(}\FloatTok{2010.1}\NormalTok{, }\FloatTok{2010.4}\NormalTok{)}
\FunctionTok{nmons}\NormalTok{(}\StringTok{"2010{-}01{-}15"}\NormalTok{, }\StringTok{"2010{-}04{-}15"}\NormalTok{)}
\FunctionTok{nmons}\NormalTok{(}\StringTok{"2010{-}01{-}15"}\NormalTok{, }\StringTok{"2010{-}04{-}18"}\NormalTok{)}
\FunctionTok{nmons}\NormalTok{(}\StringTok{"2010{-}01{-}15"}\NormalTok{, }\StringTok{"2010{-}04{-}12"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::nqtrs()}\label{fcutilsnqtrs}

\subsubsection{Description}\label{description-17}

Calculate number of quarters between two dates yyyyQq, yyyy.q or
yyyy-mm-dd

\subsubsection{Usage}\label{usage-17}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nqtrs}\NormalTok{(}\AttributeTok{dat1 =} \StringTok{""}\NormalTok{, }\AttributeTok{dat2 =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-17}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{dat1} & date of period start (string: yyyyQq, yyyy.q, or
yyyy-mm-dd) \\
\texttt{dat2} & date of period end (string: yyyyQq, yyyy.q, or
yyyy-mm-dd) \\
\end{longtable}

\subsubsection{Details}\label{details-8}

The endpoints are included in the result so subtract one for time
difference. Also, the result is rounded down so partial quarters are not
counted. See examples.

\subsubsection{Value}\label{value-17}

numeric length of date range in quarters

\subsubsection{Examples}\label{examples-17}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nqtrs}\NormalTok{(}\StringTok{"2010Q1"}\NormalTok{, }\StringTok{"2020Q4"}\NormalTok{)}
\FunctionTok{nqtrs}\NormalTok{(}\FloatTok{2010.1}\NormalTok{, }\FloatTok{2020.4}\NormalTok{)}
\FunctionTok{nqtrs}\NormalTok{(}\StringTok{"2010{-}01{-}01"}\NormalTok{, }\StringTok{"2020{-}10{-}01"}\NormalTok{)}
\FunctionTok{nqtrs}\NormalTok{(}\StringTok{"2010{-}02{-}01"}\NormalTok{, }\StringTok{"2020{-}11{-}01"}\NormalTok{)}
\FunctionTok{nqtrs}\NormalTok{(}\StringTok{"2010{-}02{-}01"}\NormalTok{, }\StringTok{"2020{-}10{-}01"}\NormalTok{)}
\FunctionTok{nqtrs}\NormalTok{(}\StringTok{"2010{-}01{-}01"}\NormalTok{, }\StringTok{"2020{-}11{-}01"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::qtrs()}\label{fcutilsqtrs}

\subsubsection{Description}\label{description-18}

Convert period in quarters to period in months

\subsubsection{Usage}\label{usage-18}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{qtrs}\NormalTok{(nr\_quarters)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-18}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{nr\_quarters} & number of quarters in period (integer) \\
\end{longtable}

\subsubsection{Value}\label{value-18}

number of months in period

\subsubsection{Examples}\label{examples-18}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{qtrs}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\NormalTok{lubridate}\SpecialCharTok{::}\FunctionTok{ymd}\NormalTok{(}\StringTok{"2020{-}01{-}01"}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{qtrs}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::p()}\label{fcutilsp}

\subsubsection{Description}\label{description-19}

Concatenate dates to obtain period

\subsubsection{Usage}\label{usage-19}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{p}\NormalTok{(}\AttributeTok{dat1 =} \StringTok{""}\NormalTok{, }\AttributeTok{dat2 =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-19}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{dat1} & date of period start (string: see examples) \\
\texttt{dat2} & date of period end (string: see examples) \\
\end{longtable}

\subsubsection{Value}\label{value-19}

string containing date range

\subsubsection{Examples}\label{examples-19}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{p}\NormalTok{(}\StringTok{"2010{-}01{-}01"}\NormalTok{, }\StringTok{"2020{-}01{-}01"}\NormalTok{)}
\FunctionTok{p}\NormalTok{(}\DecValTok{20100101}\NormalTok{, }\DecValTok{20200101}\NormalTok{)}
\FunctionTok{p}\NormalTok{(}\FloatTok{2010.1}\NormalTok{, }\FloatTok{2020.4}\NormalTok{)}
\FunctionTok{p}\NormalTok{(,}\FloatTok{2020.4}\NormalTok{)}
\FunctionTok{p}\NormalTok{(}\StringTok{"2010Q1"}\NormalTok{, }\StringTok{"2020Q4"}\NormalTok{)}
\FunctionTok{p}\NormalTok{(}\DecValTok{2010}\NormalTok{, }\DecValTok{2020}\NormalTok{) }\DocumentationTok{\#\# for annual period only}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::pm()}\label{fcutilspm}

\subsubsection{Description}\label{description-20}

Concatenate dates formatted as yyyyMm or yyyy.m to obtain period

\subsubsection{Usage}\label{usage-20}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{pm}\NormalTok{(}\AttributeTok{dat1 =} \StringTok{""}\NormalTok{, }\AttributeTok{dat2 =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-20}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{dat1} & date of period start (string: yyyyMm or yyyy.m) \\
\texttt{dat2} & date of period end (string: yyyyMm or yyyy.m) \\
\end{longtable}

\subsubsection{Value}\label{value-20}

string containing date range

\subsubsection{Examples}\label{examples-20}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{pm}\NormalTok{(}\StringTok{"2010M1"}\NormalTok{, }\StringTok{"2020M4"}\NormalTok{)}
\FunctionTok{pm}\NormalTok{(}\FloatTok{2010.1}\NormalTok{, }\FloatTok{2020.4}\NormalTok{)}
\FunctionTok{pm}\NormalTok{(}\FloatTok{2010.1}\NormalTok{, )}
\FunctionTok{pm}\NormalTok{(, }\FloatTok{2010.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::pq()}\label{fcutilspq}

\subsubsection{Description}\label{description-21}

Concatenate dates formatted as yyyyQq or yyyy.q to obtain period

\subsubsection{Usage}\label{usage-21}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{pq}\NormalTok{(}\AttributeTok{dat1 =} \StringTok{""}\NormalTok{, }\AttributeTok{dat2 =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-21}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{dat1} & date of period start (string: yyyyQq or yyyy.q) \\
\texttt{dat2} & date of period end (string: yyyyQq or yyyy.q) \\
\end{longtable}

\subsubsection{Value}\label{value-21}

string containing date range

\subsubsection{Examples}\label{examples-21}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{pq}\NormalTok{(}\StringTok{"2010Q1"}\NormalTok{, }\StringTok{"2020Q4"}\NormalTok{)}
\FunctionTok{pq}\NormalTok{(}\FloatTok{2010.1}\NormalTok{, }\FloatTok{2020.4}\NormalTok{)}
\FunctionTok{pq}\NormalTok{(}\FloatTok{2010.1}\NormalTok{, )}
\FunctionTok{pq}\NormalTok{(, }\FloatTok{2010.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::py()}\label{fcutilspy}

\subsubsection{Description}\label{description-22}

Concatenate dates formatted as yyyy to obtain period

\subsubsection{Usage}\label{usage-22}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{py}\NormalTok{(}\AttributeTok{dat1 =} \StringTok{""}\NormalTok{, }\AttributeTok{dat2 =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-22}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{dat1} & year of period start (string or numeric: yyyy) \\
\texttt{dat2} & year of period end (string or numeric: yyyy) \\
\end{longtable}

\subsubsection{Value}\label{value-22}

string containing date range

\subsubsection{Examples}\label{examples-22}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{py}\NormalTok{(}\StringTok{"2010"}\NormalTok{, }\StringTok{"2020"}\NormalTok{)}
\FunctionTok{py}\NormalTok{(}\DecValTok{2010}\NormalTok{, }\DecValTok{2020}\NormalTok{)}
\FunctionTok{py}\NormalTok{(}\DecValTok{2010}\NormalTok{, )}
\FunctionTok{py}\NormalTok{(, }\DecValTok{2010}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::to\_ymd()}\label{fcutilsto_ymd}

\subsubsection{Description}\label{description-23}

Parse strings into dates in yyyy-mm-dd format

\subsubsection{Usage}\label{usage-23}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{to\_ymd}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-23}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & string (string: yyyymmdd, yyyyqq, yyyy.q, yyyy) \\
\end{longtable}

\subsubsection{Value}\label{value-23}

formatted dates (yyyy-mm-dd)

\subsubsection{Examples}\label{examples-23}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{to\_ymd}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"2010.0211"}\NormalTok{, }\DecValTok{202002}\NormalTok{, }\FloatTok{2020.2}\NormalTok{, }\StringTok{"2020"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::ymd\_to\_yQq()}\label{fcutilsymd_to_yqq}

\subsubsection{Description}\label{description-24}

Convert dates from yyyy-mm-dd to yyyyQqq format

\subsubsection{Usage}\label{usage-24}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ymd\_to\_yQq}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-24}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & dates (string: yyyy-mm-dd) \\
\end{longtable}

\subsubsection{Value}\label{value-24}

formatted dates (string: yyyyQqq)

\subsubsection{Examples}\label{examples-24}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ymd\_to\_yQq}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"2010{-}01{-}01"}\NormalTok{, }\StringTok{"2020{-}10{-}01"}\NormalTok{))}
\FunctionTok{ymd\_to\_yQq}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"2010{-}01{-}01"}\NormalTok{, }\StringTok{"2020{-}10{-}01"}\NormalTok{)) }\SpecialCharTok{|\textgreater{}}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{yq}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\section{Frequency conversion}\label{frequency-conversion}

\subsection{tsbox::ts\_frequency()}\label{tsboxts_frequency}

\subsubsection{Description}\label{description-25}

Changes the frequency of a time series. By default, incomplete periods
of regular series are omitted.

\subsubsection{Usage}\label{usage-25}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_frequency}\NormalTok{(}
\NormalTok{  x,}
  \AttributeTok{to =} \FunctionTok{c}\NormalTok{(}\StringTok{"year"}\NormalTok{, }\StringTok{"quarter"}\NormalTok{, }\StringTok{"month"}\NormalTok{, }\StringTok{"week"}\NormalTok{, }\StringTok{"day"}\NormalTok{, }\StringTok{"hour"}\NormalTok{, }\StringTok{"min"}\NormalTok{, }\StringTok{"sec"}\NormalTok{),}
  \AttributeTok{aggregate =} \StringTok{"mean"}\NormalTok{,}
  \AttributeTok{na.rm =} \ConstantTok{FALSE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-25}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{to} & desired frequency, either a character string
(\texttt{"year"}, \texttt{"quarter"}, \texttt{"month"}) or an integer
(\texttt{1}, \texttt{4}, \texttt{12}). \\
\texttt{aggregate} & character string, or function. Either
\texttt{"mean"}, \texttt{"sum"}, \texttt{"first"}, or \texttt{"last"},
or any aggregate function, such as \texttt{base::mean()}. \\
\texttt{na.rm} & logical, if \texttt{TRUE}, incomplete periods are
aggregated as well. For irregular series, incomplete periods are always
aggregated. \\
\end{longtable}

\subsubsection{Details}\label{details-9}

The \href{https://CRAN.R-project.org/package=tempdisagg}{tempdisagg
package} can convert low frequency to high frequency data and has
support for ts-boxable objects. See
\texttt{vignette("hf-disagg",\ package\ =\ "tempdisagg")}.

\subsubsection{Value}\label{value-25}

a ts-boxable time series, with the same class as the input.

\subsubsection{Examples}\label{examples-25}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_frequency}\NormalTok{(}\FunctionTok{cbind}\NormalTok{(mdeaths, fdeaths), }\StringTok{"year"}\NormalTok{, }\StringTok{"sum"}\NormalTok{)}
\FunctionTok{ts\_frequency}\NormalTok{(}\FunctionTok{cbind}\NormalTok{(mdeaths, fdeaths), }\StringTok{"quarter"}\NormalTok{, }\StringTok{"last"}\NormalTok{)}

\FunctionTok{ts\_frequency}\NormalTok{(AirPassengers, }\DecValTok{4}\NormalTok{, }\StringTok{"sum"}\NormalTok{)}

\DocumentationTok{\#\# Note that incomplete years are omited by default}
\FunctionTok{ts\_frequency}\NormalTok{(EuStockMarkets, }\StringTok{"year"}\NormalTok{)}
\FunctionTok{ts\_frequency}\NormalTok{(EuStockMarkets, }\StringTok{"year"}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::disagg()}\label{fcutilsdisagg}

\subsubsection{Description}\label{description-26}

Interpolate univariate or multivariate time series from low to high
frequency

\subsubsection{Usage}\label{usage-26}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{disagg}\NormalTok{(x, }\AttributeTok{conv\_type =} \StringTok{"mean"}\NormalTok{, }\AttributeTok{target\_freq =} \StringTok{"quarter"}\NormalTok{, }\AttributeTok{pattern =} \ConstantTok{NULL}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-26}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & a tx-boxable object at a low frequency (e.g.~annual or
quarterly) \\
\texttt{conv\_type} & match the quarterly value via "first", "last",
"sum", "mean" \\
\texttt{target\_freq} & target frequency "quarter" or "month" \\
\texttt{pattern} & a single high-frequency pattern that the
interpolation should follow \\
\end{longtable}

\subsubsection{Details}\label{details-10}

the time-span of the high-frequency pattern has to match or be larger
than the time-span of the low frequency series. NA values are not
allowed.

\subsubsection{Value}\label{value-26}

interpolated object of the same type as the input

\subsubsection{Examples}\label{examples-26}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{disagg}\NormalTok{(}\AttributeTok{conv\_type =} \StringTok{"mean"}\NormalTok{, }\AttributeTok{target\_freq =} \StringTok{"month"}\NormalTok{)}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{disagg}\NormalTok{(}\AttributeTok{conv\_type =} \StringTok{"mean"}\NormalTok{, }\AttributeTok{target\_freq =} \StringTok{"month"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_frequency}\NormalTok{(}\AttributeTok{to =} \StringTok{"quarter"}\NormalTok{, }\AttributeTok{aggregate =} \StringTok{"mean"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_wide}\NormalTok{() }\DocumentationTok{\#\# this matches original data}
\DocumentationTok{\#\# works with a single series too}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_NF\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{disagg}\NormalTok{(}\AttributeTok{conv\_type =} \StringTok{"mean"}\NormalTok{, }\AttributeTok{target\_freq =} \StringTok{"month"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_plot}\NormalTok{()}
\DocumentationTok{\#\# using a high{-}frequency pattern}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_span}\NormalTok{(}\StringTok{"2005{-}01{-}01"}\NormalTok{, }\StringTok{"2020{-}01{-}01"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{disagg}\NormalTok{(}
    \AttributeTok{conv\_type =} \StringTok{"mean"}\NormalTok{, }\AttributeTok{target\_freq =} \StringTok{"month"}\NormalTok{, }\AttributeTok{pattern =}\NormalTok{ monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{      tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{      tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"VISNS\_HI"}\NormalTok{)}
\NormalTok{  )}
\DocumentationTok{\#\# multiple low{-}frequency series, same number of high{-}frequency patterns}
\NormalTok{purrr}\SpecialCharTok{::}\FunctionTok{map2}\NormalTok{(}
\NormalTok{  quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_NF\_HI"}\NormalTok{, }\StringTok{"ECT\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_span}\NormalTok{(}\StringTok{"2005{-}01{-}01"}\NormalTok{, }\StringTok{"2020{-}01{-}01"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_tslist}\NormalTok{(),}
\NormalTok{  monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_tslist}\NormalTok{(),}
  \SpecialCharTok{\textasciitilde{}} \FunctionTok{disagg}\NormalTok{(.x, }\AttributeTok{conv\_type =} \StringTok{"mean"}\NormalTok{, }\AttributeTok{target\_freq =} \StringTok{"month"}\NormalTok{, }\AttributeTok{pattern =}\NormalTok{ .y)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::QtoA()}\label{fcutilsqtoa}

\subsubsection{Description}\label{description-27}

Aggregate from quarterly to annual frequency (superseded by
tsbox::ts\_frequency())

\subsubsection{Usage}\label{usage-27}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{QtoA}\NormalTok{(ser\_in, }\AttributeTok{aggr =} \StringTok{"mean"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-27}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{ser\_in} & the xts series to be converted (freq = q) \\
\texttt{aggr} & aggregate via mean (default) or sum \\
\end{longtable}

\subsubsection{Value}\label{value-27}

converted xts series (freq = a)

\subsubsection{Examples}\label{examples-27}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_NF\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{QtoA}\NormalTok{() }\SpecialCharTok{|\textgreater{}} \DocumentationTok{\#\# this matches with below}
  \FunctionTok{AtoQ}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{QtoA}\NormalTok{() }\SpecialCharTok{|\textgreater{}} \DocumentationTok{\#\# this matches with above}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_plot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::AtoQ()}\label{fcutilsatoq}

\subsubsection{Description}\label{description-28}

Linear interpolation based on AREMOS command reference page 292
(superseded by disagg())

\subsubsection{Usage}\label{usage-28}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{AtoQ}\NormalTok{(ser\_in, }\AttributeTok{aggr =} \StringTok{"mean"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-28}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{ser\_in} & the xts series to be interpolated (freq = a) \\
\texttt{aggr} & interpolation method: aggregate via mean (default) or
sum \\
\end{longtable}

\subsubsection{Value}\label{value-28}

interpolated xts series (freq = q)

\subsubsection{Examples}\label{examples-28}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_NF\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{QtoA}\NormalTok{() }\SpecialCharTok{|\textgreater{}} \DocumentationTok{\#\# this matches with below}
  \FunctionTok{AtoQ}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{QtoA}\NormalTok{() }\SpecialCharTok{|\textgreater{}} \DocumentationTok{\#\# this matches with above}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_plot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\section{Growth rates and level
operations}\label{growth-rates-and-level-operations}

\subsection{tsbox::ts\_pc()}\label{tsboxts_pc}

\subsubsection{Description}\label{description-29}

\texttt{ts\_pcy} and \texttt{ts\_diffy} calculate the percentage change
rate and the difference compared to the previous period,
\texttt{ts\_pcy} and \texttt{ts\_diffy} calculate the percentage change
rate compared to the same period of the previous year. \texttt{ts\_pca}
calculates annualized percentage change rates compared to the previous
period.

\subsubsection{Usage}\label{usage-29}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_pc}\NormalTok{(x)}

\FunctionTok{ts\_diff}\NormalTok{(x)}

\FunctionTok{ts\_pca}\NormalTok{(x)}

\FunctionTok{ts\_pcy}\NormalTok{(x)}

\FunctionTok{ts\_diffy}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-29}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\end{longtable}

\subsubsection{Value}\label{value-29}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{Examples}\label{examples-29}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{ts\_c}\NormalTok{(fdeaths, mdeaths)}
\FunctionTok{ts\_diff}\NormalTok{(x)}
\FunctionTok{ts\_pc}\NormalTok{(x)}
\FunctionTok{ts\_pca}\NormalTok{(x)}
\FunctionTok{ts\_pcy}\NormalTok{(x)}
\FunctionTok{ts\_diffy}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_lag()}\label{tsboxts_lag}

\subsubsection{Description}\label{description-30}

Shift time stamps in ts-boxable time series, either by a number of
periods or by a fixed amount of time.

\subsubsection{Usage}\label{usage-30}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_lag}\NormalTok{(x, }\AttributeTok{by =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-30}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{by} & integer or character, either the number of shifting
periods (integer), or an absolute amount of time (character). See
details. \\
\end{longtable}

\subsubsection{Details}\label{details-11}

The lag order, \texttt{by}, is defined the opposite way as in R base.
Thus, -1 is a lead and +1 a lag.

If \texttt{by} is integer, the time stamp is shifted by the number of
periods. This requires the series to be regular.

If \texttt{by} is character, the time stamp is shifted by a specific
amount of time. This can be one of one of \texttt{"sec"},
\texttt{"min"}, \texttt{"hour"}, \texttt{"day"}, \texttt{"week"},
\texttt{"month"}, \texttt{⁠"quarter"\ or\ ⁠}"year", optionally preceded by
a (positive or negative) integer and a space, or followed by plural "s".
This is passed to \texttt{base::seq.Date()}. This does not require the
series to be regular.

\subsubsection{Value}\label{value-30}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{Examples}\label{examples-30}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_plot}\NormalTok{(AirPassengers, }\FunctionTok{ts\_lag}\NormalTok{(AirPassengers), }\AttributeTok{title =} \StringTok{"The need for glasses"}\NormalTok{)}

\FunctionTok{ts\_lag}\NormalTok{(fdeaths, }\StringTok{"1 month"}\NormalTok{)}
\FunctionTok{ts\_lag}\NormalTok{(fdeaths, }\StringTok{"1 year"}\NormalTok{)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{ts\_df}\NormalTok{(fdeaths)}
\FunctionTok{ts\_lag}\NormalTok{(x, }\StringTok{"2 day"}\NormalTok{)}
\FunctionTok{ts\_lag}\NormalTok{(x, }\StringTok{"2 min"}\NormalTok{)}
\FunctionTok{ts\_lag}\NormalTok{(x, }\StringTok{"{-}1 day"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_arithmetic()}\label{tsboxts_arithmetic}

\subsubsection{Description}\label{description-31}

Arithmetic Operators for ts-boxable objects

\subsubsection{Usage}\label{usage-31}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{e1 }\SpecialCharTok{\%ts+\%}\NormalTok{ e2}

\NormalTok{e1 }\SpecialCharTok{\%ts{-}\%}\NormalTok{ e2}

\NormalTok{e1 }\SpecialCharTok{\%ts*\%}\NormalTok{ e2}

\NormalTok{e1 }\SpecialCharTok{\%ts/\%}\NormalTok{ e2}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-31}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{e1} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{e2} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\end{longtable}

\subsubsection{Value}\label{value-31}

a ts-boxable time series, with the same class as the left input.

\subsubsection{Examples}\label{examples-31}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(fdeaths }\SpecialCharTok{{-}}\NormalTok{ mdeaths)}
\FunctionTok{head}\NormalTok{(fdeaths }\SpecialCharTok{\%ts{-}\%}\NormalTok{ mdeaths)}
\FunctionTok{head}\NormalTok{(}\FunctionTok{ts\_df}\NormalTok{(fdeaths) }\SpecialCharTok{\%ts{-}\%}\NormalTok{ mdeaths)}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_scale()}\label{tsboxts_scale}

\subsubsection{Description}\label{description-32}

Subtract mean (\emph{sum(x)/n}) and divide by standard deviation
(\emph{sqrt(sum(x\^{}2)/(n-1))}). Based on \texttt{base::scale()}.

\subsubsection{Usage}\label{usage-32}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_scale}\NormalTok{(x, }\AttributeTok{center =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{scale =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-32}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{center} & logical \\
\texttt{scale} & logical \\
\end{longtable}

\subsubsection{Value}\label{value-32}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{Examples}\label{examples-32}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_plot}\NormalTok{(}\FunctionTok{ts\_scale}\NormalTok{((}\FunctionTok{ts\_c}\NormalTok{(airmiles, co2, JohnsonJohnson, discoveries))))}
\FunctionTok{ts\_plot}\NormalTok{(}\FunctionTok{ts\_scale}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(AirPassengers, }\AttributeTok{DAX =}\NormalTok{ EuStockMarkets[, }\StringTok{"DAX"}\NormalTok{])))}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_trend()}\label{tsboxts_trend}

\subsubsection{Description}\label{description-33}

Trend estimation that uses \texttt{stats::loess()}.

\subsubsection{Usage}\label{usage-33}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_trend}\NormalTok{(x, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-33}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.5000}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.5000}}@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{...} & \begin{minipage}[t]{\linewidth}\raggedright
arguments, passed to \texttt{stats::loess()}:

\begin{itemize}
\item
  \texttt{degree} degree of Loess smoothing
\item
  \texttt{span} smoothing parameter, if \texttt{NULL}, an automated
  search performed (see Details)
\end{itemize}
\end{minipage} \\
\end{longtable}

\subsubsection{Value}\label{value-33}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{References}\label{references}

Cleveland, William S., Eric Grosse, and William M. Shyu. "Local
regression models." Statistical models in S. Routledge, 2017. 309-376.

\subsubsection{Examples}\label{examples-33}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_plot}\NormalTok{(}
  \StringTok{\textasciigrave{}}\AttributeTok{Raw series}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ fdeaths,}
  \StringTok{\textasciigrave{}}\AttributeTok{Loess trend}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{ts\_trend}\NormalTok{(fdeaths),}
  \AttributeTok{title =} \StringTok{"Deaths from Lung Diseases"}\NormalTok{,}
  \AttributeTok{subtitle =} \StringTok{"per month"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_bind()}\label{tsboxts_bind}

\subsubsection{Description}\label{description-34}

Combine time series to a new, single time series. \texttt{ts\_bind}
combines time series as they are, \texttt{ts\_chain} chains them
together, using percentage change rates.

\subsubsection{Usage}\label{usage-34}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_bind}\NormalTok{(...)}

\FunctionTok{ts\_chain}\NormalTok{(...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-34}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{...} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\end{longtable}

\subsubsection{Details}\label{details-12}

In data frame objects, multiple time series are stored in a long data
frame. In \texttt{ts} and \texttt{xts} objects, time series are combined
horizontally.

\subsubsection{Value}\label{value-34}

a ts-boxable object of the same class as the input, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}. If series of different classes are combined, the
class of the first series is used (if possible).

\subsubsection{See Also}\label{see-also-1}

ts\_c to collect multiple time series

\subsubsection{Examples}\label{examples-34}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_bind}\NormalTok{(}\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{end =} \StringTok{"1975{-}12{-}01"}\NormalTok{), fdeaths)}
\FunctionTok{ts\_bind}\NormalTok{(mdeaths, }\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\FunctionTok{ts\_bind}\NormalTok{(mdeaths, }\DecValTok{3}\NormalTok{, }\FunctionTok{ts\_bind}\NormalTok{(fdeaths, }\FunctionTok{c}\NormalTok{(}\DecValTok{99}\NormalTok{, }\DecValTok{2}\NormalTok{)))}
\FunctionTok{ts\_bind}\NormalTok{(}\FunctionTok{ts\_dt}\NormalTok{(mdeaths), AirPassengers)}

\DocumentationTok{\#\# numeric vectors}
\FunctionTok{ts\_bind}\NormalTok{(}\DecValTok{12}\NormalTok{, AirPassengers, }\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\FunctionTok{ts\_chain}\NormalTok{(}\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{end =} \StringTok{"1975{-}12{-}01"}\NormalTok{), fdeaths)}

\FunctionTok{ts\_plot}\NormalTok{(}\FunctionTok{ts\_pc}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(}
  \AttributeTok{comb =} \FunctionTok{ts\_chain}\NormalTok{(}\FunctionTok{ts\_span}\NormalTok{(mdeaths, }\AttributeTok{end =} \StringTok{"1975{-}12{-}01"}\NormalTok{), fdeaths),}
\NormalTok{  fdeaths}
\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_index()}\label{tsboxts_index}

\subsubsection{Description}\label{description-35}

\texttt{ts\_index} returns an indexed series, with value of 1 at the
\texttt{base} date or range. \texttt{ts\_compound} builds an index from
percentage change rates, starting with 1 and compounding the rates.

\subsubsection{Usage}\label{usage-35}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_compound}\NormalTok{(x, }\AttributeTok{denominator =} \DecValTok{100}\NormalTok{)}

\FunctionTok{ts\_index}\NormalTok{(x, }\AttributeTok{base =} \ConstantTok{NULL}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-35}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{denominator} & positive number. Set equal to 1 if percentage
change rate is given a decimal fraction \\
\texttt{base} & base date, character string, \texttt{Date} or
\texttt{POSIXct}, at which the index is set to 1. If two dates are
provided, the mean in the range is set equal to 1 (see examples). \\
\end{longtable}

\subsubsection{Value}\label{value-35}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{Examples}\label{examples-35}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{ts\_pc}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(fdeaths, mdeaths))}
\FunctionTok{ts\_compound}\NormalTok{(x)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{ts\_df}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(fdeaths, mdeaths))}
\FunctionTok{ts\_index}\NormalTok{(y, }\StringTok{"1974{-}02{-}01"}\NormalTok{)}

\FunctionTok{ts\_plot}\NormalTok{(}
  \StringTok{\textasciigrave{}}\AttributeTok{My Expert Knowledge}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{ts\_chain}\NormalTok{(}
\NormalTok{    mdeaths,}
    \FunctionTok{ts\_compound}\NormalTok{(}\FunctionTok{ts\_bind}\NormalTok{(}\FunctionTok{ts\_pc}\NormalTok{(mdeaths), }\DecValTok{15}\NormalTok{, }\DecValTok{23}\NormalTok{, }\DecValTok{33}\NormalTok{))}
\NormalTok{  ),}
  \StringTok{\textasciigrave{}}\AttributeTok{So Far}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ mdeaths,}
  \AttributeTok{title =} \StringTok{"A Very Manual Forecast"}
\NormalTok{)}

\DocumentationTok{\#\# mean of 1974 = 1}
\FunctionTok{ts\_index}\NormalTok{(mdeaths, }\FunctionTok{c}\NormalTok{(}\StringTok{"1974{-}01{-}01"}\NormalTok{, }\StringTok{"1974{-}12{-}31"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::index()}\label{fcutilsindex}

\subsubsection{Description}\label{description-36}

Get indexed series (wrapper around tsbox::ts\_index())

\subsubsection{Usage}\label{usage-36}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{index}\NormalTok{(x, }\AttributeTok{base\_per =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{()), }\AttributeTok{base\_value =} \DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-36}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object to be indexed \\
\texttt{base\_per} & base date when the index is set to base\_value (see
examples). If two dates are provided, the mean in the range is set equal
to base\_value. \\
\texttt{base\_value} & numeric value of the index at base\_per (e.g.~1
or 100) \\
\end{longtable}

\subsubsection{Value}\label{value-36}

indexed object of the same type as the input

\subsubsection{Examples}\label{examples-36}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{index}\NormalTok{(}\FloatTok{2010.1}\NormalTok{)}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{index}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FloatTok{2010.1}\NormalTok{, }\FloatTok{2010.4}\NormalTok{))}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{index}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"2010{-}01{-}01"}\NormalTok{, }\StringTok{"2010{-}12{-}31"}\NormalTok{), }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::ma()}\label{fcutilsma}

\subsubsection{Description}\label{description-37}

Backward looking moving average

\subsubsection{Usage}\label{usage-37}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ma}\NormalTok{(x, order)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-37}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object \\
\texttt{order} & numeric order (window length) of moving average,
includes contemporaneous observation \\
\end{longtable}

\subsubsection{Value}\label{value-37}

object of the same type as the input containing moving average

\subsubsection{Examples}\label{examples-37}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ma}\NormalTok{(}\DecValTok{4}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::yoy\_to\_lev()}\label{fcutilsyoy_to_lev}

\subsubsection{Description}\label{description-38}

Extend a series using year over year growth

\subsubsection{Usage}\label{usage-38}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{yoy\_to\_lev}\NormalTok{(yoy\_gr, hist\_lev, }\AttributeTok{smooth\_span =} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-38}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{yoy\_gr} & ts-boxable object containing year over year growth
rates \\
\texttt{hist\_lev} & ts-boxable object containing the history in levels
for forecast and at least one year of history (in percent) \\
\texttt{smooth\_span} & extent of smoothing between 0-1 (default: 0, no
smoothing) \\
\end{longtable}

\subsubsection{Details}\label{details-13}

This function only works for univariate time series and requires that
the growth rates are available for at least the last year of history.
Year-over-year growth rates propagate the fluctuations of the base
period into the extension period. This can be mitigated by smoothing the
extension.

\subsubsection{Value}\label{value-38}

object of the same type as hist\_lev extended with year over year growth

\subsubsection{Examples}\label{examples-38}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gr }\OtherTok{\textless{}{-}}\NormalTok{ quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(id }\SpecialCharTok{==} \StringTok{"E\_NF\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pcy}\NormalTok{()}
\NormalTok{lev }\OtherTok{\textless{}{-}}\NormalTok{ quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(id }\SpecialCharTok{==} \StringTok{"ECT\_HI"}\NormalTok{)}
\NormalTok{res1 }\OtherTok{\textless{}{-}} \FunctionTok{yoy\_to\_lev}\NormalTok{(gr, lev }\SpecialCharTok{|\textgreater{}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(time }\SpecialCharTok{\textless{}=} \StringTok{"2010{-}01{-}01"}\NormalTok{))}
\NormalTok{res2 }\OtherTok{\textless{}{-}} \FunctionTok{yoy\_to\_lev}\NormalTok{(gr, lev }\SpecialCharTok{|\textgreater{}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(time }\SpecialCharTok{\textless{}=} \StringTok{"2010{-}01{-}01"}\NormalTok{), }\DecValTok{1}\SpecialCharTok{/}\DecValTok{8}\NormalTok{)}
\NormalTok{tsbox}\SpecialCharTok{::}\FunctionTok{ts\_plot}\NormalTok{(lev, res1, res2)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::mtd\_cum()}\label{fcutilsmtd_cum}

\subsubsection{Description}\label{description-39}

Month to date sum or average

\subsubsection{Usage}\label{usage-39}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mtd\_cum}\NormalTok{(x, }\AttributeTok{avg =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-39}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & a ts-boxable object \\
\texttt{avg} & if TRUE (default), return month to date average, if
FALSE, return month to date sum \\
\end{longtable}

\subsubsection{Value}\label{value-39}

object of the same type as the input containing year to date sum or
average

\subsubsection{Examples}\label{examples-39}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{daily\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{mtd\_cum}\NormalTok{()}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ daily\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"VAPNS\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{mtd\_cum}\NormalTok{()}
\NormalTok{tsbox}\SpecialCharTok{::}\StringTok{\textasciigrave{}}\AttributeTok{\%ts/\%}\StringTok{\textasciigrave{}}\NormalTok{(test, tsbox}\SpecialCharTok{::}\FunctionTok{ts\_lag}\NormalTok{(test, }\StringTok{"6 months"}\NormalTok{)) }\SpecialCharTok{|\textgreater{}} \FunctionTok{tail}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::mtd\_gr()}\label{fcutilsmtd_gr}

\subsubsection{Description}\label{description-40}

Month to date growth rate

\subsubsection{Usage}\label{usage-40}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mtd\_gr}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-40}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & a ts-boxable object \\
\end{longtable}

\subsubsection{Value}\label{value-40}

object of the same type as the input containing month to date growth
rate

\subsubsection{Examples}\label{examples-40}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{daily\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{mtd\_gr}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tail}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::ytd\_cum()}\label{fcutilsytd_cum}

\subsubsection{Description}\label{description-41}

Year to date sum or average

\subsubsection{Usage}\label{usage-41}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ytd\_cum}\NormalTok{(x, }\AttributeTok{avg =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-41}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & a ts-boxable object \\
\texttt{avg} & if TRUE (default), return year to date average, if FALSE,
return year to date sum \\
\end{longtable}

\subsubsection{Value}\label{value-41}

object of the same type as the input containing year to date sum or
average

\subsubsection{Examples}\label{examples-41}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ytd\_cum}\NormalTok{()}
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"VISNS\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ytd\_cum}\NormalTok{(}\AttributeTok{avg =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_plot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::ytd\_gr()}\label{fcutilsytd_gr}

\subsubsection{Description}\label{description-42}

Year to date growth rate

\subsubsection{Usage}\label{usage-42}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ytd\_gr}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-42}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & a ts-boxable object \\
\end{longtable}

\subsubsection{Value}\label{value-42}

object of the same type as the input containing year to date growth rate

\subsubsection{Examples}\label{examples-42}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"VISNS\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ytd\_gr}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tail}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::ptd\_cum()}\label{fcutilsptd_cum}

\subsubsection{Description}\label{description-43}

Period to date sum or average

\subsubsection{Usage}\label{usage-43}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ptd\_cum}\NormalTok{(x, }\AttributeTok{per =} \StringTok{"year"}\NormalTok{, }\AttributeTok{avg =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-43}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & a ts-boxable object \\
\texttt{per} & unit of time supplied to floor\_date() (for ytd per =
"year" (default), for mtd per = "month") \\
\texttt{avg} & if TRUE (default), retorn period to date average, if
FALSE, return period to date sum \\
\end{longtable}

\subsubsection{Value}\label{value-43}

object of the same type as the input containing period to date sum or
average

\subsubsection{Examples}\label{examples-43}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{daily\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ptd\_cum}\NormalTok{(}\StringTok{"week"}\NormalTok{)}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ daily\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"VAPNS\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ptd\_cum}\NormalTok{(}\StringTok{"week"}\NormalTok{)}
\NormalTok{tsbox}\SpecialCharTok{::}\StringTok{\textasciigrave{}}\AttributeTok{\%ts/\%}\StringTok{\textasciigrave{}}\NormalTok{(test, tsbox}\SpecialCharTok{::}\FunctionTok{ts\_lag}\NormalTok{(test, }\StringTok{"4 weeks"}\NormalTok{)) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\StringTok{\textasciigrave{}}\AttributeTok{\%ts{-}\%}\StringTok{\textasciigrave{}}\NormalTok{(}\DecValTok{1}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\StringTok{\textasciigrave{}}\AttributeTok{\%ts*\%}\StringTok{\textasciigrave{}}\NormalTok{(}\DecValTok{100}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tail}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::ptd\_gr()}\label{fcutilsptd_gr}

\subsubsection{Description}\label{description-44}

Period to date growth rate

\subsubsection{Usage}\label{usage-44}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ptd\_gr}\NormalTok{(x, }\AttributeTok{per =} \StringTok{"year"}\NormalTok{, }\AttributeTok{lag\_length =} \StringTok{"1 year"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-44}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & a ts-boxable object \\
\texttt{per} & unit of time supplied to floor\_date() (for ytd per =
"year" (default), for mtd per = "month") \\
\texttt{lag\_length} & period over which growth is calculated (e.g.~"1
year" (default), "3 years", etc. See ?ts\_lag() for options) \\
\end{longtable}

\subsubsection{Value}\label{value-44}

object of the same type as the input containing period to date growth
rate

\subsubsection{Examples}\label{examples-44}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ptd\_gr}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tail}\NormalTok{()}
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(time, }\StringTok{"VAPNS\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ptd\_gr}\NormalTok{(}\AttributeTok{per =} \StringTok{"month"}\NormalTok{, }\AttributeTok{lag\_length =} \StringTok{"3 years"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tail}\NormalTok{()}
\DocumentationTok{\#\# don\textquotesingle{}t use lag\_length = "1 year" with weekly data}
\NormalTok{daily\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ptd\_gr}\NormalTok{(}\StringTok{"week"}\NormalTok{)}
\DocumentationTok{\#\# lag\_length = "52 weeks" instead}
\NormalTok{daily\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ptd\_gr}\NormalTok{(}\StringTok{"week"}\NormalTok{, }\StringTok{"52 weeks"}\NormalTok{)}
\DocumentationTok{\#\# and use lag\_length = "364 days" with daily data}
\NormalTok{daily\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ptd\_gr}\NormalTok{(}\StringTok{"day"}\NormalTok{, }\StringTok{"364 days"}\NormalTok{)}
\NormalTok{daily\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"VAPNS\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{ptd\_gr}\NormalTok{(}\StringTok{"week"}\NormalTok{, }\StringTok{"4 weeks"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tail}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::pca\_to\_pc()}\label{fcutilspca_to_pc}

\subsubsection{Description}\label{description-45}

Convert annualized growth to quarterly growth

\subsubsection{Usage}\label{usage-45}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{pca\_to\_pc}\NormalTok{(x, }\AttributeTok{freq =} \DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-45}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object containing annualized growth (in
percent) \\
\texttt{freq} & numeric frequency of the time series e.g.~4 for
quarterly \\
\end{longtable}

\subsubsection{Value}\label{value-45}

object of the same type as the input containing quarterly growth (in
percent)

\subsubsection{Examples}\label{examples-45}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pca}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pca\_to\_pc}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tail}\NormalTok{()}
\NormalTok{tsbox}\SpecialCharTok{::}\FunctionTok{ts\_c}\NormalTok{(}
\NormalTok{  quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pca}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{pca\_to\_pc}\NormalTok{(),}
\NormalTok{  quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pc}\NormalTok{()}
\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(id, time) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::pc\_to\_pca()}\label{fcutilspc_to_pca}

\subsubsection{Description}\label{description-46}

Convert quarterly growth to annualized growth

\subsubsection{Usage}\label{usage-46}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{pc\_to\_pca}\NormalTok{(x, }\AttributeTok{freq =} \DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-46}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object containing quarterly growth (in
percent) \\
\texttt{freq} & numeric frequency of the time series e.g.~4 for
quarterly \\
\end{longtable}

\subsubsection{Value}\label{value-46}

object of the same type as the input containing annualized growth (in
percent)

\subsubsection{Examples}\label{examples-46}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pc}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pc\_to\_pca}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tail}\NormalTok{()}
\NormalTok{tsbox}\SpecialCharTok{::}\FunctionTok{ts\_c}\NormalTok{(}
\NormalTok{  quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pc}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
    \FunctionTok{pc\_to\_pca}\NormalTok{(),}
\NormalTok{  quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{    tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pca}\NormalTok{()}
\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(id, time) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::cagr()}\label{fcutilscagr}

\subsubsection{Description}\label{description-47}

Calculate compund annual growth

\subsubsection{Usage}\label{usage-47}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cagr}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-47}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object for which growth is calculated between
first and last period \\
\end{longtable}

\subsubsection{Value}\label{value-47}

a tibble with a single row containing the compound annual growth between
the first and last period of x (in percent)

\subsubsection{Examples}\label{examples-47}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{cagr}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{cagr}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_span}\NormalTok{(}\StringTok{"2000{-}01{-}01"}\NormalTok{, }\StringTok{"2020{-}01{-}01"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_NF\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{cagr}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::pcmp()}\label{fcutilspcmp}

\subsubsection{Description}\label{description-48}

Calculate multi-period average growth

\subsubsection{Usage}\label{usage-48}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{pcmp}\NormalTok{(x, }\AttributeTok{lag =} \DecValTok{4}\NormalTok{, }\AttributeTok{comp\_freq =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-48}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object for which growth is calculated (in
levels) \\
\texttt{lag} & number of periods over which growth is calculated \\
\texttt{comp\_freq} & compounding frequency (1 if period by period, 4 if
annualized for quarterly data, etc.) \\
\end{longtable}

\subsubsection{Value}\label{value-48}

object of the same type as the input ontaining the average growth of x
(in percent)

\subsubsection{Examples}\label{examples-48}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pcmp}\NormalTok{(}\DecValTok{20}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tail}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pcmp}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tail}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pcmp}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{tail}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{fcutils::\texttt{\%+=\%}()}{fcutils::\%+=\%()}}\label{fcutils}

\subsubsection{Description}\label{description-49}

Warning: Typing x \%+=\% y/2 returns x \textless- (x + y)/2. Adding
parentheses, i.e.~x \%+=\% (y/2) solves the problem.

\subsubsection{Usage}\label{usage-49}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{e1 }\SpecialCharTok{\%+=\%}\NormalTok{ e2}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-49}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{e1} & first addend (and returned sum) \\
\texttt{e2} & second addend \\
\end{longtable}

\subsubsection{Value}\label{value-49}

sum of the two addends replacing the values in the first addend

\subsubsection{Examples}\label{examples-49}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{add\_QMOD.xts}\SpecialCharTok{$}\NormalTok{VISUS\_HI[}\FunctionTok{pq}\NormalTok{(}\FloatTok{2022.3}\NormalTok{, }\FloatTok{2023.4}\NormalTok{)] }\OtherTok{\textless{}{-}}\NormalTok{ add\_QMOD.xts}\SpecialCharTok{$}\NormalTok{VISUS\_HI[}\FunctionTok{pq}\NormalTok{(}\FloatTok{2022.3}\NormalTok{, }\FloatTok{2023.4}\NormalTok{)] }\SpecialCharTok{+}
  \FunctionTok{c}\NormalTok{(}\FloatTok{0.01}\NormalTok{, }\SpecialCharTok{{-}}\FloatTok{0.04}\NormalTok{, }\FunctionTok{rep}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.025}\NormalTok{, }\DecValTok{4}\NormalTok{))}
\NormalTok{add\_QMOD.xts}\SpecialCharTok{$}\NormalTok{VISUS\_HI[}\FunctionTok{pq}\NormalTok{(}\FloatTok{2022.3}\NormalTok{, }\FloatTok{2023.4}\NormalTok{)] }\SpecialCharTok{\%+=\%} \FunctionTok{c}\NormalTok{(}\FloatTok{0.01}\NormalTok{, }\SpecialCharTok{{-}}\FloatTok{0.04}\NormalTok{, }\FunctionTok{rep}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.025}\NormalTok{, }\DecValTok{4}\NormalTok{)) }\DocumentationTok{\#\# easier on the eye}
\end{Highlighting}
\end{Shaded}

\section{Data type conversion}\label{sec-type}

\subsection{tsbox::ts\_ts()}\label{tsboxts_ts}

\subsubsection{Description}\label{description-50}

tsbox is built around a set of converters, which convert time series
stored as \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries} to each other.

\subsubsection{Usage}\label{usage-50}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_data.frame}\NormalTok{(x)}

\FunctionTok{ts\_df}\NormalTok{(x)}

\FunctionTok{ts\_data.table}\NormalTok{(x)}

\FunctionTok{ts\_dt}\NormalTok{(x)}

\FunctionTok{ts\_tbl}\NormalTok{(x)}

\FunctionTok{ts\_tibbletime}\NormalTok{(x)}

\FunctionTok{ts\_timeSeries}\NormalTok{(x)}

\FunctionTok{ts\_tis}\NormalTok{(x)}

\FunctionTok{ts\_ts}\NormalTok{(x)}

\FunctionTok{ts\_irts}\NormalTok{(x)}

\FunctionTok{ts\_tsibble}\NormalTok{(x)}

\FunctionTok{ts\_tslist}\NormalTok{(x)}

\FunctionTok{ts\_xts}\NormalTok{(x)}

\FunctionTok{ts\_zoo}\NormalTok{(x)}

\FunctionTok{ts\_zooreg}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-50}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\end{longtable}

\subsubsection{Details}\label{details-14}

In data frames, multiple time series will be stored in a
\textquotesingle long\textquotesingle{} format. tsbox detects a
\emph{value}, a \emph{time} and zero to several \emph{id} columns.
Column detection is done in the following order:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Starting \textbf{on the right}, the first first \texttt{numeric} or
  \texttt{integer} column is used as \textbf{value column}.
\item
  Using the remaining columns, and starting on the right again, the
  first \texttt{Date}, \texttt{POSIXct}, \texttt{numeric} or
  \texttt{character} column is used as \textbf{time column}.
  \texttt{character} strings are parsed by \texttt{anytime::anytime()}.
  The time stamp, \texttt{time}, indicates the beginning of a period.
\item
  \textbf{All remaining} columns are \textbf{id columns}. Each unique
  combination of id columns points to a time series.
\end{enumerate}

\textbf{Alternatively}, the \textbf{time} column and the \textbf{value}
column to be explicitly named as \texttt{time} and \texttt{value}. If
explicit names are used, the column order will be ignored.

Whenever possible, tsbox relies on \textbf{heuristic time conversion}.
When a monthly \texttt{"ts"} time series, e.g., \texttt{AirPassengers},
is converted to a data frame, each time stamp (of class \texttt{"Date"})
is the first day of the month. In most circumstances, this reflects the
actual meaning of the data stored in a \texttt{"ts"} object.
Technically, of course, this is not correct: \texttt{"ts"} objects
divide time in period of equal length, while in reality, February is
shorter than January. Heuristic conversion is done for frequencies of
0.1 (decades), 1 (years), 4 (quarters) and 12 (month).

For other frequencies, e.g.~260, of \texttt{EuStockMarkets}, tsbox uses
\textbf{exact time conversion}. The year is divided into 260 equally
long units, and time stamp of a period will be a point in time (of class
\texttt{"POSIXct"}).

\subsubsection{Value}\label{value-50}

ts-boxable time series of the desired class, i.e., an object of class
\texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{Examples}\label{examples-50}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x.ts }\OtherTok{\textless{}{-}} \FunctionTok{ts\_c}\NormalTok{(mdeaths, fdeaths)}
\NormalTok{x.ts}
\FunctionTok{ts\_df}\NormalTok{(x.ts)}

\FunctionTok{suppressMessages}\NormalTok{(}\FunctionTok{library}\NormalTok{(dplyr))}
\FunctionTok{ts\_tbl}\NormalTok{(x.ts)}

\FunctionTok{suppressMessages}\NormalTok{(}\FunctionTok{library}\NormalTok{(data.table))}
\FunctionTok{ts\_dt}\NormalTok{(x.ts)}

\FunctionTok{suppressMessages}\NormalTok{(}\FunctionTok{library}\NormalTok{(xts))}
\FunctionTok{ts\_xts}\NormalTok{(x.ts)}

\DocumentationTok{\#\# heuristic time conversion}
\DocumentationTok{\#\# 1 month: approx. 1/12 year}
\FunctionTok{ts\_df}\NormalTok{(AirPassengers)}

\DocumentationTok{\#\# exact time conversion}
\DocumentationTok{\#\# 1 trading day: exactly 1/260 year}
\FunctionTok{ts\_df}\NormalTok{(EuStockMarkets)}

\DocumentationTok{\#\# multiple ids}
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{ts\_df}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(fdeaths, mdeaths))}
\NormalTok{a}\SpecialCharTok{$}\NormalTok{type }\OtherTok{\textless{}{-}} \StringTok{"level"}
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{ts\_pc}\NormalTok{(a)}
\NormalTok{b}\SpecialCharTok{$}\NormalTok{type }\OtherTok{\textless{}{-}} \StringTok{"pc"}
\NormalTok{multi.id.df }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(a, b)}

\FunctionTok{ts\_ts}\NormalTok{(multi.id.df)}
\FunctionTok{ts\_plot}\NormalTok{(multi.id.df)}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_long()}\label{tsboxts_long}

\subsubsection{Description}\label{description-51}

Functions to reshape multiple time series from
\textquotesingle wide\textquotesingle{} to
\textquotesingle long\textquotesingle{} and vice versa. Note that long
format data frames are ts-boxable objects, where wide format data frames
are not. \texttt{ts\_long} automatically identifies a \textbf{time}
column, and uses columns on the left as id columns.

\subsubsection{Usage}\label{usage-51}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_long}\NormalTok{(x)}

\FunctionTok{ts\_wide}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-51}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & a ts-boxable time series, or a wide \texttt{data.frame},
\texttt{data.table}, or \texttt{tibble}. \\
\end{longtable}

\subsubsection{Value}\label{value-51}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{Examples}\label{examples-51}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{ts\_df}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(mdeaths, fdeaths))}
\NormalTok{df.wide }\OtherTok{\textless{}{-}} \FunctionTok{ts\_wide}\NormalTok{(x)}
\NormalTok{df.wide}
\FunctionTok{ts\_long}\NormalTok{(df.wide)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::conv\_long()}\label{fcutilsconv_long}

\subsubsection{Description}\label{description-52}

Convert "ts-boxable" objects into long format

\subsubsection{Usage}\label{usage-52}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{conv\_long}\NormalTok{(x, }\AttributeTok{ser\_info =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-52}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & a "tx-boxable" object to be converted \\
\texttt{ser\_info} & should additional details be returned (TRUE) or
only the long format of x (default: FALSE) \\
\end{longtable}

\subsubsection{Details}\label{details-15}

This function converts wide data frames and other ts-boxable objects to
the long format (wide data frames are not ts-boxable). In addition, it
ensures that objects containing a single time series have an id column.

\subsubsection{Value}\label{value-52}

returns a ts-boxable object in long format with \texttt{id},
\texttt{time} and \texttt{value} columns. if
\texttt{ser\_info\ =\ TRUE}, also returns the following attributes:
\texttt{was\_wide} is \texttt{TRUE} if x is a wide data frame,
\texttt{FALSE} otherwise, and \texttt{ser\_names} are the names of the
series in x.

\subsubsection{Examples}\label{examples-52}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{conv\_long}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{conv\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_tslist}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{conv\_long}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{conv\_long}\NormalTok{(}\AttributeTok{ser\_info =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_NF\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{conv\_long}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_NF\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{conv\_long}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::is\_wide()}\label{fcutilsis_wide}

\subsubsection{Description}\label{description-53}

Check if a data frame is in wide format

\subsubsection{Usage}\label{usage-53}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is\_wide}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-53}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & tibble or data frame \\
\end{longtable}

\subsubsection{Value}\label{value-53}

returns TRUE for wide format data frame (time and value columns), FALSE
otherwise

\subsubsection{Examples}\label{examples-53}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}} \FunctionTok{is\_wide}\NormalTok{()}
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{is\_wide}\NormalTok{()}
\NormalTok{dat\_in }\OtherTok{\textless{}{-}}\NormalTok{ monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_tslist}\NormalTok{()}
\NormalTok{wide\_df }\OtherTok{\textless{}{-}} \FunctionTok{is\_wide}\NormalTok{(dat\_in)}
\NormalTok{x\_mod }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (wide\_df) tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{(dat\_in) }\ControlFlowTok{else}\NormalTok{ tsbox}\SpecialCharTok{::}\FunctionTok{ts\_tbl}\NormalTok{(dat\_in)}
\NormalTok{ans }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (wide\_df) tsbox}\SpecialCharTok{::}\FunctionTok{ts\_wide}\NormalTok{(x\_mod) }\ControlFlowTok{else}\NormalTok{ tsbox}\SpecialCharTok{::}\FunctionTok{copy\_class}\NormalTok{(x\_mod, dat\_in)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::set\_attr\_tslist()}\label{fcutilsset_attr_tslist}

\subsubsection{Description}\label{description-54}

Set class attribute to tslist

\subsubsection{Usage}\label{usage-54}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set\_attr\_tslist}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-54}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & list, typically a result of purrr::map() applied to a
tslist \\
\end{longtable}

\subsubsection{Details}\label{details-16}

A purrr::map() function applied to a tslist (obtained by
tsbox::ts\_tslist()) drops the tslist class attribute. This function
resets that attribute.

\subsubsection{Value}\label{value-54}

list with class attributes set to list and tslist

\subsubsection{Examples}\label{examples-54}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_tslist}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  purrr}\SpecialCharTok{::}\FunctionTok{map}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{ .x }\SpecialCharTok{/} \DecValTok{1000}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{set\_attr\_tslist}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_tbl}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_wide}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\section{Data field operations}\label{sec-field}

\subsection{tsbox::ts\_c()}\label{tsboxts_c}

\subsubsection{Description}\label{description-55}

Collect time series as multiple time series.

\subsubsection{Usage}\label{usage-55}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_c}\NormalTok{(...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-55}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{...} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\end{longtable}

\subsubsection{Details}\label{details-17}

In data frame objects, multiple time series are stored in a long data
frame. In \texttt{ts} and \texttt{xts} objects, time series are combined
horizontally.

\subsubsection{Value}\label{value-55}

a ts-boxable object of the same class as the input, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}. If series of different classes are combined, the
class of the first series is used (if possible).

\subsubsection{See Also}\label{see-also-2}

ts\_bind, to bind multiple time series to a single series.

\subsubsection{Examples}\label{examples-55}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_c}\NormalTok{(mdeaths, fdeaths)}

\FunctionTok{ts\_c}\NormalTok{(}\FunctionTok{ts\_df}\NormalTok{(EuStockMarkets), AirPassengers)}

\DocumentationTok{\#\# labeling}
\NormalTok{x1 }\OtherTok{\textless{}{-}} \FunctionTok{ts\_c}\NormalTok{(}
  \StringTok{\textasciigrave{}}\AttributeTok{International Airline Passengers}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{ts\_xts}\NormalTok{(AirPassengers),}
  \StringTok{\textasciigrave{}}\AttributeTok{Deaths from Lung Diseases}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ ldeaths}
\NormalTok{)}
\FunctionTok{head}\NormalTok{(x1)}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_default()}\label{tsboxts_default}

\subsubsection{Description}\label{description-56}

In data frame objects (\texttt{data.frame}, \texttt{tibble},
\texttt{data.table}), tsbox automatically detects the time and the value
column. This function changes the column names to the defaults
(\texttt{time}, \texttt{value}), so that auto-detection can be avoided
in future operations.

\subsubsection{Usage}\label{usage-56}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_default}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-56}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\end{longtable}

\subsubsection{Value}\label{value-56}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{Examples}\label{examples-56}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{ts\_df}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(mdeaths, fdeaths))}
\DocumentationTok{\#\# non{-}default colnames}
\FunctionTok{colnames}\NormalTok{(df) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"id"}\NormalTok{, }\StringTok{"date"}\NormalTok{, }\StringTok{"count"}\NormalTok{)}
\DocumentationTok{\#\# switch back to default colnames}
\FunctionTok{ts\_default}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_pick()}\label{tsboxts_pick}

\subsubsection{Description}\label{description-57}

Pick (and optionally rename) series from multiple time series.

\subsubsection{Usage}\label{usage-57}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_pick}\NormalTok{(x, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-57}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{...} & character string(s), names of the series to be picked, or
integer, with positions. If arguments are named, the series will be
renamed. \\
\end{longtable}

\subsubsection{Value}\label{value-57}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{Examples}\label{examples-57}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Interactive use}

\FunctionTok{ts\_plot}\NormalTok{(}\FunctionTok{ts\_pick}\NormalTok{(}
\NormalTok{  EuStockMarkets,}
  \StringTok{\textasciigrave{}}\AttributeTok{My Dax}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"DAX"}\NormalTok{,}
  \StringTok{\textasciigrave{}}\AttributeTok{My Smi}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"SMI"}
\NormalTok{))}
\FunctionTok{ts\_pick}\NormalTok{(EuStockMarkets, }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\FunctionTok{ts\_pick}\NormalTok{(EuStockMarkets, }\StringTok{\textasciigrave{}}\AttributeTok{My Dax}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"DAX"}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{My Smi}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"SMI"}\NormalTok{)}

\DocumentationTok{\#\# Programming use}
\NormalTok{to.be.picked.and.renamed }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{My Dax}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"DAX"}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{My Smi}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"SMI"}\NormalTok{)}
\FunctionTok{ts\_pick}\NormalTok{(EuStockMarkets, to.be.picked.and.renamed)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::get\_var()}\label{fcutilsget_var}

\subsubsection{Description}\label{description-58}

Construct a series name from variable components and retrieve the series

\subsubsection{Usage}\label{usage-58}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{get\_var}\NormalTok{(ser\_in, }\AttributeTok{env =} \FunctionTok{parent.frame}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-58}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{ser\_in} & a variable name (character string with substituted
expressions) \\
\texttt{env} & environment where the expression should be evaluated \\
\end{longtable}

\subsubsection{Value}\label{value-58}

variable

\subsubsection{Examples}\label{examples-58}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ser\_i }\OtherTok{\textless{}{-}} \StringTok{"\_NF"}
\NormalTok{cnty\_i }\OtherTok{\textless{}{-}} \StringTok{"HI"}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{\%$\%} \FunctionTok{get\_var}\NormalTok{(}\StringTok{"E\{ser\_i\}\_\{cnty\_i\}"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::rename\_udaman()}\label{fcutilsrename_udaman}

\subsubsection{Description}\label{description-59}

Format series names to udaman format (mnemonic@loc.freq)

\subsubsection{Usage}\label{usage-59}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rename\_udaman}\NormalTok{(ser\_in, }\AttributeTok{freq =} \ConstantTok{NULL}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-59}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{ser\_in} & series names (character "mnemonic\_loc",
"mnemonic\_AT\_loc\_freq", "mnemonic\_\_loc\_freq",
mnemonic@loc.freq") \\
\texttt{freq} & frequency of the series, required if not contained in
the series name (character "D", "W", "M", "Q", "S", "A") \\
\end{longtable}

\subsubsection{Value}\label{value-59}

series names following udaman convention "mnemonic@loc.freq"

\subsubsection{Examples}\label{examples-59}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rename\_udaman}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"E\_NF\_HI"}\NormalTok{, }\StringTok{"ECT\_HI"}\NormalTok{, }\StringTok{"E\_TU\_HAW"}\NormalTok{), }\AttributeTok{freq =} \StringTok{"M"}\NormalTok{)}
\FunctionTok{rename\_udaman}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"E\_NF\_\_HI\_M"}\NormalTok{, }\StringTok{"ECT\_\_HI\_M"}\NormalTok{, }\StringTok{"VAP\_\_HAW\_W"}\NormalTok{))}
\FunctionTok{rename\_udaman}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"E\_NF\_AT\_HI\_M"}\NormalTok{, }\StringTok{"ECT\_AT\_HI\_M"}\NormalTok{, }\StringTok{"VAP\_AT\_HAW\_W"}\NormalTok{))}
\FunctionTok{rename\_udaman}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"E\_NF@HI.M"}\NormalTok{, }\StringTok{"ECT@HI.M"}\NormalTok{, }\StringTok{"VAP@HAW.W"}\NormalTok{))}
\FunctionTok{rename\_udaman}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"SH\_US@HI.M"}\NormalTok{, }\StringTok{"SH\_JP\_\_HON\_M"}\NormalTok{))}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{rename\_with}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{rename\_udaman}\NormalTok{(., }\AttributeTok{freq =} \StringTok{"M"}\NormalTok{), }\AttributeTok{.cols =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{rename\_with}\NormalTok{(rename\_udaman, }\AttributeTok{freq =} \StringTok{"M"}\NormalTok{, }\AttributeTok{.cols =} \SpecialCharTok{!}\NormalTok{time)}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{id =} \FunctionTok{rename\_udaman}\NormalTok{(id, }\AttributeTok{freq =} \StringTok{"M"}\NormalTok{)) }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\section{Plots}\label{sec-plots}

\subsection{tsbox::ts\_ggplot()}\label{tsboxts_ggplot}

\subsubsection{Description}\label{description-60}

\texttt{ts\_ggplot()} has the same syntax and produces a similar plot as
\texttt{ts\_plot()}, but uses the
\href{https://ggplot2.tidyverse.org/}{ggplot2} graphic system, and can
be customized. With \texttt{theme\_tsbox()} and
\texttt{scale\_color\_tsbox()}, the output of \texttt{ts\_ggplot} has a
similar look and feel.

\subsubsection{Usage}\label{usage-60}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_ggplot}\NormalTok{(..., title, subtitle, }\AttributeTok{ylab =} \StringTok{""}\NormalTok{)}

\FunctionTok{theme\_tsbox}\NormalTok{(}\AttributeTok{base\_family =} \FunctionTok{getOption}\NormalTok{(}\StringTok{"ts\_font"}\NormalTok{, }\StringTok{""}\NormalTok{), }\AttributeTok{base\_size =} \DecValTok{12}\NormalTok{)}

\FunctionTok{colors\_tsbox}\NormalTok{()}

\FunctionTok{scale\_color\_tsbox}\NormalTok{(...)}

\FunctionTok{scale\_fill\_tsbox}\NormalTok{(...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-60}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{...} & ts-boxable time series, objects of class \texttt{ts},
\texttt{xts}, \texttt{data.frame}, \texttt{data.table}, or
\texttt{tibble}. For \texttt{scale\_} functions, arguments passed to
subfunctions. \\
\texttt{title} & title (optional) \\
\texttt{subtitle} & subtitle (optional) \\
\texttt{ylab} & ylab (optional) \\
\texttt{base\_family} & base font family (can also be set via
\texttt{options}) \\
\texttt{base\_size} & base font size \\
\end{longtable}

\subsubsection{Details}\label{details-18}

Both \texttt{ts\_plot()} and \texttt{ts\_ggplot()} combine multiple ID
dimensions into a single dimension. To plot multiple dimensions in
different shapes, facets, etc., use standard ggplot (see examples).

\subsubsection{See Also}\label{see-also-3}

\texttt{ts\_plot()}, for a simpler and faster plotting function.
\texttt{ts\_dygraphs()}, for interactive time series plots.

\subsubsection{Examples}\label{examples-60}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# using the ggplot2 graphic system}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ts\_ggplot}\NormalTok{(}\AttributeTok{total =}\NormalTok{ ldeaths, }\AttributeTok{female =}\NormalTok{ fdeaths, }\AttributeTok{male =}\NormalTok{ mdeaths)}
\NormalTok{p}

\DocumentationTok{\#\# with themes for the look and feel of ts\_plot()}
\NormalTok{p }\SpecialCharTok{+} \FunctionTok{theme\_tsbox}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{scale\_color\_tsbox}\NormalTok{()}

\DocumentationTok{\#\# also use themes with standard ggplot}
\FunctionTok{suppressMessages}\NormalTok{(}\FunctionTok{library}\NormalTok{(ggplot2))}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{ts\_df}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(}\AttributeTok{total =}\NormalTok{ ldeaths, }\AttributeTok{female =}\NormalTok{ fdeaths, }\AttributeTok{male =}\NormalTok{ mdeaths))}
\FunctionTok{ggplot}\NormalTok{(df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ time, }\AttributeTok{y =}\NormalTok{ value)) }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\StringTok{"id"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_tsbox}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_tsbox}\NormalTok{()}


\DocumentationTok{\#\#\# tsbox::ts\_ggplot()}
\FunctionTok{library}\NormalTok{(dataseries)}
\NormalTok{dta }\OtherTok{\textless{}{-}} \FunctionTok{ds}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"GDP.PBRTT.A.R"}\NormalTok{, }\StringTok{"CCI.CCIIR"}\NormalTok{), }\StringTok{"xts"}\NormalTok{)}
\FunctionTok{ts\_ggplot}\NormalTok{(}\FunctionTok{ts\_scale}\NormalTok{(}\FunctionTok{ts\_span}\NormalTok{(}
  \FunctionTok{ts\_c}\NormalTok{(}
    \StringTok{\textasciigrave{}}\AttributeTok{GDP Growth}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{ts\_pc}\NormalTok{(dta[, }\StringTok{"GDP.PBRTT.A.R"}\NormalTok{]),}
    \StringTok{\textasciigrave{}}\AttributeTok{Consumer Sentiment Index}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ dta[, }\StringTok{"CCI.CCIIR"}\NormalTok{]}
\NormalTok{  ),}
  \AttributeTok{start =} \StringTok{"1995{-}01{-}01"}
\NormalTok{))) }\SpecialCharTok{+}
\NormalTok{  ggplot2}\SpecialCharTok{::}\FunctionTok{ggtitle}\NormalTok{(}\StringTok{"GDP and Consumer Sentiment"}\NormalTok{, }\AttributeTok{subtitle =} \StringTok{"normalized"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_tsbox}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_tsbox}\NormalTok{()}

\DocumentationTok{\#\#\# tsbox::ts\_ggplot()}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_plot()}\label{tsboxts_plot}

\subsubsection{Description}\label{description-61}

\texttt{ts\_plot()} is a fast and simple plotting function for
ts-boxable time series, with limited customizability. For more theme
options, use \texttt{ts\_ggplot()}.

\subsubsection{Usage}\label{usage-61}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_plot}\NormalTok{(..., title, subtitle, }\AttributeTok{ylab =} \StringTok{""}\NormalTok{, }\AttributeTok{family =} \FunctionTok{getOption}\NormalTok{(}\StringTok{"ts\_font"}\NormalTok{, }\StringTok{"sans"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-61}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{...} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{title} & title (optional) \\
\texttt{subtitle} & subtitle (optional) \\
\texttt{ylab} & ylab (optional) \\
\texttt{family} & font family (optional, can also be set via
\texttt{options}) \\
\end{longtable}

\subsubsection{Details}\label{details-19}

Both \texttt{ts\_plot()} and \texttt{ts\_ggplot()} combine multiple ID
dimensions into a single dimension. To plot multiple dimensions in
different shapes, facets, etc., use standard ggplot.

Limited customizability of \texttt{ts\_plot} is available via options.
See examples.

\subsubsection{See Also}\label{see-also-4}

\texttt{ts\_ggplot()}, for a plotting function based on ggplot2.
\texttt{ts\_dygraphs()}, for interactive time series plots.
\texttt{ts\_save()} to save a plot to the file system.

\subsubsection{Examples}\label{examples-61}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_plot}\NormalTok{(}
\NormalTok{  AirPassengers,}
  \AttributeTok{title =} \StringTok{"Airline passengers"}\NormalTok{,}
  \AttributeTok{subtitle =} \StringTok{"The classic Box \& Jenkins airline data"}
\NormalTok{)}

\DocumentationTok{\#\# naming arguments}
\FunctionTok{ts\_plot}\NormalTok{(}\AttributeTok{total =}\NormalTok{ ldeaths, }\AttributeTok{female =}\NormalTok{ fdeaths, }\AttributeTok{male =}\NormalTok{ mdeaths)}

\DocumentationTok{\#\# using different ts{-}boxable objects}
\FunctionTok{ts\_plot}\NormalTok{(}\FunctionTok{ts\_scale}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(}
  \FunctionTok{ts\_xts}\NormalTok{(airmiles),}
  \FunctionTok{ts\_tbl}\NormalTok{(co2),}
\NormalTok{  JohnsonJohnson,}
  \FunctionTok{ts\_df}\NormalTok{(discoveries)}
\NormalTok{)))}

\DocumentationTok{\#\# customize ts\_plot}
\NormalTok{op }\OtherTok{\textless{}{-}} \FunctionTok{options}\NormalTok{(}
  \AttributeTok{tsbox.lwd =} \DecValTok{3}\NormalTok{,}
  \AttributeTok{tsbox.col =} \FunctionTok{c}\NormalTok{(}\StringTok{"gray51"}\NormalTok{, }\StringTok{"gray11"}\NormalTok{),}
  \AttributeTok{tsbox.lty =} \StringTok{"dashed"}
\NormalTok{)}
\FunctionTok{ts\_plot}\NormalTok{(}
  \StringTok{"Female"} \OtherTok{=}\NormalTok{ fdeaths,}
  \StringTok{"Male"} \OtherTok{=}\NormalTok{ mdeaths}
\NormalTok{)}
\FunctionTok{options}\NormalTok{(op) }\DocumentationTok{\#\# restore defaults}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_save()}\label{tsboxts_save}

\subsubsection{Description}\label{description-62}

Save Previous Plot

\subsubsection{Usage}\label{usage-62}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_save}\NormalTok{(}
  \AttributeTok{filename =} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{".pdf"}\NormalTok{),}
  \AttributeTok{width =} \DecValTok{10}\NormalTok{,}
  \AttributeTok{height =} \DecValTok{5}\NormalTok{,}
  \AttributeTok{device =} \ConstantTok{NULL}\NormalTok{,}
  \AttributeTok{open =} \ConstantTok{TRUE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-62}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{filename} & filename \\
\texttt{width} & width \\
\texttt{height} & height \\
\texttt{device} & device \\
\texttt{open} & logical, should the saved plot be opened? \\
\end{longtable}

\subsubsection{Value}\label{value-60}

invisible \texttt{TRUE}, if successful

\subsubsection{Examples}\label{examples-62}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_plot}\NormalTok{(AirPassengers)}
\NormalTok{tf }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{".pdf"}\NormalTok{)}
\FunctionTok{ts\_save}\NormalTok{(tf)}
\FunctionTok{unlink}\NormalTok{(tf)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::plot\_1()}\label{fcutilsplot_1}

\subsubsection{Description}\label{description-63}

Interactive plot with level and growth rate

\subsubsection{Usage}\label{usage-63}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot\_1}\NormalTok{(}
\NormalTok{  x,}
  \AttributeTok{rng\_start =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{10}\NormalTok{)),}
  \AttributeTok{rng\_end =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{+}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{2}\NormalTok{)),}
  \AttributeTok{height =} \DecValTok{300}\NormalTok{,}
  \AttributeTok{width =} \DecValTok{900}\NormalTok{,}
  \AttributeTok{yoy\_gr =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{gr\_1 =} \ConstantTok{TRUE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-63}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object to plot (e.g.~time series of history,
oldsol, sol) \\
\texttt{rng\_start} & start of zoom range ("YYYY-MM-DD") \\
\texttt{rng\_end} & end of the zoom range ("YYYY-MM-DD") \\
\texttt{height} & height of a single panel (px) \\
\texttt{width} & width of a single panel (px) \\
\texttt{yoy\_gr} & year-over-year (default) or annualized growth \\
\texttt{gr\_1} & only show growth for the first series (default) \\
\end{longtable}

\subsubsection{Value}\label{value-61}

a dygraph plot

\subsubsection{Examples}\label{examples-63}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{plot\_1}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_TU\_HI"}\NormalTok{, }\StringTok{"ECT\_HI"}\NormalTok{, }\StringTok{"EMN\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{plot\_1}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::plot\_2ax()}\label{fcutilsplot_2ax}

\subsubsection{Description}\label{description-64}

Interactive lineplot with two axes

\subsubsection{Usage}\label{usage-64}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot\_2ax}\NormalTok{(}
\NormalTok{  x,}
  \AttributeTok{rng\_start =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{10}\NormalTok{)),}
  \AttributeTok{rng\_end =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{+}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{2}\NormalTok{)),}
  \AttributeTok{height =} \DecValTok{300}\NormalTok{,}
  \AttributeTok{width =} \DecValTok{900}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-64}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object to plot (e.g.~time series of history,
oldsol, sol) \\
\texttt{rng\_start} & start of zoom range ("YYYY-MM-DD") \\
\texttt{rng\_end} & end of the zoom range ("YYYY-MM-DD") \\
\texttt{height} & height of a single panel (px) \\
\texttt{width} & width of a single panel (px) \\
\end{longtable}

\subsubsection{Value}\label{value-62}

a dygraph plot

\subsubsection{Examples}\label{examples-64}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{plot\_2ax}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_TU\_HI"}\NormalTok{, }\StringTok{"ECT\_HI"}\NormalTok{, }\StringTok{"EMN\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{plot\_2ax}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::plot\_comp\_2()}\label{fcutilsplot_comp_2}

\subsubsection{Description}\label{description-65}

Two-panel plot of levels and growth rates

\subsubsection{Usage}\label{usage-65}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot\_comp\_2}\NormalTok{(}
\NormalTok{  x,}
  \AttributeTok{rng\_start =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{10}\NormalTok{)),}
  \AttributeTok{rng\_end =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{+}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{2}\NormalTok{)),}
  \AttributeTok{height =} \DecValTok{300}\NormalTok{,}
  \AttributeTok{width =} \DecValTok{900}\NormalTok{,}
  \AttributeTok{yoy\_gr =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{gr\_bar =} \ConstantTok{FALSE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-65}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object to plot \\
\texttt{rng\_start} & start of the zoom range ("YYYY-MM-DD") \\
\texttt{rng\_end} & end of the zoom range ("YYYY-MM-DD") \\
\texttt{height} & height of a single panel (px) \\
\texttt{width} & width of a single panel (px) \\
\texttt{yoy\_gr} & year-over-year (default) or annualized growth \\
\texttt{gr\_bar} & show bars or line (default) for the growth series \\
\end{longtable}

\subsubsection{Value}\label{value-63}

a list with two dygraph plots (level, growth)

\subsubsection{Examples}\label{examples-65}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{plot\_comp\_2}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_TU\_HI"}\NormalTok{, }\StringTok{"ECT\_HI"}\NormalTok{, }\StringTok{"EMN\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{plot\_comp\_2}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::plot\_comp\_3()}\label{fcutilsplot_comp_3}

\subsubsection{Description}\label{description-66}

Three-panel plot of levels, index, and growth rates

\subsubsection{Usage}\label{usage-66}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot\_comp\_3}\NormalTok{(}
\NormalTok{  x,}
  \AttributeTok{base\_date =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{10}\NormalTok{)),}
  \AttributeTok{rng\_start =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{10}\NormalTok{)),}
  \AttributeTok{rng\_end =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{+}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{2}\NormalTok{)),}
  \AttributeTok{height =} \DecValTok{300}\NormalTok{,}
  \AttributeTok{width =} \DecValTok{900}\NormalTok{,}
  \AttributeTok{yoy\_gr =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{gr\_bar =} \ConstantTok{FALSE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-66}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object to plot \\
\texttt{base\_date} & base period for the indexed series
("YYYY-MM-DD") \\
\texttt{rng\_start} & start of the zoom range ("YYYY-MM-DD") \\
\texttt{rng\_end} & end of the zoom range ("YYYY-MM-DD") \\
\texttt{height} & height of a single panel (px) \\
\texttt{width} & width of a single panel (px) \\
\texttt{yoy\_gr} & year-over-year (default) or annualized growth \\
\texttt{gr\_bar} & show bars or line (default) for the growth series \\
\end{longtable}

\subsubsection{Value}\label{value-64}

a list with three dygraph plots (level, index, growth)

\subsubsection{Examples}\label{examples-66}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{plot\_comp\_3}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_TU\_HI"}\NormalTok{, }\StringTok{"ECT\_HI"}\NormalTok{, }\StringTok{"EMN\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{plot\_comp\_3}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::plot\_fc()}\label{fcutilsplot_fc}

\subsubsection{Description}\label{description-67}

Interactive plot with level and growth rate for forecast series

\subsubsection{Usage}\label{usage-67}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot\_fc}\NormalTok{(}
\NormalTok{  x,}
  \AttributeTok{rng\_start =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{10}\NormalTok{)),}
  \AttributeTok{rng\_end =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{+}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{2}\NormalTok{)),}
  \AttributeTok{add\_table =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{table\_start =}\NormalTok{ rng\_start,}
  \AttributeTok{table\_end =}\NormalTok{ rng\_end,}
  \AttributeTok{height =} \DecValTok{300}\NormalTok{,}
  \AttributeTok{width =} \DecValTok{900}\NormalTok{,}
  \AttributeTok{yoy\_gr =} \ConstantTok{TRUE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-67}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable object to plot (min 1, max 3 time series)
(e.g.~current fcst, old fcst, history) \\
\texttt{rng\_start} & start of zoom range ("YYYY-MM-DD") \\
\texttt{rng\_end} & end of the zoom range ("YYYY-MM-DD") \\
\texttt{add\_table} & should a data table be appended to the plot?
(default = TRUE) \\
\texttt{table\_start} & start of table range ("YYYY-MM-DD") (all data =
NULL, default = rng\_start) \\
\texttt{table\_end} & end of table range ("YYYY-MM-DD") (all data =
NULL, default = rng\_end) \\
\texttt{height} & height of a single panel (px) \\
\texttt{width} & width of a single panel (px) \\
\texttt{yoy\_gr} & year-over-year (default) or annualized growth \\
\end{longtable}

\subsubsection{Value}\label{value-65}

a dygraph plot

\subsubsection{Examples}\label{examples-67}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_data\_example }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{plot\_fc}\NormalTok{()}
\NormalTok{quarterly\_data\_example }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_pick}\NormalTok{(}\StringTok{"E\_TU\_HI"}\NormalTok{, }\StringTok{"ECT\_HI"}\NormalTok{, }\StringTok{"EMN\_HI"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{plot\_fc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::save\_plot\_list()}\label{fcutilssave_plot_list}

\subsubsection{Description}\label{description-68}

Save a list of interactive plots to html

\subsubsection{Usage}\label{usage-68}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{save\_plot\_list}\NormalTok{(plot\_list, save\_loc)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-68}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{plot\_list} & a list of plots generated by fcutils::plot\_xxxx()
functions \\
\texttt{save\_loc} & location to save the plots to, including file
name \\
\end{longtable}

\subsubsection{Value}\label{value-66}

nothing (silently save the html to a user defined location)

\subsubsection{Examples}\label{examples-68}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# hold the plots in a list}
\NormalTok{plot\_out }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ monthly\_data\_example[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{] }\SpecialCharTok{|\textgreater{}} \FunctionTok{names}\NormalTok{()) \{}
\NormalTok{  plot\_out[[i]] }\OtherTok{\textless{}{-}} \FunctionTok{plot\_1}\NormalTok{(}
\NormalTok{    monthly\_data\_example }\SpecialCharTok{|\textgreater{}}\NormalTok{ tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{|\textgreater{}}
\NormalTok{      dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(stringr}\SpecialCharTok{::}\FunctionTok{str\_detect}\NormalTok{(id, i)),}
    \AttributeTok{rng\_start =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{{-}}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{5}\NormalTok{)),}
    \AttributeTok{rng\_end =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{+}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{years}\NormalTok{(}\DecValTok{7}\NormalTok{)),}
    \AttributeTok{width =} \DecValTok{1500}\NormalTok{, }\AttributeTok{height =} \DecValTok{650}\NormalTok{, }\AttributeTok{yoy\_gr =} \ConstantTok{TRUE}
\NormalTok{  )}
\NormalTok{\}}
\DocumentationTok{\#\# specify location of the output}
\NormalTok{save\_loc }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_c}\NormalTok{(}\StringTok{"\textasciitilde{}/Downloads/plots\_"}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{".html"}\NormalTok{)}
\DocumentationTok{\#\# combine a list of plots into a single html}

\NormalTok{plot\_out }\SpecialCharTok{|\textgreater{}} \FunctionTok{save\_plot\_list}\NormalTok{(save\_loc)}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::uhero\_theme()}\label{uherothemeuhero_theme}

\subsubsection{Description}\label{description-69}

Modifies the ggplot minimal theme to fit the style used for UHERO
reports/presentations.

\subsubsection{Usage}\label{usage-69}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{uhero\_theme}\NormalTok{(}\AttributeTok{layout =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-69}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{layout} & A boolean to indicate whether or not the theme is
being applied to a plot that is to be used in a UHERO report layout.
This defaults to false. If layout is TRUE, then the base size is set to
9 and the font family is set to open sans. If the parameter is FALSE,
then the base size is set to 30 and the font family is set to
opensans-semibold. Set layout to TRUE if the plot is being used for a
UHERO report. \\
\end{longtable}

\subsubsection{Examples}\label{examples-69}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plot }\OtherTok{\textless{}{-}}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot}\NormalTok{(ggplot2}\SpecialCharTok{::}\NormalTok{mpg) }\SpecialCharTok{+} \FunctionTok{uhero\_theme}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::uhero\_scale\_nums()}\label{uherothemeuhero_scale_nums}

\subsubsection{Description}\label{description-70}

This can be passed in to the labels parameter of ggplot scales like
scale\_x\_continous() or scale\_y\_continuous() If the max value of the
scale is larger than 1000, the tick labels will be scaled down with a
suffix added to the maximum value. For max values of at least 10\^{}3
but less than 10\^{}6, tick labels will be divided by 10\^{}3 with "K"
added to the label for the maximum value. For max values of at least
10\^{}6 but less than 10\^{}9, tick labels will be divided by 10\^{}6
with "M" added to the label for the maximum value. For max values of at
least 10\^{}9 but less than 10\^{}12, tick labels will be divided by
10\^{}9 with "B" added to the label for the maximum value.

\subsubsection{Usage}\label{usage-70}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{uhero\_scale\_nums}\NormalTok{(}
\NormalTok{  x,}
  \AttributeTok{scale\_limit =} \FunctionTok{max}\NormalTok{(x, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{prefix =} \StringTok{""}\NormalTok{,}
  \AttributeTok{percent =} \ConstantTok{FALSE}\NormalTok{,}
\NormalTok{  ...}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-70}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & Passed in from labels function. \\
\texttt{scale\_limit} & Defaults to the max value of the scale. \\
\texttt{prefix} & This is optional and defaults to an empty string. This
can be used to add things like currency labels, (i.e.~"\$100"). \\
\texttt{percent} & Boolean that defaults to false. Set the value to true
to add a "\%" to the maximum value tick label. \\
\texttt{...} & Additional arguments that can be passed to
R\textquotesingle s format(). \\
\end{longtable}

\subsubsection{Value}\label{value-67}

Returns a formatted string for the tick label.

\subsubsection{Examples}\label{examples-70}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{) }\SpecialCharTok{*} \DecValTok{100000}\NormalTok{,}
  \AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{10}\NormalTok{)}
\NormalTok{)}
\NormalTok{ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot}\NormalTok{(df, ggplot2}\SpecialCharTok{::}\FunctionTok{aes}\NormalTok{(x, y)) }\SpecialCharTok{+}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{ggplot2}\SpecialCharTok{::}\FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =} \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{uhero\_scale\_nums}\NormalTok{(x, }\AttributeTok{percent =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{+}
\NormalTok{ggplot2}\SpecialCharTok{::}\FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{labels =} \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{uhero\_scale\_nums}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::uhero\_colors()}\label{uherothemeuhero_colors}

\subsubsection{Description}\label{description-71}

Hex codes for a given color in the UHERO colors

\subsubsection{Usage}\label{usage-71}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{uhero\_colors}\NormalTok{(...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-71}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{...} & Names of the UHERO colors. There are 14 total: "blue",
"orange", "green", "purple", "cyan", "gray", "red", "light blue", "light
orange", "light green", "light purple", "light cyan", "light gray", and
"light red". \\
\end{longtable}

\subsubsection{Value}\label{value-68}

A list of colors with their HEX codes.

\subsubsection{Examples}\label{examples-71}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{uhero\_colors}\NormalTok{(}\StringTok{"blue"}\NormalTok{)}
\FunctionTok{uhero\_colors}\NormalTok{(}\StringTok{"blue"}\NormalTok{, }\StringTok{"light orange"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::uhero\_pal()}\label{uherothemeuhero_pal}

\subsubsection{Description}\label{description-72}

A palette generator for UHERO colors.

\subsubsection{Usage}\label{usage-72}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{uhero\_pal}\NormalTok{(}\AttributeTok{palette =} \StringTok{"primary"}\NormalTok{, }\AttributeTok{discrete =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{reverse =} \ConstantTok{FALSE}\NormalTok{, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-72}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{palette} & A string that defaults to "primary". This can also be
set to either "secondary" or "all". \\
\texttt{discrete} & A boolean that defaults to TRUE. Set to FALSE for a
continuous scale. \\
\texttt{reverse} & A boolean that defaults to FALSE. Set to TRUE to
reverse the color scale. \\
\texttt{...} & Additional parameters that can be passed to
\texttt{colorRampPalette} \\
\end{longtable}

\subsubsection{Examples}\label{examples-72}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{uhero\_pal}\NormalTok{()}
\FunctionTok{uhero\_pal}\NormalTok{(}\StringTok{"secondary"}\NormalTok{, }\AttributeTok{discrete =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{reverse =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::uhero\_scale\_colour()}\label{uherothemeuhero_scale_colour}

\subsubsection{Description}\label{description-73}

Uses \texttt{ggplot2::discrete\_scale} for the color aesthetic for
discrete scales and \texttt{ggplot2::scale\_colour\_gradientn} for the
color aesthetic on continuous scales. \texttt{uhero\_scale\_color} is
available as an alias.

\subsubsection{Usage}\label{usage-73}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{uhero\_scale\_colour}\NormalTok{(}\AttributeTok{palette =} \StringTok{"primary"}\NormalTok{, }\AttributeTok{discrete =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{reverse =} \ConstantTok{FALSE}\NormalTok{, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-73}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{palette} & A string that defaults to "primary". This can also be
set to either "secondary" or "all". \\
\texttt{discrete} & A boolean that defaults to TRUE. Set to FALSE for a
continuous scale. \\
\texttt{reverse} & A boolean that defaults to FALSE. Set to TRUE to
reverse the color scale. \\
\texttt{...} & Additional parameters that can be passed to
\texttt{ggplot2::discrete\_scale} or
\texttt{ggplot2::scale\_fill\_gradientn} \\
\end{longtable}

\subsubsection{Examples}\label{examples-73}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot}\NormalTok{(ggplot2}\SpecialCharTok{::}\NormalTok{mpg, ggplot2}\SpecialCharTok{::}\FunctionTok{aes}\NormalTok{(hwy, class, }\AttributeTok{color =}\NormalTok{ class)) }\SpecialCharTok{+}
\NormalTok{ggplot2}\SpecialCharTok{::}\FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
\FunctionTok{uhero\_scale\_colour}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::uhero\_scale\_fill()}\label{uherothemeuhero_scale_fill}

\subsubsection{Description}\label{description-74}

Uses \texttt{ggplot2::discrete\_scale} for the fill aesthetic for
discrete scales and \texttt{ggplot2::scale\_fill\_gradientn} for the
fill aesthetic on continuous scales.

\subsubsection{Usage}\label{usage-74}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{uhero\_scale\_fill}\NormalTok{(}\AttributeTok{palette =} \StringTok{"primary"}\NormalTok{, }\AttributeTok{discrete =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{reverse =} \ConstantTok{FALSE}\NormalTok{, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-74}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{palette} & A string that defaults to "primary". This can also be
set to either "secondary" or "all". \\
\texttt{discrete} & A boolean that defaults to TRUE. Set to FALSE for a
continuous scale. \\
\texttt{reverse} & A boolean that defaults to FALSE. Set to TRUE to
reverse the color scale. \\
\texttt{...} & Additional parameters that can be passed to
\texttt{ggplot2::discrete\_scale} or
\texttt{ggplot2::scale\_fill\_gradientn} \\
\end{longtable}

\subsubsection{Examples}\label{examples-74}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot}\NormalTok{(ggplot2}\SpecialCharTok{::}\NormalTok{mpg, ggplot2}\SpecialCharTok{::}\FunctionTok{aes}\NormalTok{(hwy, }\AttributeTok{fill =}\NormalTok{ class)) }\SpecialCharTok{+}
\NormalTok{ggplot2}\SpecialCharTok{::}\FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
\FunctionTok{uhero\_scale\_fill}\NormalTok{(}\AttributeTok{palette =} \StringTok{\textquotesingle{}secondary\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::uhero\_scale\_colour\_diverge()}\label{uherothemeuhero_scale_colour_diverge}

\subsubsection{Description}\label{description-75}

Uses \texttt{ggplot2::scale\_color\_gradient2}.
\texttt{uhero\_scale\_color\_diverge} is available as an alias.

\subsubsection{Usage}\label{usage-75}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{uhero\_scale\_colour\_diverge}\NormalTok{(}\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{low =} \StringTok{"orange"}\NormalTok{, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-75}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{high} & A string that defaults to "blue". Can accept any of the
other colors in \texttt{uhero\_color\_list}. \\
\texttt{low} & A string that defaults to "orange". Can accept any of the
other colors in \texttt{uhero\_color\_list}. \\
\texttt{...} & Any other parameters that can be passed to
\texttt{ggplot2::scale\_color\_gradient2} \\
\end{longtable}

\subsubsection{Examples}\label{examples-75}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
 \AttributeTok{x =} \FunctionTok{runif}\NormalTok{(}\DecValTok{100}\NormalTok{),}
 \AttributeTok{y =} \FunctionTok{runif}\NormalTok{(}\DecValTok{100}\NormalTok{),}
 \AttributeTok{z1 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{),}
 \AttributeTok{z2 =} \FunctionTok{abs}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{))}
\NormalTok{)}
\NormalTok{ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot}\NormalTok{(df, ggplot2}\SpecialCharTok{::}\FunctionTok{aes}\NormalTok{(x, y)) }\SpecialCharTok{+}
\NormalTok{ggplot2}\SpecialCharTok{::}\FunctionTok{geom\_point}\NormalTok{(ggplot2}\SpecialCharTok{::}\FunctionTok{aes}\NormalTok{(}\AttributeTok{colour =}\NormalTok{ z1)) }\SpecialCharTok{+}
\FunctionTok{uhero\_scale\_colour\_diverge}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::uhero\_scale\_fill\_diverge()}\label{uherothemeuhero_scale_fill_diverge}

\subsubsection{Description}\label{description-76}

Uses \texttt{ggplot2::scale\_fill\_gradient2}

\subsubsection{Usage}\label{usage-76}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{uhero\_scale\_fill\_diverge}\NormalTok{(}\AttributeTok{high =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{low =} \StringTok{"orange"}\NormalTok{, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-76}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{high} & A string that defaults to "blue". Can accept any of the
other colors in \texttt{uhero\_color\_list}. \\
\texttt{low} & A string that defaults to "orange". Can accept any of the
other colors in \texttt{uhero\_color\_list}. \\
\texttt{...} & Any other parameters that can be passed to
\texttt{ggplot2::scale\_fill\_gradient2} \\
\end{longtable}

\subsection{uherotheme::draw\_fcast\_layout()}\label{uherothemedraw_fcast_layout}

\subsubsection{Description}\label{description-77}

This modifies the size of the view port window to more accurately
reflect the size of the figure including the placement of elements like
data labels that would be used in a forecast layout.

\subsubsection{Usage}\label{usage-77}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{draw\_fcast\_layout}\NormalTok{(plot, }\AttributeTok{w =} \FloatTok{4.5}\NormalTok{, }\AttributeTok{h =} \FloatTok{2.45}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-77}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{plot} & Plot object \\
\texttt{w} & Width of the view port in inches, defaults to 4.5 \\
\texttt{h} & Height of the view port in inches, defaults to 2.45 \\
\end{longtable}

\subsubsection{Examples}\label{examples-76}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{) }\SpecialCharTok{*} \DecValTok{100000}\NormalTok{,}
  \AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{10}\NormalTok{)}
\NormalTok{)}
\NormalTok{plot }\OtherTok{\textless{}{-}}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot}\NormalTok{(df, ggplot2}\SpecialCharTok{::}\FunctionTok{aes}\NormalTok{(x, y)) }\SpecialCharTok{+}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{geom\_point}\NormalTok{()}
\FunctionTok{draw\_fcast\_layout}\NormalTok{(plot)}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::draw\_report\_layout()}\label{uherothemedraw_report_layout}

\subsubsection{Description}\label{description-78}

This modifies the size of the view port window to more accurately
reflect the size of the figure including the placement of elements like
data labels that would be used in a UHERO report layout. Sometimes
charts may need to be a different size, so the function does accept
parameters to change the width and height.

\subsubsection{Usage}\label{usage-78}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{draw\_report\_layout}\NormalTok{(plot, }\AttributeTok{w =} \FloatTok{5.6931}\NormalTok{, }\AttributeTok{h =} \DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-78}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{plot} & Plot object \\
\texttt{w} & Width of the view port in inches, defaults to 5.6931 \\
\texttt{h} & Height of the view port in inches, defaults to 4 \\
\end{longtable}

\subsubsection{Examples}\label{examples-77}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{) }\SpecialCharTok{*} \DecValTok{100000}\NormalTok{,}
  \AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{10}\NormalTok{)}
\NormalTok{)}
\NormalTok{plot }\OtherTok{\textless{}{-}}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot}\NormalTok{(df, ggplot2}\SpecialCharTok{::}\FunctionTok{aes}\NormalTok{(x, y)) }\SpecialCharTok{+}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{geom\_point}\NormalTok{()}
\FunctionTok{draw\_report\_layout}\NormalTok{(plot)}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::export\_fcast\_layout()}\label{uherothemeexport_fcast_layout}

\subsubsection{Description}\label{description-79}

Uses \texttt{ggplot2::ggsave} to save a copy of the chart. By default,
charts are sized at 4.5 x 2.45 inches. Sometimes charts may need to be
larger, so the export function does accept parameters to change the
width and height. Please try not to exceed 5 inches for the width. If
the exported file is intended for use in a forecast layout, please use a
\textquotesingle.svg\textquotesingle,
\textquotesingle.pdf\textquotesingle, or
\textquotesingle.eps\textquotesingle{} extension.

\subsubsection{Usage}\label{usage-79}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{export\_fcast\_layout}\NormalTok{(file\_name, forecast\_plot, }\AttributeTok{w =} \FloatTok{4.5}\NormalTok{, }\AttributeTok{h =} \FloatTok{2.45}\NormalTok{, }\AttributeTok{u =} \StringTok{"in"}\NormalTok{, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-79}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{file\_name} & A string for the file name, including the
extension. \\
\texttt{forecast\_plot} & Ggplot plot object. \\
\texttt{w} & Integer - width of the exported image, defaults to 4.5 \\
\texttt{h} & Integer - height of the exported image, defaults to 2.45 \\
\texttt{u} & A string for the units, defaults to "in" for inches \\
\texttt{...} & Additional parameters that can be passed to
ggplot2::ggsave \\
\end{longtable}

\subsubsection{Examples}\label{examples-78}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{) }\SpecialCharTok{*} \DecValTok{100000}\NormalTok{,}
  \AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{10}\NormalTok{)}
\NormalTok{)}
\NormalTok{plot }\OtherTok{\textless{}{-}}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot}\NormalTok{(df, ggplot2}\SpecialCharTok{::}\FunctionTok{aes}\NormalTok{(x, y)) }\SpecialCharTok{+}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{geom\_point}\NormalTok{()}
\FunctionTok{export\_fcast\_layout}\NormalTok{(}\StringTok{\textquotesingle{}plot.svg\textquotesingle{}}\NormalTok{, plot)}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::export\_report\_layout()}\label{uherothemeexport_report_layout}

\subsubsection{Description}\label{description-80}

Uses \texttt{ggplot2::ggsave} to save a copy of the chart. By default,
charts are sized at 5.6931 x 4 inches. Sometimes charts may need to be
larger, so the export function does accept parameters to change the
width and height. Please use a \textquotesingle.svg\textquotesingle,
\textquotesingle.pdf\textquotesingle, or
\textquotesingle.eps\textquotesingle{} extension when exporting for a
report layout.

\subsubsection{Usage}\label{usage-80}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{export\_report\_layout}\NormalTok{(file\_name, plot, }\AttributeTok{w =} \FloatTok{5.6931}\NormalTok{, }\AttributeTok{h =} \DecValTok{4}\NormalTok{, }\AttributeTok{u =} \StringTok{"in"}\NormalTok{, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-80}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{file\_name} & A string for the file name, including the
extension. \\
\texttt{plot} & Ggplot plot object. \\
\texttt{w} & Integer - width of the exported image, defaults to
5.6931 \\
\texttt{h} & Integer - height of the exported image, defaults to 4 \\
\texttt{u} & A string for the units, defaults to "in" for inches \\
\texttt{...} & Additional parameters that can be passed to
ggplot2::ggsave \\
\end{longtable}

\subsubsection{Examples}\label{examples-79}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{) }\SpecialCharTok{*} \DecValTok{100000}\NormalTok{,}
  \AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{10}\NormalTok{)}
\NormalTok{)}
\NormalTok{plot }\OtherTok{\textless{}{-}}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot}\NormalTok{(df, ggplot2}\SpecialCharTok{::}\FunctionTok{aes}\NormalTok{(x, y)) }\SpecialCharTok{+}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{geom\_point}\NormalTok{()}
\FunctionTok{export\_report\_layout}\NormalTok{(}\StringTok{\textquotesingle{}plot.svg\textquotesingle{}}\NormalTok{, plot)}
\end{Highlighting}
\end{Shaded}

\subsection{uherotheme::export\_plot()}\label{uherothemeexport_plot}

\subsubsection{Description}\label{description-81}

Uses \texttt{ggplot2::ggsave} to save a copy of the chart. By default
the exports are sized at 1920 x 1080 pixels.

\subsubsection{Usage}\label{usage-81}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{export\_plot}\NormalTok{(file\_name, plot, }\AttributeTok{w =} \DecValTok{1920}\NormalTok{, }\AttributeTok{h =} \DecValTok{1080}\NormalTok{, }\AttributeTok{u =} \StringTok{"px"}\NormalTok{, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-81}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{file\_name} & A string for the file name, including the
extension. \\
\texttt{plot} & Ggplot plot object. \\
\texttt{w} & Integer - width of the exported image, defaults to 1920 \\
\texttt{h} & Integer - height of the exported image, defaults to 1080 \\
\texttt{u} & A string for the units, defaults to "px" for pixels \\
\texttt{...} & Additional parameters that can be passed to
ggplot2::ggsave \\
\end{longtable}

\subsubsection{Examples}\label{examples-80}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{) }\SpecialCharTok{*} \DecValTok{100000}\NormalTok{,}
  \AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{10}\NormalTok{)}
\NormalTok{)}
\NormalTok{plot }\OtherTok{\textless{}{-}}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot}\NormalTok{(df, ggplot2}\SpecialCharTok{::}\FunctionTok{aes}\NormalTok{(x, y)) }\SpecialCharTok{+}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{geom\_point}\NormalTok{()}
\FunctionTok{export\_report\_layout}\NormalTok{(}\StringTok{\textquotesingle{}plot.png\textquotesingle{}}\NormalTok{, plot)}
\end{Highlighting}
\end{Shaded}

\section{tsbox extensions}\label{tsbox-extensions}

\subsection{tsbox::ts\_()}\label{tsboxts_}

\subsubsection{Description}\label{description-82}

\texttt{ts\_} turns an existing function into a function that can deal
with ts-boxable time series objects.

\subsubsection{Usage}\label{usage-82}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load\_suggested}\NormalTok{(pkg)}

\FunctionTok{ts\_}\NormalTok{(fun, }\AttributeTok{class =} \StringTok{"ts"}\NormalTok{, }\AttributeTok{vectorize =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{reclass =} \ConstantTok{TRUE}\NormalTok{)}

\FunctionTok{ts\_apply}\NormalTok{(x, fun, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-82}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{pkg} & external package, to be suggested (automatically added by
\texttt{ts\_}) \texttt{predict()}. (See examples) \\
\texttt{fun} & function, to be made available to all time series
classes \\
\texttt{class} & class that the function uses as its first argument \\
\texttt{vectorize} & should the function be vectorized? (not yet
implemented) \\
\texttt{reclass} & logical, should the new function return the same same
ts-boxable output as imputed? \\
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{...} & arguments passed to subfunction \\
\end{longtable}

\subsubsection{Details}\label{details-20}

The \texttt{ts\_} function is a constructor function for tsbox time
series functions. It can be used to wrap any function that works with
time series. The default is set to R base \texttt{"ts"} class.
\texttt{ts\_} deals with the conversion stuff,
\textquotesingle vectorizes\textquotesingle{} the function so that it
can be used with multiple time series.

\subsubsection{Value}\label{value-69}

A function that accepts ts-boxable time series as an input.

\subsubsection{See Also}\label{see-also-5}

ts\_examples, for a few useful examples of functions generated by
\texttt{ts\_}.

\href{https://docs.ropensci.org/tsbox/articles/ts-functions.html}{Vignette}
on how to make arbitrary functions ts-boxable.

\subsubsection{Examples}\label{examples-81}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_}\NormalTok{(rowSums)(}\FunctionTok{ts\_c}\NormalTok{(mdeaths, fdeaths))}
\FunctionTok{ts\_plot}\NormalTok{(}\AttributeTok{mean =} \FunctionTok{ts\_}\NormalTok{(rowMeans)(}\FunctionTok{ts\_c}\NormalTok{(mdeaths, fdeaths)), mdeaths, fdeaths)}
\FunctionTok{ts\_}\NormalTok{(}\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{predict}\NormalTok{(}\FunctionTok{prcomp}\NormalTok{(x)))(}\FunctionTok{ts\_c}\NormalTok{(mdeaths, fdeaths))}
\FunctionTok{ts\_}\NormalTok{(}\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{predict}\NormalTok{(}\FunctionTok{prcomp}\NormalTok{(x, }\AttributeTok{scale =} \ConstantTok{TRUE}\NormalTok{)))(}\FunctionTok{ts\_c}\NormalTok{(mdeaths, fdeaths))}
\FunctionTok{ts\_}\NormalTok{(dygraphs}\SpecialCharTok{::}\NormalTok{dygraph, }\AttributeTok{class =} \StringTok{"xts"}\NormalTok{)}

\DocumentationTok{\#\# attach series to serach path}
\NormalTok{ts\_attach }\OtherTok{\textless{}{-}} \FunctionTok{ts\_}\NormalTok{(attach, }\AttributeTok{class =} \StringTok{"tslist"}\NormalTok{, }\AttributeTok{reclass =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{ts\_attach}\NormalTok{(EuStockMarkets)}
\FunctionTok{ts\_plot}\NormalTok{(DAX, SMI)}
\FunctionTok{detach}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{tsbox::ts\_examples()}\label{tsboxts_examples}

\subsubsection{Description}\label{description-83}

Example Functions, Generated by ts\_. \texttt{ts\_prcomp} calculates the
principal components of multiple time series, \texttt{ts\_dygraphs}
generates an interactive graphical visualization, \texttt{ts\_forecast}
return an univariate forecast, \texttt{ts\_seas} the seasonally adjusted
series. \texttt{ts\_na\_interpolation} imputes missing values.

\subsubsection{Usage}\label{usage-83}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_prcomp}\NormalTok{(x, ...)}

\FunctionTok{ts\_dygraphs}\NormalTok{(x, ...)}

\FunctionTok{ts\_forecast}\NormalTok{(x, ...)}

\FunctionTok{ts\_seas}\NormalTok{(x, ...)}

\FunctionTok{ts\_na\_interpolation}\NormalTok{(x, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-83}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{x} & ts-boxable time series, an object of class \texttt{ts},
\texttt{xts}, \texttt{zoo}, \texttt{zooreg}, \texttt{data.frame},
\texttt{data.table}, \texttt{tbl}, \texttt{tbl\_ts}, \texttt{tbl\_time},
\texttt{tis}, \texttt{irts} or \texttt{timeSeries}. \\
\texttt{...} & further arguments, passed to the underlying function. For
help, consider these functions, e.g., stats::prcomp. \\
\end{longtable}

\subsubsection{Details}\label{details-21}

With the exception of \texttt{ts\_prcomp}, these functions depend on
external packages.

\subsubsection{Value}\label{value-70}

a ts-boxable object of the same class as \texttt{x}, i.e., an object of
class \texttt{ts}, \texttt{xts}, \texttt{zoo}, \texttt{zooreg},
\texttt{data.frame}, \texttt{data.table}, \texttt{tbl},
\texttt{tbl\_ts}, \texttt{tbl\_time}, \texttt{tis}, \texttt{irts} or
\texttt{timeSeries}.

\subsubsection{See Also}\label{see-also-6}

\href{https://docs.ropensci.org/tsbox/articles/ts-functions.html}{Vignette}
on how to make arbitrary functions ts-boxable.

\subsubsection{Examples}\label{examples-82}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ts\_plot}\NormalTok{(}
  \FunctionTok{ts\_scale}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(}
    \AttributeTok{Male =}\NormalTok{ mdeaths,}
    \AttributeTok{Female =}\NormalTok{ fdeaths,}
    \StringTok{\textasciigrave{}}\AttributeTok{First principal compenent}\StringTok{\textasciigrave{}} \OtherTok{=} \SpecialCharTok{{-}}\FunctionTok{ts\_prcomp}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(mdeaths, fdeaths))[, }\DecValTok{1}\NormalTok{]}
\NormalTok{  )),}
  \AttributeTok{title =} \StringTok{"Deaths from lung diseases"}\NormalTok{,}
  \AttributeTok{subtitle =} \StringTok{"Normalized values"}
\NormalTok{)}

\FunctionTok{ts\_plot}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(}
  \AttributeTok{male =}\NormalTok{ mdeaths, }\AttributeTok{female =}\NormalTok{ fdeaths,}
  \FunctionTok{ts\_forecast}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{male (fct)}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ mdeaths, }\StringTok{\textasciigrave{}}\AttributeTok{female (fct)}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ fdeaths))}
\NormalTok{),}
\AttributeTok{title =} \StringTok{"Deaths from lung diseases"}\NormalTok{,}
\AttributeTok{subtitle =} \StringTok{"Exponential smoothing forecast"}
\NormalTok{)}

\FunctionTok{ts\_plot}\NormalTok{(}
  \StringTok{\textasciigrave{}}\AttributeTok{Raw series}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ AirPassengers,}
  \StringTok{\textasciigrave{}}\AttributeTok{Adjusted series}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{ts\_seas}\NormalTok{(AirPassengers),}
  \AttributeTok{title =} \StringTok{"Airline passengers"}\NormalTok{,}
  \AttributeTok{subtitle =} \StringTok{"X{-}13 seasonal adjustment"}
\NormalTok{)}


\DocumentationTok{\#\# See ?imputeTS::na\_interpolation for options}
\NormalTok{dta }\OtherTok{\textless{}{-}} \FunctionTok{ts\_c}\NormalTok{(mdeaths, fdeaths)}
\NormalTok{dta[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{10}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\FunctionTok{head}\NormalTok{(}\FunctionTok{ts\_na\_interpolation}\NormalTok{(dta, }\AttributeTok{option =} \StringTok{"spline"}\NormalTok{))}

\FunctionTok{ts\_dygraphs}\NormalTok{(}\FunctionTok{ts\_c}\NormalTok{(mdeaths, EuStockMarkets))}
\end{Highlighting}
\end{Shaded}

\section{bimets and gets utilities}\label{bimets-and-gets-utilities}

\subsection{fcutils::set\_tsrange()}\label{fcutilsset_tsrange}

\subsubsection{Description}\label{description-84}

Set tsrange for behavioral equations to available data range

\subsubsection{Usage}\label{usage-84}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set\_tsrange}\NormalTok{(model\_w\_dat, }\AttributeTok{max\_lag =} \DecValTok{4}\NormalTok{, }\AttributeTok{eqns =} \ConstantTok{NULL}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-84}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{model\_w\_dat} & bimets model (with data) to be estimated \\
\texttt{max\_lag} & the largest lag (default = 4) in the model (to
offset starting point for estimation) \\
\texttt{eqns} & names of behavioral equations to set tsrange for
(default = NULL: all equations) \\
\end{longtable}

\subsubsection{Details}\label{details-22}

Find periods where all variables in the equation are available. Shift
beginning of the sample by max\_lag periods. Set the tsrange for each
equation (used in estimation).

\subsubsection{Value}\label{value-71}

bimets model with tsrange set for estimation

\subsubsection{Examples}\label{examples-83}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set\_tsrange}\NormalTok{(scen\_model\_dat, }\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::update\_eqs()}\label{fcutilsupdate_eqs}

\subsubsection{Description}\label{description-85}

Update a bimets model with new/modified equations

\subsubsection{Usage}\label{usage-85}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{update\_eqs}\NormalTok{(model\_1, model\_2, eqList)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-85}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{model\_1} & original estimated bimets model \\
\texttt{model\_2} & estimated bimets model containing updates (only
updated equations need to be estimated) \\
\texttt{eqList} & names of updated behavioral equations (vector of
strings), others taken from model\_1 (equations missing from model\_2
are removed) \\
\end{longtable}

\subsubsection{Details}\label{details-23}

Start by making a copy of the original model\textquotesingle s equations
(txt file). Re-specify some equations, add new equations, and remove not
needed equations. Load the new model as model\_2 and estimate the
modified/new equations (ok to estimate all). Replace the equations in
model\_2 that should remain the same as in model\_1 by the estimated
equations from model\_1. Equations that are to remain unchanged have to
be present in both model\_1 and model\_2, and not present in eqList.

\subsubsection{Value}\label{value-72}

estimated bimets model containing updates

\subsubsection{Examples}\label{examples-84}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{update\_eqs}\NormalTok{(scen\_model\_1\_est, scen\_model\_2\_est, }\FunctionTok{c}\NormalTok{(}\StringTok{"E\_NF\_AT\_HI\_Q"}\NormalTok{, }\StringTok{"Y\_R\_AT\_HI\_Q"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::extract\_data()}\label{fcutilsextract_data}

\subsubsection{Description}\label{description-86}

Parse gets output and extract underlying data (GETS model development)

\subsubsection{Usage}\label{usage-86}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{extract\_data}\NormalTok{(model\_in, y\_name)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-86}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{model\_in} & a model estimated by arx, isat, or getsm \\
\texttt{y\_name} & the actual name of the y variable \\
\end{longtable}

\subsubsection{Value}\label{value-73}

an xts containing the model variables

\subsubsection{Examples}\label{examples-85}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# save the data associated with a gets model}
\end{Highlighting}
\end{Shaded}

\subsection{fcutils::model\_equation()}\label{fcutilsmodel_equation}

\subsubsection{Description}\label{description-87}

Parse lm() output and convert into bimets equation (GETS model
development)

\subsubsection{Usage}\label{usage-87}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{model\_equation}\NormalTok{(model, ...)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Arguments}\label{arguments-87}

\begin{longtable}[]{@{}ll@{}}
\toprule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{model} & a model estimated by lm() (lm object) \\
\texttt{...} & arguments to format the coefficients e.g.~digits = 3 \\
\end{longtable}

\subsubsection{Value}\label{value-74}

a character vector containing the estimated equation (1) and bimets
components (2:4)

\subsubsection{Examples}\label{examples-86}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# this function combines coefficient estimates and variable names into an equation}
\DocumentationTok{\#\# in vector element 1 and into bimets components in vector elements 2{-}4.}
\DocumentationTok{\#\# https://stats.stackexchange.com/questions/63600/}
\DocumentationTok{\#\# how{-}to{-}translate{-}the{-}results{-}from{-}lm{-}to{-}an{-}equation}
\FunctionTok{data}\NormalTok{(}\StringTok{"UKDriverDeaths"}\NormalTok{, }\AttributeTok{package =} \StringTok{"datasets"}\NormalTok{)}
\NormalTok{uk }\OtherTok{\textless{}{-}} \FunctionTok{log10}\NormalTok{(UKDriverDeaths)}
\NormalTok{dfm }\OtherTok{\textless{}{-}}\NormalTok{ dynlm}\SpecialCharTok{::}\FunctionTok{dynlm}\NormalTok{(uk }\SpecialCharTok{\textasciitilde{}} \FunctionTok{L}\NormalTok{(uk, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{L}\NormalTok{(}\FunctionTok{log}\NormalTok{(uk), }\FunctionTok{c}\NormalTok{(}\DecValTok{5}\SpecialCharTok{:}\DecValTok{6}\NormalTok{, }\DecValTok{12}\NormalTok{)))}
\FunctionTok{model\_equation}\NormalTok{(dfm)}
\DocumentationTok{\#\# (1) "uk = {-} 0.12255631 + 0.42870091 * L(uk, 1:3)1 + 0.06306114 * L(uk, 1:3)2 {-} 0.09778518 *}
\DocumentationTok{\#\# L(uk, 1:3)3 + 0.37480999 * L(log(uk), c(5:6, 12))5 {-} 0.22709846 * L(log(uk), c(5:6, 12))6 +}
\DocumentationTok{\#\# 1.62340449 * L(log(uk), c(5:6, 12))12"}
\DocumentationTok{\#\# (2) "BEHAVIORAL\textgreater{} uk"}
\DocumentationTok{\#\# (3) "EQ\textgreater{} uk = b0 + b1 * TSLAG(uk, 1) + b2 * TSLAG(uk, 2) + b3 * TSLAG(uk, 3) + b4 *}
\DocumentationTok{\#\# TSLAG(LOG(uk), 5) + b5 * TSLAG(LOG(uk), 6) + b6 * TSLAG(LOG(uk), 12)"}
\DocumentationTok{\#\# (4) "COEFF\textgreater{} b0 b1 b2 b3 b4 b5 b6"}
\DocumentationTok{\#\#\# fcutils::model\_equation()}
\NormalTok{dfm }\OtherTok{\textless{}{-}}\NormalTok{ dynlm}\SpecialCharTok{::}\FunctionTok{dynlm}\NormalTok{(}\FunctionTok{d}\NormalTok{(}\FunctionTok{log}\NormalTok{(uk)) }\SpecialCharTok{\textasciitilde{}} \FunctionTok{L}\NormalTok{(uk, }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{11}\NormalTok{, }\DecValTok{12}\NormalTok{)), }\AttributeTok{start =} \FunctionTok{c}\NormalTok{(}\DecValTok{1975}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{end =} \FunctionTok{c}\NormalTok{(}\DecValTok{1982}\NormalTok{, }\DecValTok{12}\NormalTok{))}
\FunctionTok{model\_equation}\NormalTok{(dfm)}
\DocumentationTok{\#\# (1) "d(log(uk)) = 0.1018542 {-} 0.2379287 * L(uk, c(1, 11, 12))1 + 0.0368355 *}
\DocumentationTok{\#\# L(uk, c(1, 11, 12))11 + 0.1689896 * L(uk, c(1, 11, 12))12"}
\DocumentationTok{\#\# (2) "BEHAVIORAL\textgreater{} TSDELTA\_LOG\_uk"}
\DocumentationTok{\#\# (3) "EQ\textgreater{} TSDELTA(LOG(uk)) = b0 + b1 * TSLAG(uk, 1) + b2 * TSLAG(uk, 11) + b3 * TSLAG(uk, 12)"}
\DocumentationTok{\#\# (4) "COEFF\textgreater{} b0 b1 b2 b3"}
\end{Highlighting}
\end{Shaded}

\section{fcutils constants}\label{fcutils-constants}

The fcutils package assumes a date range for data sets. Unless specified
by the user, the start and end date are set by default to:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bnk\_start }\OtherTok{=} \StringTok{"1970{-}01{-}01"}
\NormalTok{bnk\_end }\OtherTok{=} \StringTok{"2060{-}12{-}31"}
\end{Highlighting}
\end{Shaded}

\bookmarksetup{startatroot}

\chapter{Best practices for time series data
manipulation}\label{sec-bestpract}

Use capital letters for series names. Special characters in variable
names require putting the name between backticks (e.g.~\texttt{N@US.A}).
Eliminate special characters at the time of loading the data from udaman
with the \texttt{rename} argument of the \texttt{fcutils::get\_series()}
function (Section~\ref{sec-io}) or using a long tibble.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hist\_q\_mod }\OtherTok{\textless{}{-}}\NormalTok{ hist\_q }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_tbl}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{id =}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_replace\_all}\NormalTok{(id, }\FunctionTok{c}\NormalTok{(}\StringTok{"@"} \OtherTok{=} \StringTok{"\_AT\_"}\NormalTok{, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{."} \OtherTok{=} \StringTok{"\_"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

Revert back to the udaman format with the
\texttt{fcutils::rename\_udaman()} function (Section~\ref{sec-field}).

Use the \emph{xts} format whenever you need a time series object.
Observations in a multivariate xts can be accessed by time and series
name in two ways: \texttt{mul\_var\_xts{[}time,\ ser\_name{]}} or
\texttt{mul\_var\_xts\$ser\_name{[}time{]}}.

Make sure all series are defined on the same range (default start =
bnk\_start, end = bnk\_end). Take advantage of the
\texttt{fcutils::make\_xts()} function and its defaults, e.g.~start and
end period (Section~\ref{sec-io}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{import\_xts }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_csv}\NormalTok{(here}\SpecialCharTok{::}\FunctionTok{here}\NormalTok{(}\StringTok{"data/raw"}\NormalTok{, stringr}\SpecialCharTok{::}\FunctionTok{str\_glue}\NormalTok{(}\StringTok{"\{exp\_id\_a\}.csv"}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(time) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_c}\NormalTok{(}
    \AttributeTok{temp =}\NormalTok{ fcutils}\SpecialCharTok{::}\FunctionTok{make\_xts}\NormalTok{(}\AttributeTok{per =} \StringTok{"year"}\NormalTok{) }\CommentTok{\# temporary variable to force start and end in import\_xts}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  magrittr}\SpecialCharTok{::}\FunctionTok{extract}\NormalTok{(, }\FunctionTok{str\_subset}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(.), }\StringTok{"temp"}\NormalTok{, }\AttributeTok{negate =} \ConstantTok{TRUE}\NormalTok{)) }\CommentTok{\# remove temp}
\end{Highlighting}
\end{Shaded}

If referring directly to a series with a static name, use the
\texttt{bank\$series} notation (this can be used on both the right and
the left hand side of the assignment, while \texttt{bank{[},\ series{]}}
can only be used for existing series in bank).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# find the last value in history}
\NormalTok{dat\_end }\OtherTok{\textless{}{-}}\NormalTok{ fcutils}\SpecialCharTok{::}\FunctionTok{find\_end}\NormalTok{(hist\_q}\SpecialCharTok{$}\NormalTok{N\_AT\_US\_Q)}
\CommentTok{\# same as}
\NormalTok{dat\_end }\OtherTok{\textless{}{-}}\NormalTok{ fcutils}\SpecialCharTok{::}\FunctionTok{find\_end}\NormalTok{(hist\_q[, N\_AT\_US\_Q])}
\end{Highlighting}
\end{Shaded}

Use \texttt{{[}fcutils::p(){]}} to select a period in xts objects,
otherwise use \texttt{tsbox::ts\_span()} (both in
Section~\ref{sec-tsinfo}).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# extend series with addfactored level}
\NormalTok{sol\_q}\SpecialCharTok{$}\NormalTok{N\_AT\_US\_SOLQ }\OtherTok{\textless{}{-}}\NormalTok{ hist\_q}\SpecialCharTok{$}\NormalTok{N\_AT\_US\_Q[}\FunctionTok{p}\NormalTok{(}\StringTok{""}\NormalTok{, dat\_end)] }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_bind}\NormalTok{(sol\_q}\SpecialCharTok{$}\NormalTok{NCEN\_AT\_US\_SOLQ[}\FunctionTok{p}\NormalTok{(dat\_end, }\StringTok{""}\NormalTok{)] }\SpecialCharTok{+}
    \FunctionTok{as.numeric}\NormalTok{(sol\_q}\SpecialCharTok{$}\NormalTok{N\_AT\_US\_SOLQ\_ADDLEV[dat\_end]))}
    
\CommentTok{\# addfactor for growth}
\NormalTok{sol\_q}\SpecialCharTok{$}\NormalTok{N\_AT\_US\_SOLQ\_ADDGRO[}\FunctionTok{p}\NormalTok{(dat\_end }\SpecialCharTok{+}\NormalTok{ fcutils}\SpecialCharTok{::}\FunctionTok{qtrs}\NormalTok{(}\DecValTok{1}\NormalTok{), dat\_end }\SpecialCharTok{+}\NormalTok{ fcutils}\SpecialCharTok{::}\FunctionTok{qtrs}\NormalTok{(}\DecValTok{4}\NormalTok{))] }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\FloatTok{0.35}

\CommentTok{\# extend history using growth rate}
\NormalTok{sol\_q}\SpecialCharTok{$}\NormalTok{N\_AT\_US\_SOLQ }\OtherTok{\textless{}{-}}\NormalTok{ sol\_q}\SpecialCharTok{$}\NormalTok{N\_AT\_US\_SOLQ[}\FunctionTok{p}\NormalTok{(}\StringTok{""}\NormalTok{, dat\_end)] }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_chain}\NormalTok{(tsbox}\SpecialCharTok{::}\FunctionTok{ts\_compound}\NormalTok{(sol\_q}\SpecialCharTok{$}\NormalTok{N\_AT\_US\_SOLQ\_GRO[}\FunctionTok{p}\NormalTok{(dat\_end, }\StringTok{""}\NormalTok{)]))}
\end{Highlighting}
\end{Shaded}

The \texttt{bank{[},seriesname{]}} notation only works for
\emph{existing} xts series on the left of the assignment (it can also be
used on the right). \texttt{seriesname} can be determined at runtime

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# initialize the lhs series in the "bank"}
\NormalTok{hist\_a}\SpecialCharTok{$}\NormalTok{temp }\OtherTok{\textless{}{-}} \FunctionTok{make\_xts}\NormalTok{()}
\FunctionTok{names}\NormalTok{(hist\_a)[}\FunctionTok{names}\NormalTok{(hist\_a) }\SpecialCharTok{==} \StringTok{"temp"}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_glue}\NormalTok{(}\StringTok{"E\{ser\_i\}\_AT\_\{cnty\_i\}\_ADD"}\NormalTok{)}

\CommentTok{\# calculate expression and assign to lhs}
\NormalTok{hist\_a[, stringr}\SpecialCharTok{::}\FunctionTok{str\_glue}\NormalTok{(}\StringTok{"E\{ser\_i\}\_AT\_\{cnty\_i\}\_SH"}\NormalTok{)] }\OtherTok{\textless{}{-}} 
\NormalTok{  (hist\_a[, stringr}\SpecialCharTok{::}\FunctionTok{str\_glue}\NormalTok{(}\StringTok{"E\{ser\_i\}\_AT\_\{cnty\_i\}"}\NormalTok{)] }\SpecialCharTok{/}\NormalTok{ hist\_a[, stringr}\SpecialCharTok{::}\FunctionTok{str\_glue}\NormalTok{(}\StringTok{"E\_NF\_AT\_\{cnty\_i\}"}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

Alternatively, make multiple series in \emph{bank} available by
\texttt{magrittr::\%\$\%} and retrieve inividual series by
\texttt{fcutils::get\_var()} on the right (Section~\ref{sec-field}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hist\_a[, stringr}\SpecialCharTok{::}\FunctionTok{str\_glue}\NormalTok{(}\StringTok{"E\{ser\_i\}\_AT\_\{cnty\_i\}\_SH"}\NormalTok{)] }\OtherTok{\textless{}{-}}\NormalTok{ hist\_a }\SpecialCharTok{\%$\%}
\NormalTok{  (fcutils}\SpecialCharTok{::}\FunctionTok{get\_var}\NormalTok{(}\StringTok{"E\{ser\_i\}\_AT\_\{cnty\_i\}"}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ fcutils}\SpecialCharTok{::}\FunctionTok{get\_var}\NormalTok{(}\StringTok{"E\_NF\_AT\_\{cnty\_i\}"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Conversion to bimets format requires data in a particular \emph{tslist}
format. Convert xts to tslist using \texttt{tsbox::ts\_tslist()}. The
\texttt{fcutils::set\_attr\_tslist()} function adds a ``tslist''
attribute to a list (both in Section~\ref{sec-type}).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# store series as tslist}
\NormalTok{hist\_a\_lst }\OtherTok{\textless{}{-}}\NormalTok{ hist\_a }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_tslist}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 

\CommentTok{\# convert series to bimets format}
\NormalTok{hist\_a\_bimets }\OtherTok{\textless{}{-}}\NormalTok{ hist\_a\_lst }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  purrr}\SpecialCharTok{::}\FunctionTok{map}\NormalTok{(bimets}\SpecialCharTok{::}\NormalTok{as.bimets)}

\CommentTok{\# bimets strips the attributes, need to reset them for further manipulation by tsbox}
\NormalTok{hist\_a }\OtherTok{\textless{}{-}}\NormalTok{ hist\_a\_bimets }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  fcutils}\SpecialCharTok{::}\FunctionTok{set\_attr\_tslist}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  tsbox}\SpecialCharTok{::}\FunctionTok{ts\_xts}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

For series collected in a \texttt{tslist} on the left of the assignment
use the \texttt{bank{[}{[}seriesname{]}{]}} notation (it can also be
used on the right). Here the lhs series \texttt{seriesname} does not
need to exist, and it might be easier to work with \texttt{tslist} than
\texttt{xts} when variable names are determined at runtime.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# similar to above with a tslist variable}
\NormalTok{hist\_a\_lst[[stringr}\SpecialCharTok{::}\FunctionTok{str\_glue}\NormalTok{(}\StringTok{"E\{ser\_i\}\_AT\_\{cnty\_i\}\_ADD"}\NormalTok{)]] }\OtherTok{\textless{}{-}}\NormalTok{ hist\_a\_lst }\SpecialCharTok{\%$\%}
\NormalTok{  (fcutils}\SpecialCharTok{::}\FunctionTok{get\_var}\NormalTok{(}\StringTok{"E\{ser\_i\}\_AT\_\{cnty\_i\}"}\NormalTok{) }\SpecialCharTok{{-}}\NormalTok{ fcutils}\SpecialCharTok{::}\FunctionTok{get\_var}\NormalTok{(}\StringTok{"E\_NF\_AT\_\{cnty\_i\}"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\section{Harness the power of tsbox}\label{harness-the-power-of-tsbox}

Use the converter functions in
\href{https://www.tsbox.help/reference/index.html}{\texttt{tsbox}} to
shift between various data types (\texttt{ts\_tbl()},
\texttt{ts\_xts()}, \texttt{ts\_ts()}, \texttt{ts\_tslist()}) and
reshaping to the long and wide format (\texttt{ts\_long()},
\texttt{ts\_wide()}). \texttt{tsbox} further contains funtions for time
period selection (\texttt{ts\_span()}), merging and extension operations
(\texttt{ts\_c()}, \texttt{ts\_bind()}, \texttt{ts\_chain()}),
transformations (\texttt{ts\_lag()}, \texttt{ts\_pc()},
\texttt{ts\_pca()}, \texttt{ts\_pcy()}, \texttt{ts\_diff()},
\texttt{ts\_diffy()}), and index construction (\texttt{ts\_compound()},
\texttt{ts\_index()}). These functions are described in
Section~\ref{sec-utils}. Consider these tsbox functions before turning
to solutions that are specific to the \texttt{xts}, \texttt{ts},
\texttt{dplyr} or \texttt{tidyr} packages.

\bookmarksetup{startatroot}

\chapter{Model selection and simulation}\label{sec-modselect}

The model selection process can be run line-by-line from an R script
directly (\emph{R/gets\_model\_select.R}) or via sourcing an Rmd
document (\emph{notes/gets\_model\_select.Rmd}) which collects all model
selection results in an easier to digest html file. Running the full
script (source) takes about 1 minute.

\section{Main user settings}\label{main-user-settings}

Before diving into the automated steps, users must specify several key
parameters that control the model selection process:

\begin{itemize}
\tightlist
\item
  \textbf{\texttt{mselect\_start}} and \textbf{\texttt{mselect\_end}}:
  Define the start and end dates of the period used for model selection.
  This is the sample over which the \emph{gets} algorithm will evaluate
  potential models.\\
\item
  \textbf{\texttt{est\_end}}: Specifies the end of the period used for
  estimation. While the model selection process might consider data up
  to \texttt{mselect\_end}, the final model can be re-estimated using a
  shorter sample ending at \texttt{est\_end}. This is useful when recent
  data is deemed less reliable or structurally different.\\
\item
  \textbf{\texttt{fcst\_start}} and \textbf{\texttt{fcst\_end}}: Define
  the start and end dates of the quasi-forecast period. This is the
  period over which the model's forecasting performance will be
  evaluated. The model is simulated forward from \texttt{fcst\_start},
  and the simulated values are compared against actual data (if
  available) up to \texttt{fcst\_end}.\\
\item
  \textbf{\texttt{max\_lag}}: Specifies the maximum number of lags to be
  considered for each predictor variable in the model. For example, if
  \texttt{max\_lag} is 4, the model selection process will consider the
  current value and up to four lagged values of each predictor.\\
\item
  \textbf{\texttt{yvar\_name}}: The name of the response variable to be
  forecasted. This must correspond to the name of a variable in the
  downloaded dataset. For example:
  \texttt{yvar\_name\ \textless{}-\ "E\_NF\_AT\_HI\_QL"} specifies the
  log of non-farm employment in Hawaii as the target variable.\\
\item
  \textbf{\texttt{xvar\_list}}: A vector of names of potential predictor
  variables. These can include economic indicators, other related time
  series, or even transformations of the response variable itself. For
  instance:\\
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# list of candidate variables (logs are denoted by \_QL extension)}
\NormalTok{xvar\_list }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"Y\_R\_AT\_HI\_QL"}\NormalTok{, }\CommentTok{\# Log of real income in Hawaii}
  \StringTok{"VIS\_AT\_HI\_QL"}\NormalTok{, }\CommentTok{\# Log of visitor arrivals in Hawaii         }
  \StringTok{"CPI\_AT\_HON\_QL"} \CommentTok{\# Log of CPI in Honolulu}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If no additional regressors are considered set
\texttt{xvar\_list\ \textless{}-\ c()}.

\section{\texorpdfstring{Data preparation
(\texttt{tidyverse})}{Data preparation (tidyverse)}}\label{data-preparation-tidyverse}

The data preparation stage involves several steps to transform the raw
data downloaded from UDAMAN into a format suitable for model selection:

\subsection{Data Download and Initial
Processing}\label{data-download-and-initial-processing}

\begin{itemize}
\tightlist
\item
  Download all series used in the model selection process from UDAMAN
  (about 500 rows and 1200 columns) and eliminate special characters
  from the series names.\\
\item
  The data is converted to a long format using \texttt{ts\_long()}.
\end{itemize}

\subsection{Log Transformation}\label{log-transformation}

\begin{itemize}
\tightlist
\item
  All variables in the dataset are log-transformed using. This is a
  common practice in time series analysis to stabilize variance and
  linearize relationships. The names of the log-transformed variables
  are appended with ``L''. For example, \texttt{E\_NF\_AT\_HI} becomes
  \texttt{E\_NF\_AT\_HI\_L}. Note that, depending on the data, this may
  result in \texttt{NaN} values which will be handled by the
  \texttt{gets} algorithm during model selection.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# take the log of all series (some will produce NaNs)}
\NormalTok{hist\_ql }\OtherTok{\textless{}{-}}\NormalTok{ hist\_q }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{value =} \FunctionTok{log}\NormalTok{(value)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{id =} \FunctionTok{str\_c}\NormalTok{(id, }\StringTok{"L"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\subsection{Indicator Variable
Creation}\label{indicator-variable-creation}

\begin{itemize}
\tightlist
\item
  Indicator variables, also known as dummy variables, are created to
  capture the effects of specific events or periods. The script allows
  for loading previously saved indicators
  (\texttt{indicators\_from\_disk}) or creating them from scratch.\\
\item
  \textbf{Impulse Indicator Series (IIS)}: These are binary variables
  that take the value 1 in a specific quarter and 0 otherwise. They are
  used to capture the impact of one-time events or shocks. These dummies
  are useful to control for one-time temporary shocks such as
  hurricanes, policy changes or one-time bonuses paid out in a
  particular quarter. Without controlling for these events, the model
  would try to fit these extraordinary data points using regular
  predictors, which may lead to biased estimates.\\
\item
  \textbf{Step Indicator Series (SIS)}: These variables take the value 0
  before a certain date and 1 thereafter. They are used to model
  structural breaks or permanent level shifts in the time series. A
  typical example of when these indicator series might be useful is the
  case of a permanent policy change, introduction of a major competitor,
  or a permanent change in consumer preferences. By introducing a SIS,
  the model can account for these changes without biasing estimates for
  the entire sample.\\
\item
  \textbf{Season Dummies}: These variables capture the seasonal patterns
  in the data. For quarterly data, four seasonal dummies are created
  (IQ1, IQ2, IQ3, IQ4), each taking the value 1 in the corresponding
  quarter and 0 otherwise. A typical example of quarterly seasonal
  pattern are fourth quarter spending sprees related to holidays, or
  seasonal variations in tourism related to weather conditions and
  holidays in other countries.\\
\item
  \textbf{Trend Indicator}: A linear trend variable (\texttt{ITREND}) is
  created to capture the overall upward or downward movement of the time
  series over time. For example, technological progress or population
  growth may cause a steady upward trend in economic time series such as
  income or consumption.\\
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# combine indicators into single data frame}
\NormalTok{indicator\_vars }\OtherTok{\textless{}{-}} \FunctionTok{ts\_c}\NormalTok{(}
\NormalTok{  iis\_indicators }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ts\_long}\NormalTok{(),}
\NormalTok{  sis\_indicators }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ts\_long}\NormalTok{(),}
\NormalTok{  season\_indicators }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ts\_long}\NormalTok{(),}
\NormalTok{  trend\_indicator }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ts\_long}\NormalTok{()}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{Data Combination}\label{data-combination}

\begin{itemize}
\tightlist
\item
  The original data, log-transformed data, and indicator variables are
  combined into a single dataset using \texttt{ts\_c()}.
\end{itemize}

\subsection{Data Subsetting}\label{data-subsetting}

\begin{itemize}
\tightlist
\item
  The dataset is filtered to include only the observations within the
  \texttt{mselect\_start} and \texttt{mselect\_end} range. The data is
  also subset based on the \texttt{yvar\_name} and \texttt{xvar\_list}
  to retain only the variables relevant for the specific model being
  considered.
\end{itemize}

\subsection{Lag Generation}\label{lag-generation}

\begin{itemize}
\tightlist
\item
  Lags of the predictor variables are generated using \texttt{ts\_lag()}
  and combined using \texttt{ts\_c()}. This creates a dataset containing
  the current and lagged values (up to \texttt{max\_lag}) of each
  predictor.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# generate lags of selected predictors}
\NormalTok{xvar\_lags }\OtherTok{\textless{}{-}} \DecValTok{0}\SpecialCharTok{:}\NormalTok{max\_lag }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{map}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\FunctionTok{ts\_lag}\NormalTok{(xvar\_0, .x)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{reduce}\NormalTok{(ts\_c)}
\end{Highlighting}
\end{Shaded}

\subsection{Data Transformation to
xts}\label{data-transformation-to-xts}

\begin{itemize}
\tightlist
\item
  The response variable and the combined predictor variables (including
  lags, trend, and seasonal dummies) are converted to \texttt{xts}
  objects for use with the \texttt{gets} package.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# transform to xts}
\NormalTok{yvar\_xts }\OtherTok{\textless{}{-}}\NormalTok{ yvar\_0 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_xts}\NormalTok{()}

\CommentTok{\# transform to xts}
\NormalTok{xvar\_xts }\OtherTok{\textless{}{-}}\NormalTok{ xvar\_all }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_xts}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{Model selection steps
(\texttt{gets})}{Model selection steps (gets)}}\label{model-selection-steps-gets}

The core of the model selection process is handled by the
\href{https://cran.r-project.org/web/packages/gets/index.html}{gets
package}, which implements a general-to-specific (GETS) algorithm:

\subsection{Formulate a General Unrestricted Model
(GUM)}\label{formulate-a-general-unrestricted-model-gum}

\begin{itemize}
\tightlist
\item
  The GETS process begins with a GUM that includes all potential
  regressors (predictors, lags, indicators). In our case this includes
  an autoregressive term, trend and seasonal dummies. The \texttt{arx()}
  function is used to estimate the GUM using the \texttt{yvar\_xts} and
  \texttt{xvar\_xts} data. The \texttt{mc\ =\ TRUE} argument specifies
  that a constant term should be included. The
  \texttt{ar\ =\ 1:max\_lag} argument indicates that autoregressive
  terms up to the specified \texttt{max\_lag} should be included.
\item
  The \texttt{arx()} function is also capable of detecting variance
  anomalies in the error terms, such as autoregressive conditional
  heteroskedasticity (ARCH).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# formulate a general unrestricted model}
\CommentTok{\# NA{-}s are automatically eliminated from the data}
\NormalTok{  gum\_model }\OtherTok{\textless{}{-}} \FunctionTok{arx}\NormalTok{(}\AttributeTok{y =}\NormalTok{ yvar\_xts, }\AttributeTok{mc =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{ar =} \DecValTok{1}\SpecialCharTok{:}\NormalTok{max\_lag, }\AttributeTok{mxreg =}\NormalTok{ xvar\_xts)}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{Run the \texttt{gets}
Algorithm}{Run the gets Algorithm}}\label{run-the-gets-algorithm}

\begin{itemize}
\tightlist
\item
  First, the \texttt{isat()} function is applied to the GUM data to
  identify outliers in the unrestricted model using indicator variables.
  Outliers are defined as those observations whose residuals are deemed
  too large, possibly due to some extraordinary events. The outlier
  identification takes into account heteroskedasticity or
  autocorrelation in the residuals.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# identify outliers in the GUM {-}{-}{-}{-}}
\NormalTok{isat\_model }\OtherTok{\textless{}{-}} \FunctionTok{isat}\NormalTok{(}\AttributeTok{y =}\NormalTok{ gum\_data[, }\DecValTok{1}\NormalTok{], }
  \AttributeTok{mc =} \ConstantTok{TRUE}\NormalTok{, }
  \AttributeTok{mxreg =}\NormalTok{ gum\_data[, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{], }
  \AttributeTok{ar.LjungB =} \FunctionTok{list}\NormalTok{(}\AttributeTok{lag=}\NormalTok{max\_lag, }
  \AttributeTok{pval=}\FloatTok{0.01}\NormalTok{), }
  \AttributeTok{arch.LjungB =} \FunctionTok{list}\NormalTok{(}\AttributeTok{lag=}\NormalTok{max\_lag, }\AttributeTok{pval=}\FloatTok{0.01}\NormalTok{), }
  \AttributeTok{iis =} \ConstantTok{TRUE}\NormalTok{, }
  \AttributeTok{sis =} \ConstantTok{TRUE}\NormalTok{, }
  \AttributeTok{plot =} \ConstantTok{TRUE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Next, the \texttt{getsm()} function is applied to the
  outlier-augmented model to perform the general-to-specific model
  selection. It starts with the GUM and iteratively eliminates
  insignificant regressors based on their t-statistics and diagnostic
  tests for autocorrelation (Ljung-Box Q-test) and autoregressive
  conditional heteroskedasticity (ARCH LM test) in the error terms. The
  \texttt{t.pval} argument sets the significance level for retaining
  regressors. The \texttt{keep} argument can be used to force certain
  variables to be kept in the model regardless of their significance.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# run the gets (general to specific) model selection algorithm {-}{-}{-}{-}}
\NormalTok{gets\_model }\OtherTok{\textless{}{-}} \FunctionTok{getsm}\NormalTok{(isat\_model, }
  \AttributeTok{t.pval =} \FloatTok{0.01}\NormalTok{, }
  \AttributeTok{ar.LjungB =} \FunctionTok{list}\NormalTok{(}\AttributeTok{lag=}\NormalTok{max\_lag, }\AttributeTok{pval=}\FloatTok{0.01}\NormalTok{), }
  \AttributeTok{arch.LjungB =} \FunctionTok{list}\NormalTok{(}\AttributeTok{lag=}\NormalTok{max\_lag, }
  \AttributeTok{pval=}\FloatTok{0.01}\NormalTok{), }
  \AttributeTok{keep =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\subsection{Identify Outliers in the
Relationship}\label{identify-outliers-in-the-relationship}

\begin{itemize}
\tightlist
\item
  After the initial GETS selection, the \texttt{isat()} function is
  applied to the residuals of the selected model to identify any
  remaining outliers. This is important, because the initial model
  selection process may produce a different residual series which now
  exhibits new outliers.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check outliers in the residuals}
\NormalTok{isat\_res }\OtherTok{\textless{}{-}}\NormalTok{ gets\_model }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{residuals}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{isat}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{Repeat \texttt{gets} Model Selection
(Optional)}{Repeat gets Model Selection (Optional)}}\label{repeat-gets-model-selection-optional}

\begin{itemize}
\tightlist
\item
  If \texttt{second\_pass} is set to \texttt{TRUE}, the model selection
  process is repeated, but this time including the newly identified
  outliers as regressors. This step further refines the model and
  ensures that the final specification is robust to outliers in the
  data.
\end{itemize}

\subsection{Verify if Additional Outliers Arose Due to Greater Model
Parsimony}\label{verify-if-additional-outliers-arose-due-to-greater-model-parsimony}

\begin{itemize}
\tightlist
\item
  A final check is performed using \texttt{isat()} on the final model's
  residuals to ensure that no additional outliers have emerged due to
  the model simplification process. The \texttt{isatvar()} function can
  then be used to extract the estimated path of the constant,
  incorporating any significant shifts indicated by the outlier
  analysis.
\item
  The \texttt{isattest()} function generates a plot showing the
  significant shifts in the constant over time.
\end{itemize}

\subsection{Handle Zero-Valued
Predictors}\label{handle-zero-valued-predictors}

\begin{itemize}
\tightlist
\item
  If the estimation period (\texttt{est\_end}) is shorter than the model
  selection period (\texttt{mselect\_end}), some predictors (e.g.,
  outlier dummies) might contain only zeros in the estimation sample.
  These variables are identified and removed from the dataset to avoid
  issues during estimation.\\
\item
  This step recognizes that the outliers that occurred after
  \texttt{est\_end} will not be relevant for the estimation of the model
  going forward.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# find all variables with only zeros in the estimation period (if shorter than model selection period)}
\NormalTok{zero\_vars }\OtherTok{\textless{}{-}}\NormalTok{ gets\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_span}\NormalTok{(}\AttributeTok{end =}\NormalTok{ est\_end) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_tbl}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{value =} \FunctionTok{abs}\NormalTok{(value)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(id) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{sum\_vals =} \FunctionTok{sum}\NormalTok{(value)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(sum\_vals }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pull}\NormalTok{(id)}

\CommentTok{\# remove zero valued variables from the estimation sample}
\NormalTok{est\_data }\OtherTok{\textless{}{-}}\NormalTok{ gets\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_span}\NormalTok{(}\AttributeTok{end =}\NormalTok{ est\_end) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_tbl}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_wide}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{all\_of}\NormalTok{(zero\_vars)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_xts}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{Re-estimate Final Model}\label{re-estimate-final-model}

\begin{itemize}
\tightlist
\item
  The final selected model is re-estimated using \texttt{lm()}.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# re{-}estimate re{-}specified model via lm using the estimation sample}
\NormalTok{  est\_lm }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\FunctionTok{as.formula}\NormalTok{(}\FunctionTok{str\_c}\NormalTok{(yvar\_name, }\StringTok{" \textasciitilde{} ."}\NormalTok{)), }\AttributeTok{data =}\NormalTok{ est\_data)}
\end{Highlighting}
\end{Shaded}

\subsection{Save Model Equation}\label{save-model-equation}

\begin{itemize}
\tightlist
\item
  The final model equation is saved as a text file
  (\emph{model\_eq.txt}) using the \texttt{model\_equation()} function.
  This function formats the model output into an equation that can be
  read by the \href{https://github.com/andrea-luciani/bimets}{bimets
  package}. Since the equation can be later re-estimated in bimets, the
  saved equation does not contain the estimated coefficients to keep it
  general.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# look at estimated model and bimets model components}
\FunctionTok{model\_equation}\NormalTok{(est\_lm)}

\CommentTok{\# save equation}
\ControlFlowTok{if}\NormalTok{ (save\_eq) \{}
  \FunctionTok{sink}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"output"}\NormalTok{, }\StringTok{"model\_eq.txt"}\NormalTok{), }\AttributeTok{append =} \ConstantTok{TRUE}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{str\_glue}\NormalTok{(}\StringTok{"}

\StringTok{    \{model\_equation(est\_lm)[2:4]\}}

\StringTok{  "}\NormalTok{))}
  \FunctionTok{sink}\NormalTok{()}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{Produce a quasi-forecast with the selected
model
(\texttt{bimets})}{Produce a quasi-forecast with the selected model (bimets)}}\label{produce-a-quasi-forecast-with-the-selected-model-bimets}

After selecting the model using \texttt{gets}, the \texttt{bimets}
package is used to estimate the model and produce a quasi-forecast:

\subsection{Load Model and Data}\label{load-model-and-data}

\begin{itemize}
\tightlist
\item
  The \texttt{LOAD\_MODEL()} function loads the model equation from the
  saved text file. The \texttt{LOAD\_MODEL\_DATA()} function then
  combines the model with the relevant data, ensuring that all variables
  used in the model are present in the dataset.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# load model from stored txt file}
\NormalTok{model\_eq }\OtherTok{\textless{}{-}}\NormalTok{ bimets}\SpecialCharTok{::}\FunctionTok{LOAD\_MODEL}\NormalTok{(}\AttributeTok{modelFile =} \FunctionTok{here}\NormalTok{(}\StringTok{"output"}\NormalTok{, }\StringTok{"model\_eq.txt"}\NormalTok{))}

\CommentTok{\# store variables in bimets format (no ragged edge: drop\_na)}
\NormalTok{hist\_q\_bimets }\OtherTok{\textless{}{-}}\NormalTok{ hist\_q\_mod }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(id }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(model\_eq}\SpecialCharTok{$}\NormalTok{vendog, model\_eq}\SpecialCharTok{$}\NormalTok{vexog)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_wide}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{drop\_na}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ts\_tslist}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map}\NormalTok{(bimets}\SpecialCharTok{::}\NormalTok{as.bimets)}

\CommentTok{\# add data to model}
\NormalTok{model\_eq\_dat }\OtherTok{\textless{}{-}}\NormalTok{ bimets}\SpecialCharTok{::}\FunctionTok{LOAD\_MODEL\_DATA}\NormalTok{(}
\NormalTok{  model\_eq,}
\NormalTok{  hist\_q\_bimets}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{Estimate the Model}\label{estimate-the-model}

\begin{itemize}
\tightlist
\item
  The \texttt{ESTIMATE()} function estimates the model using the
  specified estimation range (\texttt{est\_range}). If the forecast end
  date (\texttt{fcst\_end}) is later than the estimation end date, a
  Chow test for structural stability is automatically performed. The
  Chow test assesses whether the model's parameters are constant over
  the estimation and forecast periods. The \texttt{CHOWPAR} argument
  specifies the date at which the data is split for the Chow test.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# determine range of history for estimation}
\NormalTok{est\_range }\OtherTok{\textless{}{-}}\NormalTok{ model\_eq\_dat}\SpecialCharTok{$}\NormalTok{modelData }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{set\_attr\_tslist}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_xts}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  zoo}\SpecialCharTok{::}\FunctionTok{index}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{extract}\NormalTok{(}\FunctionTok{c}\NormalTok{(max\_lag}\SpecialCharTok{+}\DecValTok{1}\NormalTok{, }\FunctionTok{length}\NormalTok{(.)))}

\CommentTok{\# estimate model}
\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{floor\_date}\NormalTok{(fcst\_end, }\StringTok{"quarter"}\NormalTok{) }\SpecialCharTok{\textless{}=} \FunctionTok{floor\_date}\NormalTok{(est\_range[}\DecValTok{2}\NormalTok{], }\StringTok{"quarter"}\NormalTok{)) \{}
\NormalTok{  model\_est }\OtherTok{\textless{}{-}}\NormalTok{ bimets}\SpecialCharTok{::}\FunctionTok{ESTIMATE}\NormalTok{(model\_eq\_dat,}
    \AttributeTok{eqList =}\NormalTok{ model\_eq\_dat}\SpecialCharTok{$}\NormalTok{vendog,}
    \AttributeTok{TSRANGE =} \FunctionTok{c}\NormalTok{(}\FunctionTok{year}\NormalTok{(est\_range[}\DecValTok{1}\NormalTok{]), }\FunctionTok{quarter}\NormalTok{(est\_range[}\DecValTok{1}\NormalTok{]), }\FunctionTok{year}\NormalTok{(est\_range[}\DecValTok{2}\NormalTok{]), }\FunctionTok{quarter}\NormalTok{(est\_range[}\DecValTok{2}\NormalTok{])),}
    \AttributeTok{quietly =} \ConstantTok{FALSE}
\NormalTok{  )}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{  model\_est }\OtherTok{\textless{}{-}}\NormalTok{ bimets}\SpecialCharTok{::}\FunctionTok{ESTIMATE}\NormalTok{(model\_eq\_dat,}
    \AttributeTok{eqList =}\NormalTok{ model\_eq\_dat}\SpecialCharTok{$}\NormalTok{vendog,}
    \AttributeTok{TSRANGE =} \FunctionTok{c}\NormalTok{(}\FunctionTok{year}\NormalTok{(est\_range[}\DecValTok{1}\NormalTok{]), }\FunctionTok{quarter}\NormalTok{(est\_range[}\DecValTok{1}\NormalTok{]), }\FunctionTok{year}\NormalTok{(est\_range[}\DecValTok{2}\NormalTok{]), }\FunctionTok{quarter}\NormalTok{(est\_range[}\DecValTok{2}\NormalTok{])),}
    \AttributeTok{CHOWTEST =} \ConstantTok{TRUE}\NormalTok{,}
    \AttributeTok{CHOWPAR =} \FunctionTok{c}\NormalTok{(}\FunctionTok{year}\NormalTok{(fcst\_end), }\FunctionTok{quarter}\NormalTok{(fcst\_end)),}
    \AttributeTok{quietly =} \ConstantTok{FALSE}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\subsection{Simulate the Model}\label{simulate-the-model}

\begin{itemize}
\tightlist
\item
  Statistical models generate forecasts based on historical data
  patterns and estimated relationships between variables. These models
  often assume that the underlying structure and relationships observed
  in the past will continue to hold in the future. There might be events
  or changes that are known (or believed) to occur in the future but are
  not reflected in the historical data or the model's structure. Set
  \emph{addfactors} to adjust the forecast path. An addfactor is a value
  that is added to the model's forecast for a specific variable and time
  period. It's essentially a way to incorporate external information,
  expert opinion, or subjective judgment into a model-based forecast.
  Addfactors are used to bridge the gap between purely model-based
  forecasts and external information or judgment. They are expressed in
  the same units as the variable being forcasted.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set value of addfactors}
\NormalTok{scen\_addfactor }\OtherTok{\textless{}{-}}\NormalTok{ hist\_q\_mod }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(id }\SpecialCharTok{\%in\%} \FunctionTok{str\_glue}\NormalTok{(}\StringTok{"\{model\_eq\_dat$vendog\}"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{value =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_tslist}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map}\NormalTok{(bimets}\SpecialCharTok{::}\NormalTok{as.bimets)}
  
\CommentTok{\# update an addfactor stored in xts format}
\NormalTok{add\_qmod.xts}\SpecialCharTok{$}\NormalTok{NDEA\_HI }\SpecialCharTok{\%+=\%} \FunctionTok{addf}\NormalTok{(}\FloatTok{2021.4}\NormalTok{, }\FloatTok{2024.4}\NormalTok{, .}\DecValTok{01}\NormalTok{, .}\DecValTok{025}\NormalTok{)}
  
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  The \texttt{SIMULATE()} function simulates the model over the forecast
  period (\texttt{fcst\_start} to \texttt{fcst\_end}). The
  \texttt{simType\ =\ "FORECAST"} argument specifies that a
  deterministic forecast should be produced.
\item
  The \texttt{simConvergence} and \texttt{simIterLimit} arguments
  control the convergence criteria and maximum number of iterations for
  the simulation algorithm. These parameters are particularly relevant
  for models with simultaneous equations, where the values of endogenous
  variables depend on each other. The simulation algorithm iteratively
  solves the system of equations until the solution converges or the
  maximum number of iterations is reached.
\item
  Use the \texttt{fcutils::set\_tsrange()} function to deal with a
  ragged edge in the data and prepare the exogenization range for the
  \texttt{Exogenize} parameter of the \texttt{SIMULATE()} function.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# simulate model}
\NormalTok{model\_sim }\OtherTok{\textless{}{-}}\NormalTok{ bimets}\SpecialCharTok{::}\FunctionTok{SIMULATE}\NormalTok{(model\_est,}
  \AttributeTok{simType =} \StringTok{"FORECAST"}\NormalTok{,}
  \AttributeTok{TSRANGE =} \FunctionTok{c}\NormalTok{(}\FunctionTok{year}\NormalTok{(fcst\_start), }\FunctionTok{quarter}\NormalTok{(fcst\_start), }\FunctionTok{year}\NormalTok{(fcst\_end), }\FunctionTok{quarter}\NormalTok{(fcst\_end)),}
  \AttributeTok{ConstantAdjustment =}\NormalTok{ scen\_addfactor,}
  \AttributeTok{Exogenize =}\NormalTok{ exog\_range,}
  \AttributeTok{simConvergence =} \FloatTok{0.00001}\NormalTok{,}
  \AttributeTok{simIterLimit =} \DecValTok{100}\NormalTok{,}
  \AttributeTok{quietly =} \ConstantTok{FALSE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{Evaluate the Simulation}\label{evaluate-the-simulation}

\begin{itemize}
\tightlist
\item
  The simulated values (forecast) are extracted from the
  \texttt{model\_sim} object and combined with the historical data for
  evaluation. The \texttt{plot\_comp\_2()} function is used to generate
  plots comparing the quasi-forecast with the actual history. These
  plots help assess the model's ability to capture the dynamics of the
  time series and its potential forecasting accuracy.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# extract forecast}
\NormalTok{model\_fcst }\OtherTok{\textless{}{-}}\NormalTok{ model\_sim}\SpecialCharTok{$}\NormalTok{simulation }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{extract}\NormalTok{(model\_sim}\SpecialCharTok{$}\NormalTok{vendog) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{set\_attr\_tslist}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_tbl}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{id =} \FunctionTok{str\_c}\NormalTok{(model\_sim}\SpecialCharTok{$}\NormalTok{vendog, }\StringTok{"SOL"}\NormalTok{), }\AttributeTok{.before =}\NormalTok{ time)}

\CommentTok{\# combine history and forecast for plot}
\NormalTok{plot\_data\_fcst }\OtherTok{\textless{}{-}} \FunctionTok{ts\_c}\NormalTok{(hist\_q\_mod }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(id }\SpecialCharTok{\%in\%}\NormalTok{ model\_sim}\SpecialCharTok{$}\NormalTok{vendog), model\_fcst) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ts\_wide}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice}\NormalTok{(}\FunctionTok{which}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(}\SpecialCharTok{!!}\FunctionTok{sym}\NormalTok{(model\_sim}\SpecialCharTok{$}\NormalTok{vendog)) }\SpecialCharTok{|} \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(}\SpecialCharTok{!!}\FunctionTok{sym}\NormalTok{(}\FunctionTok{str\_glue}\NormalTok{(}\StringTok{"\{model\_sim$vendog\}SOL"}\NormalTok{)))))}

\FunctionTok{plot\_comp\_2}\NormalTok{(plot\_data\_fcst }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ts\_long}\NormalTok{(), }
  \AttributeTok{rng\_start =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{() }\SpecialCharTok{{-}} \FunctionTok{years}\NormalTok{(}\DecValTok{15}\NormalTok{)), }
  \AttributeTok{rng\_end =}\NormalTok{ fcst\_end }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{as.character}\NormalTok{(), }
  \AttributeTok{height =} \DecValTok{200}\NormalTok{, }\AttributeTok{width =} \DecValTok{400}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\section{Stochastic simulation}\label{stochastic-simulation}

The preceding workflow can be extended with stochastic simulation. If
necessary it is preceded by the same data preparation and model
selection steps.

\subsection{Simulate model deterministically to obtain mean
forecast.}\label{simulate-model-deterministically-to-obtain-mean-forecast.}

The first step for obtaining a forecast interval is to simulate the
estimated model deterministically. In a deterministic simulation, the
model's equations are solved without any random shocks. This produces a
single ``mean'' forecast, representing the most likely path of the
endogenous variables given the model's structure, estimated parameters,
and any specified exogenous assumptions.

\subsection{Extract forecast and combine it with
history.}\label{extract-forecast-and-combine-it-with-history.}

After the deterministic simulation, the forecasted values are extracted
from the simulation object. The historical data and the forecasted
values are combined to facilitate comparison and visualization.

\subsection{Inspect the forecast via
plots.}\label{inspect-the-forecast-via-plots.}

Then generate plots to visually compare the historical data and the
deterministic forecast. These plots allow for a visual assessment of the
forecast's behavior compared to the historical data. For example, one
can observe whether the forecast captures the overall cycles in the
historical data, and whether there are any abrupt changes or
discontinuities at the forecast origin.

\subsection{Set parameters for stochastic
simulations.}\label{set-parameters-for-stochastic-simulations.}

Stochastic simulation introduces randomness into the model to generate a
distribution of possible future paths, rather than just a single mean
forecast. This helps to quantify the uncertainty surrounding the
forecast.

The first step in stochastic simulation is to define the structure of
the random shocks. This is done by creating a list called
\texttt{myStochStructure}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set parameters for stochastic simulation}
\NormalTok{myStochStructure }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (ser\_i }\ControlFlowTok{in}\NormalTok{ scen\_model}\SpecialCharTok{$}\NormalTok{vendog) \{}
\NormalTok{  myStochStructure[[ser\_i]] }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{TSRANGE =} \ConstantTok{TRUE}\NormalTok{,}
    \AttributeTok{TYPE =} \StringTok{"NORM"}\NormalTok{,}
    \AttributeTok{PARS =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, scen\_model\_est}\SpecialCharTok{$}\NormalTok{behaviorals[[ser\_i]][[}\StringTok{"statistics"}\NormalTok{]][[}\StringTok{"StandardErrorRegression"}\NormalTok{]])}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  The code iterates through each endogenous variable (\texttt{ser\_i}).
\item
  For each variable, it creates a list specifying the parameters of the
  random shocks:

  \begin{itemize}
  \tightlist
  \item
    \textbf{\texttt{TSRANGE\ =\ TRUE}}: Indicates that the shocks should
    be applied throughout the entire simulation period.
  \item
    \textbf{\texttt{TYPE\ =\ "NORM"}}: Specifies that the shocks should
    be drawn from a normal distribution.
  \item
    \textbf{\texttt{PARS}}: Defines the parameters of the normal
    distribution. In this case, the mean is set to 0 and the standard
    deviation is set to the standard error of the regression for the
    corresponding equation. This means that the random shocks are scaled
    to the estimated uncertainty of each equation. The standard
    deviation of the error term is obtained from the estimation output,
    and it reflects the historical volatility of the residuals.
  \end{itemize}
\end{itemize}

In addition to perturbing the error terms, the script also allows for
perturbing the estimated coefficients. This captures the uncertainty in
the parameter estimates themselves.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# perturb coefficients (draw from multivariate normal distro)}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{987}\NormalTok{)}
\NormalTok{scen\_model\_est\_copy }\OtherTok{\textless{}{-}}\NormalTok{ scen\_model\_est}
\NormalTok{scen\_model\_est\_pars }\OtherTok{\textless{}{-}}\NormalTok{ scen\_model\_est}\SpecialCharTok{$}\NormalTok{behaviorals }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \ControlFlowTok{if}\NormalTok{ (n\_coeff\_sim }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
    \FunctionTok{cbind}\NormalTok{(}
\NormalTok{      .x}\SpecialCharTok{$}\NormalTok{coefficients,}
\NormalTok{      MASS}\SpecialCharTok{::}\FunctionTok{mvrnorm}\NormalTok{(}\AttributeTok{n =}\NormalTok{ n\_coeff\_sim, }\AttributeTok{mu =}\NormalTok{ .x}\SpecialCharTok{$}\NormalTok{coefficients, }\AttributeTok{Sigma =}\NormalTok{ .x}\SpecialCharTok{$}\NormalTok{statistics}\SpecialCharTok{$}\NormalTok{CoeffCovariance) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{t}\NormalTok{()}
\NormalTok{    )}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    .x}\SpecialCharTok{$}\NormalTok{coefficients}
\NormalTok{  \})}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{\texttt{set.seed(987)}}: Sets the random seed for
  reproducibility.
\item
  \textbf{\texttt{scen\_model\_est\_copy\ \textless{}-\ scen\_model\_est}}:
  Creates a copy of the estimated model object.
\item
  \textbf{\texttt{scen\_model\_est\_pars}}: Stores the perturbed
  coefficients.
\item
  The code iterates through each equation in
  \texttt{scen\_model\_est\$behaviorals}.
\item
  If \texttt{n\_coeff\_sim} is greater than 0, it draws
  \texttt{n\_coeff\_sim} sets of coefficients from a multivariate normal
  distribution using \texttt{MASS::mvrnorm()}. The mean of the
  distribution is the original estimated coefficients
  (\texttt{.x\$coefficients}), and the covariance matrix is the
  estimated covariance matrix of the coefficients
  (\texttt{.x\$statistics\$CoeffCovariance}). This ensures that the
  perturbed coefficients are consistent with the estimated uncertainty
  and correlations among the parameters.
\item
  If \texttt{n\_coeff\_sim} is 0 (coefficients are not drawn randomly),
  the original coefficients are used without perturbation.
\end{itemize}

\subsection{Run stochastic
simulation.}\label{run-stochastic-simulation.}

The stochastic simulation is performed using the
\texttt{STOCHSIMULATE()} function in \texttt{bimets}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create variables to hold stochastic simulation objects and forecasts}
\NormalTok{scen\_model\_stochsim }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\NormalTok{scen\_model\_stochfcast }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}

\CommentTok{\# loop over the parameter draws (first one is the estimate)}
\ControlFlowTok{for}\NormalTok{ (sim\_i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\NormalTok{(n\_coeff\_sim }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)) \{ }\CommentTok{\# sim\_i = 1}

  \CommentTok{\# set params for each equation}
  \ControlFlowTok{for}\NormalTok{ (eq\_i }\ControlFlowTok{in}\NormalTok{ scen\_model\_dat}\SpecialCharTok{$}\NormalTok{vendog) \{ }\CommentTok{\# eq\_i = scen\_model\_dat$vendog[1]}
\NormalTok{    scen\_model\_est\_copy}\SpecialCharTok{$}\NormalTok{behaviorals[[eq\_i]][[}\StringTok{"coefficients"}\NormalTok{]][, }\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ scen\_model\_est\_pars[[eq\_i]][, sim\_i]}
\NormalTok{  \}}

  \CommentTok{\# simulate model}
\NormalTok{  scen\_model\_stochsim[[sim\_i]] }\OtherTok{\textless{}{-}}\NormalTok{ bimets}\SpecialCharTok{::}\FunctionTok{STOCHSIMULATE}\NormalTok{(scen\_model\_est\_copy,}
    \AttributeTok{simType =} \StringTok{"FORECAST"}\NormalTok{,}
    \AttributeTok{TSRANGE =} \FunctionTok{c}\NormalTok{(}\FunctionTok{year}\NormalTok{(fcst\_start), }\FunctionTok{quarter}\NormalTok{(fcst\_start), }\FunctionTok{year}\NormalTok{(fcst\_end), }\FunctionTok{quarter}\NormalTok{(fcst\_end)),}
    \AttributeTok{Exogenize =}\NormalTok{ exog\_range,}
    \AttributeTok{simConvergence =} \FloatTok{0.00001}\NormalTok{,}
    \AttributeTok{simIterLimit =} \DecValTok{100}\NormalTok{,}
    \AttributeTok{StochStructure =}\NormalTok{ myStochStructure,}
    \AttributeTok{StochReplica =}\NormalTok{ n\_stoch\_sim,}
    \AttributeTok{StochSeed =} \DecValTok{123} \SpecialCharTok{+}\NormalTok{ sim\_i,}
    \AttributeTok{quietly =} \ConstantTok{FALSE}
\NormalTok{  )}

  \CommentTok{\# extract forecast}
\NormalTok{  scen\_model\_stochfcast[[sim\_i]] }\OtherTok{\textless{}{-}}\NormalTok{ scen\_model\_stochsim[[sim\_i]][[}\StringTok{"simulation\_MM"}\NormalTok{]] }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{extract}\NormalTok{(scen\_model}\SpecialCharTok{$}\NormalTok{vendog)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  The code loops \texttt{n\_coeff\_sim\ +\ 1} times. In the first
  iteration (\texttt{sim\_i\ =\ 1}), the original estimated coefficients
  are used. In subsequent iterations, the perturbed coefficients are
  used.
\item
  Inside the loop, for each iteration:

  \begin{itemize}
  \tightlist
  \item
    The coefficients in \texttt{scen\_model\_est\_copy} are updated with
    the current set of perturbed coefficients.
  \item
    \texttt{STOCHSIMULATE()} is called to perform the stochastic
    simulation.
  \item
    \textbf{\texttt{StochStructure\ =\ myStochStructure}}: Specifies the
    structure of the random shocks defined earlier.
  \item
    \textbf{\texttt{StochReplica\ =\ n\_stoch\_sim}}: Sets the number of
    stochastic replications for each set of coefficients. Each
    replication involves drawing a new set of random shocks and
    simulating the model.
  \item
    \textbf{\texttt{StochSeed\ =\ 123\ +\ sim\_i}}: Sets the random seed
    for each iteration, ensuring reproducibility.
  \item
    The simulated paths are extracted from
    \texttt{scen\_model\_stochsim{[}{[}sim\_i{]}{]}{[}{[}"simulation\_MM"{]}{]}}
    and stored in \texttt{scen\_model\_stochfcast{[}{[}sim\_i{]}{]}}.
  \end{itemize}
\end{itemize}

\subsection{Extract simulated paths and obtain deviations from the mean
forecast.}\label{extract-simulated-paths-and-obtain-deviations-from-the-mean-forecast.}

After the stochastic simulation, the simulated paths are processed to
analyze the distribution of possible outcomes:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# convert matrices in the list to ts\_long format}
\NormalTok{scen\_model\_stochfcast }\OtherTok{\textless{}{-}}\NormalTok{ scen\_model\_stochfcast }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_depth}\NormalTok{(}\DecValTok{2}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) \{}
    \FunctionTok{as\_tibble}\NormalTok{(x, }\AttributeTok{.name\_repair =} \ConstantTok{NULL}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{mutate}\NormalTok{(}\AttributeTok{time =} \FunctionTok{seq.Date}\NormalTok{(}\AttributeTok{from =}\NormalTok{ fcst\_start, }\AttributeTok{to =}\NormalTok{ fcst\_end, }\AttributeTok{by =} \StringTok{"quarter"}\NormalTok{), }\AttributeTok{.before =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{ts\_long}\NormalTok{()}
\NormalTok{  \})}

\CommentTok{\# forecast deviations}
\NormalTok{scen\_model\_stochdev }\OtherTok{\textless{}{-}}\NormalTok{ scen\_model\_stochfcast }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_depth}\NormalTok{(}\DecValTok{2}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) \{}
    \FunctionTok{ts\_wide}\NormalTok{(x) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(V1}\SpecialCharTok{:}\FunctionTok{last\_col}\NormalTok{(), }\SpecialCharTok{\textasciitilde{}}\NormalTok{ (.x }\SpecialCharTok{/}\NormalTok{ V1) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{V1) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{ts\_long}\NormalTok{()}
\NormalTok{  \})}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{\texttt{scen\_model\_stochfcast}} is transformed using
  \texttt{map\_depth(2,\ ...)} to apply a function to each simulated
  path (each element at depth 2 of the nested list).

  \begin{itemize}
  \tightlist
  \item
    \texttt{as\_tibble()} converts the matrix of simulated values to a
    tibble.
  \item
    \texttt{mutate(time\ =\ ...)} adds a time index.
  \item
    \texttt{ts\_long()} converts the data to long format.
  \end{itemize}
\item
  \textbf{\texttt{scen\_model\_stochdev}} calculates the deviations of
  each simulated path from the mean forecast (the first path,
  \texttt{V1}).

  \begin{itemize}
  \tightlist
  \item
    \texttt{ts\_wide()} converts the data to wide format.
  \item
    \texttt{mutate(across(V1:last\_col(),\ \textasciitilde{}\ (.x\ /\ V1)\ -\ 1))}
    calculates the percentage deviation of each column (simulated path)
    from the first column (mean forecast).
  \item
    \texttt{select(-V1)} removes the mean forecast column.
  \item
    \texttt{ts\_long()} converts the data back to long format.
  \end{itemize}
\end{itemize}

The script then calculates quantiles of the distribution of deviations:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# quantiles}
\NormalTok{scen\_model\_quantiles }\OtherTok{\textless{}{-}}\NormalTok{ scen\_model\_stochdev }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{transpose}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_depth}\NormalTok{(}\DecValTok{2}\NormalTok{, ts\_wide) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{reduce}\NormalTok{(.x, }\ControlFlowTok{function}\NormalTok{(x1, x2) }\FunctionTok{full\_join}\NormalTok{(x1, x2, }\AttributeTok{by =} \StringTok{"time"}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map}\NormalTok{(}\ControlFlowTok{function}\NormalTok{(x) \{}
    \CommentTok{\# ts\_wide(x) \%\textgreater{}\%}
    \FunctionTok{rowwise}\NormalTok{(x) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{transmute}\NormalTok{(}
        \AttributeTok{time =}\NormalTok{ time,}
        \AttributeTok{Q05 =} \FunctionTok{quantile}\NormalTok{(}\FunctionTok{c\_across}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{), }\FloatTok{0.05}\NormalTok{),}
        \AttributeTok{Q10 =} \FunctionTok{quantile}\NormalTok{(}\FunctionTok{c\_across}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{), }\FloatTok{0.10}\NormalTok{),}
        \AttributeTok{Q20 =} \FunctionTok{quantile}\NormalTok{(}\FunctionTok{c\_across}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{), }\FloatTok{0.20}\NormalTok{),}
        \AttributeTok{Q50 =} \FunctionTok{quantile}\NormalTok{(}\FunctionTok{c\_across}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{), }\FloatTok{0.50}\NormalTok{),}
        \AttributeTok{Q80 =} \FunctionTok{quantile}\NormalTok{(}\FunctionTok{c\_across}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{), }\FloatTok{0.80}\NormalTok{),}
        \AttributeTok{Q90 =} \FunctionTok{quantile}\NormalTok{(}\FunctionTok{c\_across}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{), }\FloatTok{0.90}\NormalTok{),}
        \AttributeTok{Q95 =} \FunctionTok{quantile}\NormalTok{(}\FunctionTok{c\_across}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{), }\FloatTok{0.95}\NormalTok{),}
\NormalTok{      ) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{ungroup}\NormalTok{()}
\NormalTok{  \})}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{transpose()} transposes the nested list structure of
  \texttt{scen\_model\_stochdev}.
\item
  \texttt{map\_depth(2,\ ts\_wide)} converts each set of deviations to
  wide format.
\item
  \texttt{map(\textasciitilde{}\ reduce(.x,\ ...))} combines the
  deviations for each variable into a single tibble.
\item
  \texttt{map(function(x)\ ...)} calculates the quantiles for each time
  period using \texttt{quantile()}.
\end{itemize}

The resulting \texttt{scen\_model\_quantiles} object contains the 5th,
10th, 20th, 50th, 80th, 90th, and 95th percentiles of the distribution
of deviations for each variable.

\subsection{Inspect the paths via
plots.}\label{inspect-the-paths-via-plots.}

Finally, the script generates plots to visualize the simulated paths and
the quantiles:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# generate plots (compare levels)}
\FunctionTok{pdf}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"output/plots"}\NormalTok{, }\StringTok{"stoch\_plot.pdf"}\NormalTok{))}

\ControlFlowTok{for}\NormalTok{ (ser\_i }\ControlFlowTok{in}\NormalTok{ scen\_model}\SpecialCharTok{$}\NormalTok{vendog) \{ }\CommentTok{\# ser\_i = scen\_model$vendog[1]}
\NormalTok{  plot\_out }\OtherTok{\textless{}{-}}\NormalTok{ scen\_model\_stochfcast }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{transpose}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{map\_depth}\NormalTok{(}\DecValTok{2}\NormalTok{, ts\_wide) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{map}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{reduce}\NormalTok{(.x, }\ControlFlowTok{function}\NormalTok{(x1, x2) }\FunctionTok{full\_join}\NormalTok{(x1, x2, }\AttributeTok{by =} \StringTok{"time"}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{map}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{rename\_with}\NormalTok{(.x, }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\FunctionTok{str\_c}\NormalTok{(}\StringTok{"V"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\NormalTok{((n\_coeff\_sim }\SpecialCharTok{+} \DecValTok{1}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ (n\_stoch\_sim }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)))))) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{map}\NormalTok{(ts\_long) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{extract2}\NormalTok{(ser\_i) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ time)) }\SpecialCharTok{+}
    \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{group =}\NormalTok{ id), }\AttributeTok{linetype =} \DecValTok{1}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{color =} \StringTok{"seagreen"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{y =} \FunctionTok{str\_glue}\NormalTok{(}\StringTok{"\{ser\_i\}"}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}
  \FunctionTok{print}\NormalTok{(plot\_out)}
\NormalTok{\}}

\ControlFlowTok{for}\NormalTok{ (ser\_i }\ControlFlowTok{in}\NormalTok{ scen\_model}\SpecialCharTok{$}\NormalTok{vendog) \{ }\CommentTok{\# ser\_i = scen\_model$vendog[1]}
\NormalTok{  plot\_out }\OtherTok{\textless{}{-}}\NormalTok{ scen\_model\_stochdev }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{transpose}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{map\_depth}\NormalTok{(}\DecValTok{2}\NormalTok{, ts\_wide) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{map}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{reduce}\NormalTok{(.x, }\ControlFlowTok{function}\NormalTok{(x1, x2) }\FunctionTok{full\_join}\NormalTok{(x1, x2, }\AttributeTok{by =} \StringTok{"time"}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{map}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{rename\_with}\NormalTok{(.x, }\SpecialCharTok{\textasciitilde{}} \FunctionTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\FunctionTok{str\_c}\NormalTok{(}\StringTok{"V"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\NormalTok{((n\_coeff\_sim }\SpecialCharTok{+} \DecValTok{1}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ (n\_stoch\_sim)))))) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{map}\NormalTok{(ts\_long) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{extract2}\NormalTok{(ser\_i) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ time)) }\SpecialCharTok{+}
    \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{group =}\NormalTok{ id), }\AttributeTok{linetype =} \DecValTok{1}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{color =} \StringTok{"seagreen"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{y =} \FunctionTok{str\_glue}\NormalTok{(}\StringTok{"\{ser\_i\}"}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}
  \FunctionTok{print}\NormalTok{(plot\_out)}
\NormalTok{\}}

\ControlFlowTok{for}\NormalTok{ (ser\_i }\ControlFlowTok{in}\NormalTok{ scen\_model}\SpecialCharTok{$}\NormalTok{vendog) \{ }\CommentTok{\# ser\_i = scen\_model$vendog[1]}
\NormalTok{  plot\_out }\OtherTok{\textless{}{-}}\NormalTok{ scen\_model\_quantiles }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{extract2}\NormalTok{(ser\_i) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ts\_long}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ time)) }\SpecialCharTok{+}
    \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{group =}\NormalTok{ id), }\AttributeTok{linetype =} \DecValTok{1}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{color =} \StringTok{"seagreen"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{y =} \FunctionTok{str\_glue}\NormalTok{(}\StringTok{"\{ser\_i\}"}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}
  \FunctionTok{print}\NormalTok{(plot\_out)}
\NormalTok{\}}

\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  The code iterates through each endogenous variable (\texttt{ser\_i}).
\item
  For each variable, it creates three types of plots:

  \begin{itemize}
  \tightlist
  \item
    \textbf{Simulated levels}: Shows all simulated paths of the
    variable.
  \item
    \textbf{Deviations from the mean forecast}: Shows the deviations of
    each simulated path from the mean forecast.
  \item
    \textbf{Quantiles}: Shows the quantiles of the distribution of
    deviations.
  \end{itemize}
\item
  \texttt{ggplot2} is used to create the plots, with
  \texttt{geom\_line()} used to display the paths.
\item
  The plots are saved to a PDF file (\texttt{stoch\_plot.pdf}).
\end{itemize}

These plots provide a visual representation of the uncertainty
surrounding the forecast. The spread of the simulated paths and the
width of the quantile bands indicate the range of possible outcomes. By
examining these plots, one can assess the degree of uncertainty
associated with different variables and time periods.

The script includes an additional set of plots based on smoothed
quantile paths, which are generated by applying user-specified
adjustment factors to certain quantiles at specific time points and then
interpolating the values in between. This allows for incorporating
subjective views about the evolution of uncertainty over time. However,
the overall logic of plotting the smoothed paths is similar to that
described above.

\section{Conclusion}\label{conclusion}

This detailed process, combining the strengths of \texttt{gets} and
\texttt{bimets}, provides a robust and flexible framework for model
selection and evaluation in time series forecasting. The use of
indicator variables, diagnostic tests, and quasi-forecast evaluation
further enhances the reliability and interpretability of the selected
models. The use of stochastic simulation provides valuable insights into
the range of possible outcomes and helps to quantify the risks
associated with relying solely on a single mean forecast.




\end{document}
